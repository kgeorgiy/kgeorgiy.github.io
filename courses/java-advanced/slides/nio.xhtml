<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html lang="ru" xml:lang="ru" xmlns="http://www.w3.org/1999/xhtml"><head><title>Технологии Java / Неблокирующий и асинхронный ввод-вывод</title><meta name="author" content="" /><link rel="stylesheet" type="text/css" media="screen, projection, print" href="scripts/slidy.css" /><link rel="stylesheet" type="text/css" href="scripts/prettify.css" /><link rel="stylesheet" type="text/css" href="scripts/kgeorgiy-slides.css" /><script type="text/javascript" src="scripts/slidy.js" charset="utf-8" /><script type="text/javascript" src="scripts/kgeorgiy-slides.js" charset="utf-8" /><script type="text/javascript" src="scripts/prettify.js" /><script type="text/javascript" src="scripts/lang-sql.js" /><script type="text/javascript" src="scripts/lang-javaModule.js" /><script type="text/javascript" src="scripts/lang-scala.js" /><script>var _gaq=_gaq||[];_gaq.push(["_setAccount","UA-37693764-1"]);_gaq.push(["_setDomainName","kgeorgiy.info"]);_gaq.push(["_trackPageview"]);(function(){var a=document.createElement("script");a.type="text/javascript";a.async=!0;a.src=("https:"==document.location.protocol?"https://ssl":"http://www")+".google-analytics.com/ga.js";var b=document.getElementsByTagName("script")[0];b.parentNode.insertBefore(a,b)})();</script><script async="async" src="https://www.googletagmanager.com/gtag/js?id=G-8EQ66D87ZZ" /><script>
                  window.dataLayer = window.dataLayer || [];
                  function gtag(){dataLayer.push(arguments);}
                  gtag('js', new Date());

                  gtag('config', 'G-8EQ66D87ZZ');
                </script></head><body onload="prettyPrint()"><div id="all">
<div class="slide cover"><div class="content"><div class="course">Технологии Java</div><hr /><div class="lecture"><div>Неблокирующий и асинхронный ввод-вывод</div></div><div class="link"><a href="https://kgeorgiy.info/courses/java-advanced/">https://kgeorgiy.info/courses/java-advanced/</a></div><div class="copyright"><a href="http://creativecommons.org/licenses/by-nc-sa/4.0/deed.ru"><span class="copyright">Copyright © Georgiy Korneev</span><img src="scripts/by-nc-sa.png" alt="Attribution-NonCommercial-ShareAlike" /></a></div></div></div>
<div class="slide section"><div class="content"><h1>Буферы</h1><h2>Содержание</h2><div class="body"><ol class="level-1 toc-1"><li><a href="#(2)" class="toc current">Буферы</a></li><li><a href="#(12)" class="toc">Каналы</a></li><li><a href="#(52)" class="toc">Виртуальные потоки</a></li><li><a href="#(59)" class="toc">Заключение</a></li></ol></div><div class="footer"><div class="test"><span class="author">Georgiy Korneev</span><span class="title">Технологии Java / Неблокирующий и асинхронный ввод-вывод</span><span class="number">2</span></div></div></div></div>
<div class="slide"><div class="content"><h1>Что такое буфер</h1><div class="body"><ul class="item-1 level-1"><li>Последовательность элементов<ul class="item-2 level-2"><li>Примитивного типа</li></ul></li><li>Класс <var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/nio/Buffer.html" target="_blank">Buffer</a></var><ul class="item-2 level-2"><li><var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/nio/Buffer.html#capacity()" target="_blank">capacity()</a></var> — общий размер</li><li><var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/nio/Buffer.html#limit()" target="_blank">limit()</a></var> — доступный размер</li><li><var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/nio/Buffer.html#position()" target="_blank">position()</a></var> — текущее положение</li><li><var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/nio/Buffer.html#remaining()" target="_blank">remaining()</a></var> — остаток </li></ul></li></ul><div class="img-width"><img class="width" style="width: 70%" src="pics/Buffer.svg" /></div></div><div class="footer"><div class="test"><span class="author">Georgiy Korneev</span><span class="title">Технологии Java / Неблокирующий и асинхронный ввод-вывод</span><span class="number">3</span></div></div></div></div>
<div class="slide"><div class="content"><h1>Чтение и запись</h1><div class="body"><ul class="item-1 level-1"><li>Чтение<ul class="item-2 level-2"><li>Относительное: <var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/nio/ByteBuffer.html#get()" target="_blank">get()</a></var>, <var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/nio/ByteBuffer.html#get(byte[])" target="_blank">get(T[])</a></var>, <var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/nio/ByteBuffer.html#get(byte[],int,int)" target="_blank">get(T[], offset, length)</a></var></li><li>Абсолютное: <var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/nio/ByteBuffer.html#get(int)" target="_blank">get(index, ...)</a></var></li></ul></li><li>Запись<ul class="item-2 level-2"><li>Относительная: <var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/nio/ByteBuffer.html#put(byte)" target="_blank">put(T)</a></var>, <var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/nio/ByteBuffer.html#put(byte[])" target="_blank">put(T[])</a></var>, <var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/nio/ByteBuffer.html#put(byte[],int,int)" target="_blank">put(T[], offset, length)</a></var></li><li>Абсолютная: <var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/nio/ByteBuffer.html#put(int,byte)" target="_blank">put(index, ...)</a></var></li><li><var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/nio/ReadOnlyBufferException.html" target="_blank">ReadOnlyBufferException</a></var><img class="bottom" src="pics/BufferGet.svg" /></li></ul></li></ul></div><div class="footer"><div class="test"><span class="author">Georgiy Korneev</span><span class="title">Технологии Java / Неблокирующий и асинхронный ввод-вывод</span><span class="number">4</span></div></div></div></div>
<div class="slide"><div class="content"><h1>Подготовка (1)</h1><div class="body"><ul class="item-1 level-1"><li>К записи <var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/nio/Buffer.html#clear()" target="_blank">clear()</a></var></li></ul><div class="img-width"><img class="width" style="width: 100%" src="pics/BufferClear.svg" /></div><ul class="item-1 level-1"><li>К чтению <var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/nio/Buffer.html#flip()" target="_blank">flip()</a></var></li></ul><div class="img-width"><img class="width" style="width: 100%" src="pics/BufferFlip.svg" /></div></div><div class="footer"><div class="test"><span class="author">Georgiy Korneev</span><span class="title">Технологии Java / Неблокирующий и асинхронный ввод-вывод</span><span class="number">5</span></div></div></div></div>
<div class="slide"><div class="content"><h1>Подготовка (2)</h1><div class="body"><ul class="item-1 level-1"><li>К повторному чтению <var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/nio/Buffer.html#rewind()" target="_blank">rewind()</a></var></li></ul><div class="img-width"><img class="width" style="width: 100%" src="pics/BufferRewind.svg" /></div><ul class="item-1 level-1"><li>К повторной записи <var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/nio/ByteBuffer.html#compact()" target="_blank">compact()</a></var></li></ul><div class="img-width"><img class="width" style="width: 100%" src="pics/BufferCompact.svg" /></div></div><div class="footer"><div class="test"><span class="author">Georgiy Korneev</span><span class="title">Технологии Java / Неблокирующий и асинхронный ввод-вывод</span><span class="number">6</span></div></div></div></div>
<div class="slide"><div class="content"><h1>Операции c пометками</h1><div class="body"><ul class="item-1 level-1"><li>Пометка <var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/nio/Buffer.html#mark()" target="_blank">mark()</a></var></li></ul><div class="img-width"><img class="width" style="width: 100%" src="pics/BufferMark.svg" /></div><ul class="item-1 level-1"><li>Возврат к пометке <var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/nio/Buffer.html#reset()" target="_blank">reset()</a></var></li></ul><div class="img-width"><img class="width" style="width: 100%" src="pics/BufferReset.svg" /></div></div><div class="footer"><div class="test"><span class="author">Georgiy Korneev</span><span class="title">Технологии Java / Неблокирующий и асинхронный ввод-вывод</span><span class="number">7</span></div></div></div></div>
<div class="slide"><div class="content"><h1>Типизированные буферы</h1><div class="body"><ul class="item-1 level-1"><li>Классы <var>TBuffer</var><ul class="item-2 level-2"><li><var>T</var>: <strong><var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/nio/ByteBuffer.html" target="_blank">Byte</a></var></strong>, <var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/nio/ShortBuffer.html" target="_blank">Short</a></var>, <var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/nio/CharBuffer.html" target="_blank">Char</a></var>, <var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/nio/IntBuffer.html" target="_blank">Int</a></var>, <var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/nio/LongBuffer.html" target="_blank">Long</a></var>, <var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/nio/FloatBuffer.html" target="_blank">Float</a></var>, <var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/nio/DoubleBuffer.html" target="_blank">Double</a></var></li></ul></li><li>Создание<ul class="item-2 level-2"><li><var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/nio/IntBuffer.html#allocate(int)" target="_blank">TBuffer.allocate(size)</a></var></li></ul></li><li>Конвертация (view)<ul class="item-2 level-2"><li><var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/nio/ByteBuffer.html#asIntBuffer()" target="_blank">byteBuffer.asTBuffer()</a></var></li></ul></li></ul></div><div class="footer"><div class="test"><span class="author">Georgiy Korneev</span><span class="title">Технологии Java / Неблокирующий и асинхронный ввод-вывод</span><span class="number">8</span></div></div></div></div>
<div class="slide"><div class="content"><h1>Байтовый буфер</h1><div class="body"><ul class="item-1 level-1"><li>Типизированное чтение<ul class="item-2 level-2"><li><var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/nio/ByteBuffer.html#getInt()" target="_blank">getT()</a></var>, <var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/nio/ByteBuffer.html#getInt(int)" target="_blank">getT(int)</a></var></li></ul></li><li>Типизированная запись<ul class="item-2 level-2"><li><var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/nio/ByteBuffer.html#putInt(int)" target="_blank">putT()</a></var>, <var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/nio/ByteBuffer.html#putInt(int,int)" target="_blank">putT(int, T)</a></var></li></ul></li><li>Порядок байт<ul class="item-2 level-2"><li><var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/nio/ByteBuffer.html#order()" target="_blank">order()</a></var>, <var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/nio/ByteBuffer.html#order(java.nio.ByteOrder)" target="_blank">order(byteOrder)</a></var></li><li><var>BIG</var>/<var>LITTLE_ENDIAN</var></li></ul></li></ul></div><div class="footer"><div class="test"><span class="author">Georgiy Korneev</span><span class="title">Технологии Java / Неблокирующий и асинхронный ввод-вывод</span><span class="number">9</span></div></div></div></div>
<div class="slide"><div class="content"><h1>Буферы на массиве</h1><div class="body"><ul class="item-1 level-1"><li>Создание<ul class="item-2 level-2"><li><var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/nio/ByteBuffer.html#wrap(byte[])" target="_blank">TBuffer.wrap(T[])</a></var> – пустой</li><li><var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/nio/ByteBuffer.html#wrap(byte[],int,int)" target="_blank">TBuffer.wrap(T[], offset, length)</a></var> – заполненный</li></ul></li><li>Проверка<ul class="item-2 level-2"><li><var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/nio/ByteBuffer.html#hasArray()" target="_blank">hasArray()</a></var></li></ul></li><li>Исходный массив<ul class="item-2 level-2"><li><var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/nio/ByteBuffer.html#array()" target="_blank">array()</a></var></li><li><var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/nio/ByteBuffer.html#arrayOffset()" target="_blank">arrayOffset()</a></var> – начало сдвинутого буфера в массиве</li></ul></li></ul></div><div class="footer"><div class="test"><span class="author">Georgiy Korneev</span><span class="title">Технологии Java / Неблокирующий и асинхронный ввод-вывод</span><span class="number">10</span></div></div></div></div>
<div class="slide"><div class="content"><h1>Непосредственные буферы</h1><div class="body"><ul class="item-1 level-1"><li>Создание<ul class="item-2 level-2"><li><var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/nio/ByteBuffer.html#allocateDirect(int)" target="_blank">allocateDirect(size)</a></var></li></ul></li><li>Типизированные<ul class="item-2 level-2"><li><var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/nio/ByteBuffer.html#asIntBuffer()" target="_blank">asTBuffer()</a></var></li></ul></li><li>Проверка<ul class="item-2 level-2"><li><var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/nio/IntBuffer.html#isDirect()" target="_blank">isDirect()</a></var></li></ul></li></ul></div><div class="footer"><div class="test"><span class="author">Georgiy Korneev</span><span class="title">Технологии Java / Неблокирующий и асинхронный ввод-вывод</span><span class="number">11</span></div></div></div></div>
<div class="slide section"><div class="content"><h1>Каналы</h1><h2>Содержание</h2><div class="body"><ol class="level-1 toc-1"><li><a href="#(2)" class="toc">Буферы</a></li><li><a href="#(12)" class="toc current">Каналы</a><ol class="level-2 toc-2"><li><a href="#(14)" class="">Файловые каналы</a></li><li><a href="#(24)" class="">Сетевые каналы и неблокирующий ввод-вывод</a></li><li><a href="#(40)" class="">Асинхронные каналы</a></li><li><a href="#(50)" class="">Прочее</a></li></ol></li><li><a href="#(52)" class="toc">Виртуальные потоки</a></li><li><a href="#(59)" class="toc">Заключение</a></li></ol></div><div class="footer"><div class="test"><span class="author">Georgiy Korneev</span><span class="title">Технологии Java / Неблокирующий и асинхронный ввод-вывод</span><span class="number">12</span></div></div></div></div>
<div class="slide"><div class="content"><h1>Канал</h1><div class="body"><ul class="item-1 level-1"><li>Открытое соединение с ресурсом</li><li>Интерфейс <var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/nio/channels/Channel.html" target="_blank">Channel</a></var></li><li>Бывает открытым и закрытым<ul class="item-2 level-2"><li>Проверить <var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/nio/channels/Channel.html#isOpen()" target="_blank">isOpen()</a></var></li><li>Закрыть <var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/nio/channels/Channel.html#close()" target="_blank">close()</a></var></li><li>Действие с закрытым каналом <var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/nio/channels/ClosedChannelException.html" target="_blank">ClosedChannelException</a></var></li></ul></li></ul></div><div class="footer"><div class="test"><span class="author">Georgiy Korneev</span><span class="title">Технологии Java / Неблокирующий и асинхронный ввод-вывод</span><span class="number">13</span></div></div></div></div>
<div class="slide subsection"><div class="content"><h1>Файловые каналы</h1><h2>Содержание</h2><div class="body"><ol class="level-1 toc-1"><li><a href="#(2)" class="toc">Буферы</a></li><li><a href="#(12)" class="toc current">Каналы</a><ol class="level-2 toc-2"><li><a href="#(14)" class=" current">Файловые каналы</a></li><li><a href="#(24)" class="">Сетевые каналы и неблокирующий ввод-вывод</a></li><li><a href="#(40)" class="">Асинхронные каналы</a></li><li><a href="#(50)" class="">Прочее</a></li></ol></li><li><a href="#(52)" class="toc">Виртуальные потоки</a></li><li><a href="#(59)" class="toc">Заключение</a></li></ol></div><div class="footer"><div class="test"><span class="author">Georgiy Korneev</span><span class="title">Технологии Java / Неблокирующий и асинхронный ввод-вывод</span><span class="number">14</span></div></div></div></div>
<div class="slide"><div class="content"><h1>Иерархия файловых каналов </h1><div class="body"><div class="img-width"><img class="width" style="width: 100%" src="pics/FileChannel.svg" /></div></div><div class="footer"><div class="test"><span class="author">Georgiy Korneev</span><span class="title">Технологии Java / Неблокирующий и асинхронный ввод-вывод</span><span class="number">15</span></div></div></div></div>
<div class="slide"><div class="content"><h1>Каналы ввода/вывода байт</h1><div class="body"><ul class="item-1 level-1"><li>Интерфейс <var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/nio/channels/ReadableByteChannel.html" target="_blank">ReadableByteChannel</a></var><ul class="item-2 level-2"><li><var>int <var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/nio/channels/ReadableByteChannel.html#read(java.nio.ByteBuffer)" target="_blank">read(byteBuffer)</a></var></var></li></ul></li><li>Интерфейс <var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/nio/channels/WritableByteChannel.html" target="_blank">WritableByteChannel</a></var><ul class="item-2 level-2"><li><var>int <var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/nio/channels/WritableByteChannel.html#write(java.nio.ByteBuffer)" target="_blank">write(byteBuffer)</a></var></var></li><li><em>Не всегда полностью</em></li></ul></li><li>Интерфейс <var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/nio/channels/ByteChannel.html" target="_blank">ByteChannel</a></var></li></ul><div class="img-width"><img class="width" style="width: 100%" src="pics/ByteChannel.svg" /></div></div><div class="footer"><div class="test"><span class="author">Georgiy Korneev</span><span class="title">Технологии Java / Неблокирующий и асинхронный ввод-вывод</span><span class="number">16</span></div></div></div></div>
<div class="slide"><div class="content"><h1>Каналы массового ввода/вывода</h1><div class="body"><ul class="item-1 level-1"><li>Интерфейс <var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/nio/channels/ScatteringByteChannel.html" target="_blank">ScatteringByteChannel</a></var><ul class="item-2 level-2"><li><var>long <var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/nio/channels/ScatteringByteChannel.html#read(java.nio.ByteBuffer[])" target="_blank">read(buffers)</a></var></var></li><li><var>long <var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/nio/channels/ScatteringByteChannel.html#read(java.nio.ByteBuffer[],int,int)" target="_blank">read(buffers, offset, length)</a></var></var></li></ul></li><li>Интерфейс <var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/nio/channels/GatheringByteChannel.html" target="_blank">GatheringByteChannel</a></var><ul class="item-2 level-2"><li><var>long <var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/nio/channels/GatheringByteChannel.html#write(java.nio.ByteBuffer[])" target="_blank">write(buffers)</a></var></var></li><li><var>long <var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/nio/channels/GatheringByteChannel.html#write(java.nio.ByteBuffer[],int,int)" target="_blank">write(buffers, offset, length)</a></var></var></li></ul></li></ul><div class="img-width"><img class="width" style="width: 100%" src="pics/ScatterGatherChannel.svg" /></div></div><div class="footer"><div class="test"><span class="author">Georgiy Korneev</span><span class="title">Технологии Java / Неблокирующий и асинхронный ввод-вывод</span><span class="number">17</span></div></div></div></div>
<div class="slide"><div class="content"><h1>Управляемый канал</h1><div class="body"><ul class="item-1 level-1"><li>Интерфейс <var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/nio/channels/SeekableByteChannel.html" target="_blank">SeekableByteChannel</a></var><ul class="item-2 level-2"><li>Текущая позиция <var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/nio/channels/SeekableByteChannel.html#position()" target="_blank">position()</a></var>, <var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/nio/channels/SeekableByteChannel.html#position(long)" target="_blank">position(long)</a></var></li><li>Размер <var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/nio/channels/SeekableByteChannel.html#size()" target="_blank">size()</a></var></li><li>Уменьшение размера <var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/nio/channels/SeekableByteChannel.html#truncate(long)" target="_blank">truncate(long)</a></var></li></ul></li></ul></div><div class="footer"><div class="test"><span class="author">Georgiy Korneev</span><span class="title">Технологии Java / Неблокирующий и асинхронный ввод-вывод</span><span class="number">18</span></div></div></div></div>
<div class="slide"><div class="content"><h1>Прерываемый канал</h1><div class="body"><ul class="item-1 level-1"><li>Интерфейс <var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/nio/channels/InterruptibleChannel.html" target="_blank">InterruptibleChannel</a></var></li><li>Может быть асинхронно закрыт<ul class="item-2 level-2"><li>Ожидающие ввода-вывода получают <var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/nio/channels/AsynchronousCloseException.html" target="_blank">AsynchronousCloseException</a></var></li></ul></li><li>Ожидающие потоки можно прервать<ul class="item-2 level-2"><li><var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/lang/Thread.html#interrupt()" target="_blank">Thread.interrupt()</a></var></li><li>Канал закрывается</li><li>Поток получает <var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/nio/channels/ClosedByInterruptException.html" target="_blank">ClosedByInterruptException</a></var></li></ul></li><li><span class="question">Как узнать во время исполнения?</span><ul class="item-2 level-2"><li class="incremental"><div class="non-incremental"><var>instanceof</var></div></li></ul></li></ul></div><div class="footer"><div class="test"><span class="author">Georgiy Korneev</span><span class="title">Технологии Java / Неблокирующий и асинхронный ввод-вывод</span><span class="number">19</span></div></div></div></div>
<div class="slide"><div class="content"><h1>Файловые каналы</h1><div class="body"><ul class="item-1 level-1"><li>Класс <var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/nio/channels/FileChannel.html" target="_blank">FileChannel</a></var><ul class="item-2 level-2"><li>Отображение в память</li><li>Потокобезопасность на блокировках</li></ul></li><li>Получение<ul class="item-2 level-2"><li><var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/nio/channels/FileChannel.html#open(java.nio.file.Path,java.nio.file.OpenOption...)" target="_blank">FileChannel.open(path, options...)</a></var></li><li><var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/io/FileInputStream.html#getChannel()" target="_blank">fileInputStream.getChannel()</a></var></li><li><var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/io/FileOutputStream.html#getChannel()" target="_blank">fileOutputStream.getChannel()</a></var></li><li><var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/io/RandomAccessFile.html#getChannel()" target="_blank">randomAccessFile.getChannel()</a></var></li></ul></li></ul></div><div class="footer"><div class="test"><span class="author">Georgiy Korneev</span><span class="title">Технологии Java / Неблокирующий и асинхронный ввод-вывод</span><span class="number">20</span></div></div></div></div>
<div class="slide"><div class="content"><h1>Операции</h1><div class="body"><ul class="item-1 level-1"><li>Абсолютные чтение и запись<ul class="item-2 level-2"><li>Чтение <var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/nio/channels/FileChannel.html#read(java.nio.ByteBuffer,long)" target="_blank">read(buffer, position)</a></var></li><li>Запись <var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/nio/channels/FileChannel.html#write(java.nio.ByteBuffer,long)" target="_blank">write(buffer, position)</a></var></li></ul></li><li>Сброс кэшей<ul class="item-2 level-2"><li>Всех <var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/nio/channels/FileChannel.html#force(boolean)" target="_blank">force(true)</a></var></li><li>Без метаданных <var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/nio/channels/FileChannel.html#force(boolean)" target="_blank">force(false)</a></var></li></ul></li><li>Передача данных<ul class="item-2 level-2"><li>От себя <var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/nio/channels/FileChannel.html#transferTo(long,long,java.nio.channels.WritableByteChannel)" target="_blank">transferTo(position, n, writableBC)</a></var></li><li>К себе <var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/nio/channels/FileChannel.html#transferFrom(java.nio.channels.ReadableByteChannel,long,long)" target="_blank">transferFrom(readableBC, position, n)</a></var></li></ul></li></ul></div><div class="footer"><div class="test"><span class="author">Georgiy Korneev</span><span class="title">Технологии Java / Неблокирующий и асинхронный ввод-вывод</span><span class="number">21</span></div></div></div></div>
<div class="slide"><div class="content"><h1>Отображение в память</h1><div class="body"><ul class="item-1 level-1"><li>Метод <var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/nio/channels/FileChannel.html#map(java.nio.channels.FileChannel.MapMode,long,long)" target="_blank">map(mode, position, size)</a></var></li><li>Режимы<ul class="item-2 level-2"><li>Только для чтения <var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/nio/channels/FileChannel.MapMode.html#READ_ONLY" target="_blank">READ_ONLY</a></var></li><li>Копирование при записи <var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/nio/channels/FileChannel.MapMode.html#PRIVATE" target="_blank">PRIVATE</a></var></li><li>Разделяемый режим <var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/nio/channels/FileChannel.MapMode.html#READ_WRITE" target="_blank">READ_WRITE</a></var></li></ul></li><li>Класс <var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/nio/MappedByteBuffer.html" target="_blank">MappedByteBuffer</a></var><ul class="item-2 level-2"><li>Запись изменений <var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/nio/MappedByteBuffer.html#force()" target="_blank">force()</a></var></li><li>Загрузить целиком <var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/nio/MappedByteBuffer.html#load()" target="_blank">load()</a></var></li></ul></li></ul></div><div class="footer"><div class="test"><span class="author">Georgiy Korneev</span><span class="title">Технологии Java / Неблокирующий и асинхронный ввод-вывод</span><span class="number">22</span></div></div></div></div>
<div class="slide"><div class="content"><h1>Файловые блокировки</h1><div class="body"><ul class="item-1 level-1"><li>Класс <var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/nio/channels/FileLock.html" target="_blank">FileLock</a></var></li><li>Создание<ul class="item-2 level-2"><li><var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/nio/channels/FileChannel.html#lock(long,long,boolean)" target="_blank">fileChannel.lock(position, size, shared)</a></var></li><li><var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/nio/channels/FileChannel.html#tryLock(long,long,boolean)" target="_blank">fileChannel.tryLock(position, size, shared)</a></var></li></ul></li><li>Свойства<ul class="item-2 level-2"><li>Канал <var><var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/nio/channels/Channel.html" target="_blank">Channel</a></var> <var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/nio/channels/FileLock.html#acquiredBy()" target="_blank">acquiredBy()</a></var></var></li><li>Место и размер <var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/nio/channels/FileLock.html#position()" target="_blank">position()</a></var>, <var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/nio/channels/FileLock.html#size()" target="_blank">size()</a></var></li><li>Разделяемость <var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/nio/channels/FileLock.html#isShared()" target="_blank">isShared()</a></var></li><li>Корректность (не отпущена и канал не закрыт) <var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/nio/channels/FileLock.html#isValid()" target="_blank">isValid()</a></var></li></ul></li><li>Отпустить <var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/nio/channels/FileLock.html#release()" target="_blank">release()</a></var></li></ul></div><div class="footer"><div class="test"><span class="author">Georgiy Korneev</span><span class="title">Технологии Java / Неблокирующий и асинхронный ввод-вывод</span><span class="number">23</span></div></div></div></div>
<div class="slide subsection"><div class="content"><h1>Сетевые каналы и неблокирующий ввод-вывод</h1><h2>Содержание</h2><div class="body"><ol class="level-1 toc-1"><li><a href="#(2)" class="toc">Буферы</a></li><li><a href="#(12)" class="toc current">Каналы</a><ol class="level-2 toc-2"><li><a href="#(14)" class="">Файловые каналы</a></li><li><a href="#(24)" class=" current">Сетевые каналы и неблокирующий ввод-вывод</a></li><li><a href="#(40)" class="">Асинхронные каналы</a></li><li><a href="#(50)" class="">Прочее</a></li></ol></li><li><a href="#(52)" class="toc">Виртуальные потоки</a></li><li><a href="#(59)" class="toc">Заключение</a></li></ol></div><div class="footer"><div class="test"><span class="author">Georgiy Korneev</span><span class="title">Технологии Java / Неблокирующий и асинхронный ввод-вывод</span><span class="number">24</span></div></div></div></div>
<div class="slide"><div class="content"><h1>Иерархия сетевых каналов </h1><div class="body"><div class="img-width"><img class="width" style="width: 100%" src="pics/SocketChannel.svg" /></div></div><div class="footer"><div class="test"><span class="author">Georgiy Korneev</span><span class="title">Технологии Java / Неблокирующий и асинхронный ввод-вывод</span><span class="number">25</span></div></div></div></div>
<div class="slide"><div class="content"><h1>Сетевые каналы</h1><div class="body"><ul class="item-1 level-1"><li>Класс <var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/nio/channels/NetworkChannel.html" target="_blank">NetworkChannel</a></var></li><li>Привязка к порту<ul class="item-2 level-2"><li>Привязать <var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/nio/channels/NetworkChannel.html#bind(java.net.SocketAddress)" target="_blank">bind(socketAddress)</a></var></li><li>Узнать порт <var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/nio/channels/NetworkChannel.html#getLocalAddress()" target="_blank">getLocalAddress()</a></var></li></ul></li><li>Настройки<ul class="item-2 level-2"><li>Установить <var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/nio/channels/NetworkChannel.html#setOption(java.net.SocketOption,T)" target="_blank">setOption(socketOption, value)</a></var></li><li>Узнать <var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/nio/channels/NetworkChannel.html#getOption(java.net.SocketOption)" target="_blank">getOption(socketOption)</a></var></li><li>Существующие настройки <var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/nio/channels/NetworkChannel.html#supportedOptions()" target="_blank">supportedOptions()</a></var></li></ul></li></ul></div><div class="footer"><div class="test"><span class="author">Georgiy Korneev</span><span class="title">Технологии Java / Неблокирующий и асинхронный ввод-вывод</span><span class="number">26</span></div></div></div></div>
<div class="slide"><div class="content"><h1>Сетевые настройки</h1><div class="body"><ul class="item-1 level-1"><li>Класс <var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/net/SocketOption.html" target="_blank">SocketOption&lt;T&gt;</a></var></li><li>Класс <var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/net/StandardSocketOptions.html" target="_blank">StandardSocketOptions</a></var><ul class="item-2 level-2"><li>Размер приёмного буфера <var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/net/StandardSocketOptions.html#SO_RCVBUF" target="_blank">SO_RCVBUF</a></var></li><li>Переиспользование адреса <var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/net/StandardSocketOptions.html#SO_REUSEADDR" target="_blank">SO_REUSEADDR</a></var></li></ul></li></ul></div><div class="footer"><div class="test"><span class="author">Georgiy Korneev</span><span class="title">Технологии Java / Неблокирующий и асинхронный ввод-вывод</span><span class="number">27</span></div></div></div></div>
<div class="slide"><div class="content"><h1>Селекторы </h1><div class="body"><div class="img-width"><img class="width" style="width: 100%" src="pics/SelectorComponents.svg" /></div></div><div class="footer"><div class="test"><span class="author">Georgiy Korneev</span><span class="title">Технологии Java / Неблокирующий и асинхронный ввод-вывод</span><span class="number">28</span></div></div></div></div>
<div class="slide"><div class="content"><h1>Работа с селектором </h1><div class="body"><div class="img-width"><img class="width" style="width: 100%" src="pics/SelectorSequence.svg" /></div></div><div class="footer"><div class="test"><span class="author">Georgiy Korneev</span><span class="title">Технологии Java / Неблокирующий и асинхронный ввод-вывод</span><span class="number">29</span></div></div></div></div>
<div class="slide"><div class="content"><h1>Неблокирующий ввод-вывод</h1><div class="body"><ul class="item-1 level-1"><li>Класс <var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/nio/channels/SelectableChannel.html" target="_blank">SelectableChannel</a></var></li><li>Режим блокировки<ul class="item-2 level-2"><li>Изменение <var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/nio/channels/SelectableChannel.html#configureBlocking(boolean)" target="_blank">configureBlocking(boolean)</a></var></li><li>Проверка <var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/nio/channels/SelectableChannel.html#isBlocking()" target="_blank">isBlocking()</a></var></li></ul></li><li>Регистрация<ul class="item-2 level-2"><li>Зарегистрироваться <var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/nio/channels/SelectableChannel.html#register(java.nio.channels.Selector,int,java.lang.Object)" target="_blank">register(selector, ops, context)</a></var></li><li>Проверить <var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/nio/channels/SelectableChannel.html#isRegistered()" target="_blank">isRegistered()</a></var></li><li>Сертификат <var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/nio/channels/SelectableChannel.html#keyFor(java.nio.channels.Selector)" target="_blank">keyFor(selector)</a></var></li></ul></li></ul></div><div class="footer"><div class="test"><span class="author">Georgiy Korneev</span><span class="title">Технологии Java / Неблокирующий и асинхронный ввод-вывод</span><span class="number">30</span></div></div></div></div>
<div class="slide"><div class="content"><h1>Доступные операции</h1><div class="body"><ul class="item-1 level-1"><li>Класс <var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/nio/channels/SelectionKey.html" target="_blank">SelectionKey</a></var></li><li>Операции<ul class="item-2 level-2"><li>Запись <var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/nio/channels/SelectionKey.html#OP_READ" target="_blank">OP_READ</a></var></li><li>Чтение <var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/nio/channels/SelectionKey.html#OP_WRITE" target="_blank">OP_WRITE</a></var></li><li>Установление соединения <var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/nio/channels/SelectionKey.html#OP_CONNECT" target="_blank">OP_CONNECT</a></var></li><li>Ожидание соединения <var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/nio/channels/SelectionKey.html#OP_ACCEPT" target="_blank">OP_ACCEPT</a></var></li></ul></li></ul></div><div class="footer"><div class="test"><span class="author">Georgiy Korneev</span><span class="title">Технологии Java / Неблокирующий и асинхронный ввод-вывод</span><span class="number">31</span></div></div></div></div>
<div class="slide"><div class="content"><h1>Селекторы</h1><div class="body"><ul class="item-1 level-1"><li>Класс <var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/nio/channels/Selector.html" target="_blank">Selector</a></var><ul class="item-2 level-2"><li>Создание <var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/nio/channels/Selector.html#open()" target="_blank">Selector.open()</a></var></li></ul></li><li>Методы<ul class="item-2 level-2"><li>Ожидание <var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/nio/channels/Selector.html#select(long)" target="_blank">select(timeout?)</a></var></li><li>Обработка <var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/nio/channels/Selector.html#select(java.util.function.Consumer,long)" target="_blank">select(consumer&lt;SelectionKey&gt;, timeout?)</a></var></li><li>Сколько готовых <var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/nio/channels/Selector.html#selectNow()" target="_blank">selectNow()</a></var></li><li>Получить готовых <var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/nio/channels/Selector.html#selectedKeys()" target="_blank">selectedKeys()</a></var></li><li>Разбудить ждущего <var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/nio/channels/Selector.html#wakeup()" target="_blank">wakeup()</a></var></li></ul></li></ul></div><div class="footer"><div class="test"><span class="author">Georgiy Korneev</span><span class="title">Технологии Java / Неблокирующий и асинхронный ввод-вывод</span><span class="number">32</span></div></div></div></div>
<div class="slide"><div class="content"><h1>Готовые действия</h1><div class="body"><ul class="item-1 level-1"><li>Класс <var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/nio/channels/SelectionKey.html" target="_blank">SelectionKey</a></var></li><li>Методы<ul class="item-2 level-2"><li>Контекст <var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/nio/channels/SelectionKey.html#attachment()" target="_blank">attachment()</a></var>, <var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/nio/channels/SelectionKey.html#attach(java.lang.Object)" target="_blank">attach(context)</a></var></li><li>Доступные действия <var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/nio/channels/SelectionKey.html#readyOps()" target="_blank">readyOps()</a></var>, <var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/nio/channels/SelectionKey.html#isReadable()" target="_blank">isReadable()</a></var>, <var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/nio/channels/SelectionKey.html#isWritable()" target="_blank">isWritable()</a></var>, <var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/nio/channels/SelectionKey.html#isConnectable()" target="_blank">isConnectable()</a></var>, <var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/nio/channels/SelectionKey.html#isAcceptable()" target="_blank">isAcceptable()</a></var></li><li>Множество интересов <var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/nio/channels/SelectionKey.html#interestOps()" target="_blank">interestOps()</a></var>, <var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/nio/channels/SelectionKey.html#interestOps(int)" target="_blank">interestOps(ops)</a></var></li><li>Канал <var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/nio/channels/SelectionKey.html#channel()" target="_blank">channel()</a></var></li><li>Селектор <var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/nio/channels/SelectionKey.html#selector()" target="_blank">selector()</a></var></li></ul></li></ul></div><div class="footer"><div class="test"><span class="author">Georgiy Korneev</span><span class="title">Технологии Java / Неблокирующий и асинхронный ввод-вывод</span><span class="number">33</span></div></div></div></div>
<div class="slide"><div class="content"><h1>Пример 1</h1><div class="body"><ul class="item-2 level-2"><li><pre class="prettyprint lang-java">while (!Thread.interrupted()) {
    selector.select();
    for (final Iterator&lt;SelectionKey&gt; i =
            selector.selectedKeys().iterator(); i.hasNext(); ) {
        final SelectionKey key = i.next();
        try {
            if (key.isAcceptable()) {
                final ServerSocketChannel serverChannel =
                    (ServerSocketChannel) key.channel();
                handle(serverChannel.accept());
            }
        } finally {
            i.remove();
        }
    }
}
</pre></li></ul></div><div class="footer"><div class="test"><span class="author">Georgiy Korneev</span><span class="title">Технологии Java / Неблокирующий и асинхронный ввод-вывод</span><span class="number">34</span></div></div></div></div>
<div class="slide"><div class="content"><h1>Пример 2</h1><div class="body"><ul class="item-2 level-2"><li><pre class="prettyprint lang-java">while (!Thread.interrupted()) {
    selector.select(key -&gt; {
        try {
            if (key.isAcceptable()) {
                final ServerSocketChannel serverChannel =
                    (ServerSocketChannel) key.channel();
                handle(serverChannel.accept());
            }
        } catch (final IOException e) {
            throw new UncheckedIOException(e);
        }
    });
}
</pre></li></ul></div><div class="footer"><div class="test"><span class="author">Georgiy Korneev</span><span class="title">Технологии Java / Неблокирующий и асинхронный ввод-вывод</span><span class="number">35</span></div></div></div></div>
<div class="slide"><div class="content"><h1>Каналы сокетов</h1><div class="body"><ul class="item-1 level-1"><li>Класс <var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/nio/channels/SocketChannel.html" target="_blank">SocketChannel</a></var></li><li>Создание<ul class="item-2 level-2"><li>Не привязанный <var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/nio/channels/SocketChannel.html#open()" target="_blank">SocketChannel.open()</a></var></li><li>Подсоединенный <var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/nio/channels/SocketChannel.html#open(java.net.SocketAddress)" target="_blank">SocketChannel.open(socketAddress)</a></var></li></ul></li><li>Соединение<ul class="item-2 level-2"><li>Установить <var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/nio/channels/SocketChannel.html#connect(java.net.SocketAddress)" target="_blank">connect(socketAddress)</a></var></li><li>Проверить <var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/nio/channels/SocketChannel.html#isConnected()" target="_blank">isConnected()</a></var>, <var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/nio/channels/SocketChannel.html#isConnectionPending()" target="_blank">isConnectionPending()</a></var></li><li>Дождаться <var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/nio/channels/SocketChannel.html#finishConnect()" target="_blank">finishConnect()</a></var></li></ul></li><li>Прочее<ul class="item-2 level-2"><li>Получить сокет <var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/nio/channels/SocketChannel.html#socket()" target="_blank">socket()</a></var></li><li>Прекратить <var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/nio/channels/SocketChannel.html#shutdownInput()" target="_blank">shutdownInput()</a></var>, <var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/nio/channels/SocketChannel.html#shutdownOutput()" target="_blank">shutdownOutput()</a></var></li></ul></li></ul></div><div class="footer"><div class="test"><span class="author">Georgiy Korneev</span><span class="title">Технологии Java / Неблокирующий и асинхронный ввод-вывод</span><span class="number">36</span></div></div></div></div>
<div class="slide"><div class="content"><h1>Иерархия каналов (3) </h1><div class="body"><div class="img-width"><img class="width" style="width: 100%" src="pics/DatagramChannel.svg" /></div></div><div class="footer"><div class="test"><span class="author">Georgiy Korneev</span><span class="title">Технологии Java / Неблокирующий и асинхронный ввод-вывод</span><span class="number">37</span></div></div></div></div>
<div class="slide"><div class="content"><h1>Датаграммные каналы</h1><div class="body"><ul class="item-1 level-1"><li>Класс <var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/nio/channels/DatagramChannel.html" target="_blank">DatagramChannel</a></var><ul class="item-2 level-2"><li><var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/nio/channels/DatagramChannel.html#open()" target="_blank">DatagramChannel.open()</a></var></li></ul></li><li>Соединение<ul class="item-2 level-2"><li>Установить <var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/nio/channels/DatagramChannel.html#connect(java.net.SocketAddress)" target="_blank">connect(socketAddress)</a></var></li><li>Проверить <var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/nio/channels/DatagramChannel.html#isConnected()" target="_blank">isConnected()</a></var></li><li>Разорвать <var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/nio/channels/DatagramChannel.html#disconnect()" target="_blank">disconnect()</a></var></li></ul></li><li>Прочее<ul class="item-2 level-2"><li>Получить сокет <var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/nio/channels/DatagramChannel.html#socket()" target="_blank">socket()</a></var></li><li>Послать пакет <var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/nio/channels/DatagramChannel.html#send(java.nio.ByteBuffer,java.net.SocketAddress)" target="_blank">send(buffer, socketAddress)</a></var></li><li>Получить пакет <var><var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/net/SocketAddress.html" target="_blank">SocketAddress</a></var> <var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/nio/channels/DatagramChannel.html#receive(java.nio.ByteBuffer)" target="_blank">receive(buffer)</a></var></var></li></ul></li></ul></div><div class="footer"><div class="test"><span class="author">Georgiy Korneev</span><span class="title">Технологии Java / Неблокирующий и асинхронный ввод-вывод</span><span class="number">38</span></div></div></div></div>
<div class="slide"><div class="content"><h1>Пайпы</h1><div class="body"><ul class="item-1 level-1"><li>Класс <var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/nio/channels/Pipe.html" target="_blank">Pipe</a></var><ul class="item-2 level-2"><li>Создание <var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/nio/channels/Pipe.html#open()" target="_blank">Pipe.open()</a></var></li></ul></li><li>Каналы<ul class="item-2 level-2"><li>Ввода <var><var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/nio/channels/Pipe.SourceChannel.html" target="_blank">Pipe.SourceChannel</a></var> <var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/nio/channels/Pipe.html#source()" target="_blank">source()</a></var></var></li><li>Вывода <var><var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/nio/channels/Pipe.SinkChannel.html" target="_blank">Pipe.SinkChannel</a></var> <var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/nio/channels/Pipe.html#sink()" target="_blank">sink()</a></var></var></li></ul></li></ul></div><div class="footer"><div class="test"><span class="author">Georgiy Korneev</span><span class="title">Технологии Java / Неблокирующий и асинхронный ввод-вывод</span><span class="number">39</span></div></div></div></div>
<div class="slide subsection"><div class="content"><h1>Асинхронные каналы</h1><h2>Содержание</h2><div class="body"><ol class="level-1 toc-1"><li><a href="#(2)" class="toc">Буферы</a></li><li><a href="#(12)" class="toc current">Каналы</a><ol class="level-2 toc-2"><li><a href="#(14)" class="">Файловые каналы</a></li><li><a href="#(24)" class="">Сетевые каналы и неблокирующий ввод-вывод</a></li><li><a href="#(40)" class=" current">Асинхронные каналы</a></li><li><a href="#(50)" class="">Прочее</a></li></ol></li><li><a href="#(52)" class="toc">Виртуальные потоки</a></li><li><a href="#(59)" class="toc">Заключение</a></li></ol></div><div class="footer"><div class="test"><span class="author">Georgiy Korneev</span><span class="title">Технологии Java / Неблокирующий и асинхронный ввод-вывод</span><span class="number">40</span></div></div></div></div>
<div class="slide"><div class="content"><h1>Иерархия асинхронных каналов </h1><div class="body"><div class="img-width"><img class="width" style="width: 100%" src="pics/AsyncChannels.svg" /></div></div><div class="footer"><div class="test"><span class="author">Georgiy Korneev</span><span class="title">Технологии Java / Неблокирующий и асинхронный ввод-вывод</span><span class="number">41</span></div></div></div></div>
<div class="slide"><div class="content"><h1>Асинхронный ввод/вывод</h1><div class="body"><ul class="item-1 level-1"><li>Интерфейс <var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/nio/channels/AsynchronousChannel.html" target="_blank">AsynchronousChannel</a></var></li><li>Операция<ul class="item-2 level-2"><li>Результат типа <var>V</var></li><li><var><var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/util/concurrent/Future.html" target="_blank">Future</a></var>&lt;V&gt; op(...)</var></li><li><var>op(..., A attachment, <var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/nio/channels/CompletionHandler.html" target="_blank">CompletionHandler</a></var>&lt;V, A&gt;)</var></li></ul></li><li>Отмена операции<ul class="item-2 level-2"><li><var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/util/concurrent/Future.html#cancel(boolean)" target="_blank">cancel(mayInterruptWhenRunning)</a></var></li><li>Операция выполнена частично ⇒ всё сломалось, повторить нельзя</li></ul></li></ul></div><div class="footer"><div class="test"><span class="author">Georgiy Korneev</span><span class="title">Технологии Java / Неблокирующий и асинхронный ввод-вывод</span><span class="number">42</span></div></div></div></div>
<div class="slide"><div class="content"><h1>Обработка результата</h1><div class="body"><ul class="item-1 level-1"><li>Интерфейс <var><var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/nio/channels/CompletionHandler.html" target="_blank">CompletionHandler</a></var>&lt;V, A&gt;</var></li><li>Возможные результаты<ul class="item-2 level-2"><li>Успех <var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/nio/channels/CompletionHandler.html#completed(V,A)" target="_blank">completed(V value, A att)</a></var></li><li>Ошибка <var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/nio/channels/CompletionHandler.html#failed(java.lang.Throwable,A)" target="_blank">failed(throwable, A att)</a></var></li></ul></li></ul></div><div class="footer"><div class="test"><span class="author">Georgiy Korneev</span><span class="title">Технологии Java / Неблокирующий и асинхронный ввод-вывод</span><span class="number">43</span></div></div></div></div>
<div class="slide"><div class="content"><h1>Пример</h1><div class="body"><ul class="item-2 level-2"><li><pre class="prettyprint lang-java">socketChannel.read(
    buffer,
    context,
    new CompletionHandler&lt;Integer, Context&gt;() {
        public void completed(Integer result, Context context) {
            if (context.process(result)) {
                socketChannel.read(buffer, this);
            }
        }
        public void failed(Throwable e, Context context) {
            context.error(e);
        }
    }
);
</pre></li></ul></div><div class="footer"><div class="test"><span class="author">Georgiy Korneev</span><span class="title">Технологии Java / Неблокирующий и асинхронный ввод-вывод</span><span class="number">44</span></div></div></div></div>
<div class="slide"><div class="content"><h1>Асинхронный байтовый канал</h1><div class="body"><ul class="item-1 level-1"><li>Интерфейс <var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/nio/channels/AsynchronousByteChannel.html" target="_blank">AsynchronousByteChannel</a></var></li><li>Операции<ul class="item-2 level-2"><li>Чтение <var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/nio/channels/AsynchronousByteChannel.html#read(java.nio.ByteBuffer)" target="_blank">read(buffer)</a></var>, <var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/nio/channels/AsynchronousByteChannel.html#read(java.nio.ByteBuffer,A,java.nio.channels.CompletionHandler)" target="_blank">read(buffer, att, handler)</a></var></li><li>Запись <var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/nio/channels/AsynchronousByteChannel.html#write(java.nio.ByteBuffer)" target="_blank">write(buffer)</a></var>, <var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/nio/channels/AsynchronousByteChannel.html#write(java.nio.ByteBuffer,A,java.nio.channels.CompletionHandler)" target="_blank">write(buffer, att, handler)</a></var></li><li>Результат <var>❬<var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/lang/Integer.html" target="_blank">Integer</a></var>❭ n</var> — число байт</li><li>Параллельная запись может не поддерживаться </li></ul></li></ul><div class="img-width"><img class="width" style="width: 100%" src="pics/ByteChannel.svg" /></div></div><div class="footer"><div class="test"><span class="author">Georgiy Korneev</span><span class="title">Технологии Java / Неблокирующий и асинхронный ввод-вывод</span><span class="number">45</span></div></div></div></div>
<div class="slide"><div class="content"><h1>Асинхронный сокетный канал</h1><div class="body"><ul class="item-1 level-1"><li>Класс <var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/nio/channels/AsynchronousSocketChannel.html" target="_blank">AsynchronousSocketChannel</a></var></li><li>Создание<ul class="item-2 level-2"><li>Не привязанный <var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/nio/channels/AsynchronousSocketChannel.html#open()" target="_blank">ASC.open()</a></var></li></ul></li><li>Действия<ul class="item-2 level-2"><li>Привязать <var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/nio/channels/AsynchronousSocketChannel.html#bind(java.net.SocketAddress)" target="_blank">bind(socketAddress)</a></var></li><li>Прекратить ввод <var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/nio/channels/AsynchronousSocketChannel.html#shutdownInput()" target="_blank">shutdownInput()</a></var>,</li><li>Прекратить вывод <var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/nio/channels/AsynchronousSocketChannel.html#shutdownOutput()" target="_blank">shutdownOutput()</a></var></li></ul></li><li>Установить соединение<ul class="item-2 level-2"><li><var>❬<var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/lang/Void.html" target="_blank">Void</a></var>❭ <var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/nio/channels/AsynchronousSocketChannel.html#connect(java.net.SocketAddress)" target="_blank">connect(socketAddress, ...)</a></var></var></li></ul></li></ul></div><div class="footer"><div class="test"><span class="author">Georgiy Korneev</span><span class="title">Технологии Java / Неблокирующий и асинхронный ввод-вывод</span><span class="number">46</span></div></div></div></div>
<div class="slide"><div class="content"><h1>Асинхронный серверный канал</h1><div class="body"><ul class="item-1 level-1"><li>Класс <var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/nio/channels/AsynchronousServerSocketChannel.html" target="_blank">AsynchronousServerSocketChannel</a></var></li><li>Создание<ul class="item-2 level-2"><li>Не привязанный <var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/nio/channels/AsynchronousServerSocketChannel.html#open()" target="_blank">ASSC.open()</a></var></li></ul></li><li>Действия<ul class="item-2 level-2"><li>Привязать <var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/nio/channels/AsynchronousServerSocketChannel.html#bind(java.net.SocketAddress,int)" target="_blank">bind(socketAddress, backlog?)</a></var></li></ul></li><li>Установить соединение<ul class="item-2 level-2"><li><var>❬<var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/nio/channels/AsynchronousSocketChannel.html" target="_blank">AsynchronousSocketChannel</a></var>❭ <var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/nio/channels/AsynchronousServerSocketChannel.html#accept()" target="_blank">accept(...)</a></var></var></li><li><var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/nio/channels/AcceptPendingException.html" target="_blank">AcceptPendingException</a></var></li></ul></li></ul></div><div class="footer"><div class="test"><span class="author">Georgiy Korneev</span><span class="title">Технологии Java / Неблокирующий и асинхронный ввод-вывод</span><span class="number">47</span></div></div></div></div>
<div class="slide"><div class="content"><h1>Асинхронный файловый канал</h1><div class="body"><ul class="item-1 level-1"><li>Класс <var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/nio/channels/AsynchronousFileChannel.html" target="_blank">AsynchronousFileChannel</a></var><ul class="item-2 level-2"><li>Создание <var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/nio/channels/AsynchronousFileChannel.html#open(java.nio.file.Path,java.nio.file.OpenOption...)" target="_blank">AFC.open(file, options...)</a></var></li></ul></li><li>Чтение и запись<ul class="item-2 level-2"><li><var>❬<var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/lang/Integer.html" target="_blank">Integer</a></var>❭ <var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/nio/channels/AsynchronousFileChannel.html#read(java.nio.ByteBuffer,long)" target="_blank">read(buffer, position, ...)</a></var></var></li><li><var>❬<var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/lang/Integer.html" target="_blank">Integer</a></var>❭ <var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/nio/channels/AsynchronousFileChannel.html#read(java.nio.ByteBuffer,long)" target="_blank">write(buffer, position, ...)</a></var></var></li></ul></li><li>Получить блокировку<ul class="item-2 level-2"><li><var>❬<var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/nio/channels/FileLock.html" target="_blank">FileLock</a></var>❭ <var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/nio/channels/AsynchronousFileChannel.html#lock()" target="_blank">lock(...)</a></var></var></li><li><var>❬<var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/nio/channels/FileLock.html" target="_blank">FileLock</a></var>❭ <var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/nio/channels/AsynchronousFileChannel.html#lock(long,long,boolean)" target="_blank">lock(position, size, shared, ...)</a></var></var></li></ul></li><li>Прочее<ul class="item-2 level-2"><li>Сброс кэшей <var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/nio/channels/AsynchronousFileChannel.html#force(boolean)" target="_blank">force(metaData)</a></var></li><li>Блокировка <var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/nio/channels/AsynchronousFileChannel.html#tryLock()" target="_blank">tryLock()</a></var>, <var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/nio/channels/AsynchronousFileChannel.html#tryLock(long,long,boolean)" target="_blank">tryLock(position, size, shared)</a></var></li></ul></li></ul></div><div class="footer"><div class="test"><span class="author">Georgiy Korneev</span><span class="title">Технологии Java / Неблокирующий и асинхронный ввод-вывод</span><span class="number">48</span></div></div></div></div>
<div class="slide"><div class="content"><h1>Группы асинхронных каналов</h1><div class="body"><ul class="item-1 level-1"><li>Класс <var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/nio/channels/AsynchronousChannelGroup.html" target="_blank">AsynchronousChannelGroup</a></var></li><li>Создание<ul class="item-2 level-2"><li><var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/nio/channels/AsynchronousChannelGroup.html#withThreadPool(java.util.concurrent.ExecutorService)" target="_blank">ACG.withThreadPool(executor)</a></var></li><li><var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/nio/channels/AsynchronousChannelGroup.html#withCachedThreadPool(java.util.concurrent.ExecutorService,int)" target="_blank">ACG.withCachedThreadPool(executor, min)</a></var></li><li><var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/nio/channels/AsynchronousChannelGroup.html#withFixedThreadPool(int,java.util.concurrent.ThreadFactory)" target="_blank">ACG.withFixedThreadPool(threads, threadFactory)</a></var></li></ul></li><li>Использование<ul class="item-2 level-2"><li><var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/nio/channels/AsynchronousServerSocketChannel.html#open(java.nio.channels.AsynchronousChannelGroup)" target="_blank">ASSC.open(group)</a></var>, <var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/nio/channels/AsynchronousSocketChannel.html#open(java.nio.channels.AsynchronousChannelGroup)" target="_blank">ASC.open(group)</a></var></li></ul></li><li>Завершение<ul class="item-2 level-2"><li><var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/nio/channels/AsynchronousChannelGroup.html#shutdown()" target="_blank">shutdown()</a></var>, <var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/nio/channels/AsynchronousChannelGroup.html#shutdownNow()" target="_blank">shutdownNow()</a></var>, <var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/nio/channels/AsynchronousChannelGroup.html#isShutdown()" target="_blank">isShutdown()</a></var></li><li><var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/nio/channels/AsynchronousChannelGroup.html#isTerminated()" target="_blank">isTerminated()</a></var>, <var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/nio/channels/AsynchronousChannelGroup.html#awaitTermination(long,java.util.concurrent.TimeUnit)" target="_blank">awaitTermination(time, unit)</a></var></li></ul></li></ul></div><div class="footer"><div class="test"><span class="author">Georgiy Korneev</span><span class="title">Технологии Java / Неблокирующий и асинхронный ввод-вывод</span><span class="number">49</span></div></div></div></div>
<div class="slide subsection"><div class="content"><h1>Прочее</h1><h2>Содержание</h2><div class="body"><ol class="level-1 toc-1"><li><a href="#(2)" class="toc">Буферы</a></li><li><a href="#(12)" class="toc current">Каналы</a><ol class="level-2 toc-2"><li><a href="#(14)" class="">Файловые каналы</a></li><li><a href="#(24)" class="">Сетевые каналы и неблокирующий ввод-вывод</a></li><li><a href="#(40)" class="">Асинхронные каналы</a></li><li><a href="#(50)" class=" current">Прочее</a></li></ol></li><li><a href="#(52)" class="toc">Виртуальные потоки</a></li><li><a href="#(59)" class="toc">Заключение</a></li></ol></div><div class="footer"><div class="test"><span class="author">Georgiy Korneev</span><span class="title">Технологии Java / Неблокирующий и асинхронный ввод-вывод</span><span class="number">50</span></div></div></div></div>
<div class="slide"><div class="content"><h1>Конвертация в/из потоков</h1><div class="body"><ul class="item-1 level-1"><li>Класс <var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/nio/channels/Channels.html" target="_blank">Channels</a></var></li><li>Канал из потока байт<ul class="item-2 level-2"><li><var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/nio/channels/Channels.html#newChannel(java.io.InputStream)" target="_blank">newChannel(inputStream)</a></var></li></ul></li><li>Поток байт из канала<ul class="item-2 level-2"><li><var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/nio/channels/Channels.html#newInputStream(java.nio.channels.ReadableByteChannel)" target="_blank">newInputStream(channel)</a></var></li><li><var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/nio/channels/Channels.html#newOutputStream(java.nio.channels.WritableByteChannel)" target="_blank">newOutputStream(channel)</a></var></li></ul></li><li>Поток символов из канала<ul class="item-2 level-2"><li><var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/nio/channels/Channels.html#newReader(java.nio.channels.ReadableByteChannel,java.lang.String)" target="_blank">newReader(channel, charset)</a></var></li><li><var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/nio/channels/Channels.html#newWriter(java.nio.channels.WritableByteChannel,java.lang.String)" target="_blank">newWriter(channel, charset)</a></var></li></ul></li></ul></div><div class="footer"><div class="test"><span class="author">Georgiy Korneev</span><span class="title">Технологии Java / Неблокирующий и асинхронный ввод-вывод</span><span class="number">51</span></div></div></div></div>
<div class="slide section"><div class="content"><h1>Виртуальные потоки</h1><h2>Содержание</h2><div class="body"><ol class="level-1 toc-1"><li><a href="#(2)" class="toc">Буферы</a></li><li><a href="#(12)" class="toc">Каналы</a></li><li><a href="#(52)" class="toc current">Виртуальные потоки</a></li><li><a href="#(59)" class="toc">Заключение</a></li></ol></div><div class="footer"><div class="test"><span class="author">Georgiy Korneev</span><span class="title">Технологии Java / Неблокирующий и асинхронный ввод-вывод</span><span class="number">52</span></div></div></div></div>
<div class="slide"><div class="content"><h1>Виртуальные потоки</h1><div class="body"><ul class="item-1 level-1"><li>Поток исполнения</li><li>Не системный</li><li>Исполняется в рамках системного<ul class="item-2 level-2"><li>Возможно — разных</li></ul></li><li>Состав<ul class="item-2 level-2"><li>Стек</li><li>Thread locals</li></ul></li></ul></div><div class="footer"><div class="test"><span class="author">Georgiy Korneev</span><span class="title">Технологии Java / Неблокирующий и асинхронный ввод-вывод</span><span class="number">53</span></div></div></div></div>
<div class="slide"><div class="content"><h1>История</h1><div class="body"><ul class="item-1 level-1"><li>Java 1.1‒1.3: Green threads</li><li>Java 19, 20: Preview</li><li>Java 21: Release</li></ul></div><div class="footer"><div class="test"><span class="author">Georgiy Korneev</span><span class="title">Технологии Java / Неблокирующий и асинхронный ввод-вывод</span><span class="number">54</span></div></div></div></div>
<div class="slide"><div class="content"><h1>Использование</h1><div class="body"><ul class="item-1 level-1"><li>Поток-на-запрос</li><li>Без пулинга</li><li>Короткое время жизни</li></ul></div><div class="footer"><div class="test"><span class="author">Georgiy Korneev</span><span class="title">Технологии Java / Неблокирующий и асинхронный ввод-вывод</span><span class="number">55</span></div></div></div></div>
<div class="slide"><div class="content"><h1>Пример</h1><div class="body"><ul class="item-1 level-1"><li>Создание 10 000 потоков <pre class="prettyprint lang-java">try (
  ExecutorService executor = Executors
      .newVirtualThreadPerTaskExecutor()
) {
    IntStream.range(0, 10_000).forEach(i -&gt; {
        executor.submit(() -&gt; {
            Thread.sleep(Duration.ofSeconds(1));
            return i;
        });
    });
}
</pre></li></ul></div><div class="footer"><div class="test"><span class="author">Georgiy Korneev</span><span class="title">Технологии Java / Неблокирующий и асинхронный ввод-вывод</span><span class="number">56</span></div></div></div></div>
<div class="slide"><div class="content"><h1>Ресурсы</h1><div class="body"><ul class="item-1 level-1"><li>Реальный поток для исполнения</li><li>Ничего при ожидании<ul class="item-2 level-2"><li>Ввод-вывод, очереди, future <pre class="prettyprint lang-java">// +
response.send(
    future1.get() // ‒
    +                   // +
    future2.get() // ‒
); // +
</pre></li></ul></li><li>Препятствия<ul class="item-2 level-2"><li><var>synchronized</var></li><li><var>native</var></li></ul></li></ul></div><div class="footer"><div class="test"><span class="author">Georgiy Korneev</span><span class="title">Технологии Java / Неблокирующий и асинхронный ввод-вывод</span><span class="number">57</span></div></div></div></div>
<div class="slide"><div class="content"><h1>Создание потоков</h1><div class="body"><ul class="item-1 level-1"><li>Непосредственное<ul class="item-2 level-2"><li><var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/lang/Thread.html#startVirtualThread(java.lang.Runnable)" target="_blank">startVirtualThread(runnable)</a></var></li><li><var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/lang/Thread.html#isVirtual()" target="_blank">thread.isVirtual()</a></var></li><li>Всегда <var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/lang/Thread.html#isDaemon()" target="_blank">daemon</a></var>, <var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/lang/Thread.html#NORM_PRIORITY" target="_blank">NORM_PRIORITY</a></var></li></ul></li><li><var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/lang/Thread.Builder.html" target="_blank">Thread.Builder</a></var><ul class="item-2 level-2"><li><var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/lang/Thread.html" target="_blank">Thread</a></var> <var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/lang/Thread.Builder.html#start(java.lang.Runnable)" target="_blank">start(runnable)</a></var></li><li><var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/lang/Thread.html" target="_blank">Thread</a></var> <var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/lang/Thread.Builder.html#unstarted(java.lang.Runnable)" target="_blank">unstarted(runnable)</a></var></li><li><var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/util/concurrent/ThreadFactory.html" target="_blank">ThreadFactory</a></var> <var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/lang/Thread.Builder.html#factory()" target="_blank">factory()</a></var></li></ul></li><li>Фабрики<ul class="item-2 level-2"><li><var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/lang/Thread.html#ofVirtual()" target="_blank">Thread.ofVirtual()</a></var></li><li><var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/lang/Thread.html#ofPlatform()" target="_blank">Thread.ofPlatform()</a></var></li></ul></li></ul></div><div class="footer"><div class="test"><span class="author">Georgiy Korneev</span><span class="title">Технологии Java / Неблокирующий и асинхронный ввод-вывод</span><span class="number">58</span></div></div></div></div>
<div class="slide section"><div class="content"><h1>Заключение</h1><h2>Содержание</h2><div class="body"><ol class="level-1 toc-1"><li><a href="#(2)" class="toc">Буферы</a></li><li><a href="#(12)" class="toc">Каналы</a></li><li><a href="#(52)" class="toc">Виртуальные потоки</a></li><li><a href="#(59)" class="toc current">Заключение</a></li></ol></div><div class="footer"><div class="test"><span class="author">Georgiy Korneev</span><span class="title">Технологии Java / Неблокирующий и асинхронный ввод-вывод</span><span class="number">59</span></div></div></div></div>
<div class="slide"><div class="content"><h1>Ссылки</h1><div class="body"><ul class="item-1 level-1"><li>Java™ I/O, NIO, and NIO.2 // <a href="http://docs.oracle.com/javase/8/docs/technotes/guides/io/" target="_blank">http://docs.oracle.com/javase/8/docs/technotes/<br />guides/io/</a></li><li>Java NIO Selector // <a href="http://tutorials.jenkov.com/java-nio/selectors.html" target="_blank">http://tutorials.jenkov.com<br />/java-nio/selectors.html</a></li><li>Java Asynchronous I/O // <a href="http://www.java2s.com/Tutorials/Java/Java_io/1050__Java_nio_Asynchronous.htm" target="_blank">http://www.java2s.com/Tutorials/Java/Java_io/<br />1050__Java_nio_Asynchronous.htm</a></li><li>Virtual Threads // <a href="https://docs.oracle.com/en/java/javase/21/core/virtual-threads.html" target="_blank">https://docs.oracle.com/en/java/<br />javase/21/core/virtual-threads.html</a></li></ul></div><div class="footer"><div class="test"><span class="author">Georgiy Korneev</span><span class="title">Технологии Java / Неблокирующий и асинхронный ввод-вывод</span><span class="number">60</span></div></div></div></div>
<div class="slide"><div class="content"><h1>Вопросы</h1><div class="body"><div class="questions">???</div></div><div class="footer"><div class="test"><span class="author">Georgiy Korneev</span><span class="title">Технологии Java / Неблокирующий и асинхронный ввод-вывод</span><span class="number">61</span></div></div></div></div></div></body></html>