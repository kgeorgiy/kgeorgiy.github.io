<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html lang="ru" xml:lang="ru" xmlns="http://www.w3.org/1999/xhtml"><head><title>Технологии Java / Concurrency Utilities</title><meta name="author" content="" /><link rel="stylesheet" type="text/css" media="screen, projection, print" href="scripts/slidy.css" /><link rel="stylesheet" type="text/css" href="scripts/prettify.css" /><link rel="stylesheet" type="text/css" href="scripts/kgeorgiy-slides.css" /><script type="text/javascript" src="scripts/slidy.js" charset="utf-8" /><script type="text/javascript" src="scripts/kgeorgiy-slides.js" charset="utf-8" /><script type="text/javascript" src="scripts/prettify.js" /><script type="text/javascript" src="scripts/lang-sql.js" /><script type="text/javascript" src="scripts/lang-javaModule.js" /><script type="text/javascript" src="scripts/lang-scala.js" /><script>var _gaq=_gaq||[];_gaq.push(["_setAccount","UA-37693764-1"]);_gaq.push(["_setDomainName","kgeorgiy.info"]);_gaq.push(["_trackPageview"]);(function(){var a=document.createElement("script");a.type="text/javascript";a.async=!0;a.src=("https:"==document.location.protocol?"https://ssl":"http://www")+".google-analytics.com/ga.js";var b=document.getElementsByTagName("script")[0];b.parentNode.insertBefore(a,b)})();</script><script async="async" src="https://www.googletagmanager.com/gtag/js?id=G-8EQ66D87ZZ" /><script>
                  window.dataLayer = window.dataLayer || [];
                  function gtag(){dataLayer.push(arguments);}
                  gtag('js', new Date());

                  gtag('config', 'G-8EQ66D87ZZ');
                </script></head><body onload="prettyPrint()"><div id="all">
<div class="slide cover"><div class="content"><div class="course">Технологии Java</div><hr /><div class="lecture"><div>Concurrency Utilities</div></div><div class="link"><a href="https://kgeorgiy.info/courses/java-advanced/">https://kgeorgiy.info/courses/java-advanced/</a></div><div class="copyright"><a href="http://creativecommons.org/licenses/by-nc-sa/4.0/deed.ru"><span class="copyright">Copyright © Georgiy Korneev</span><img src="scripts/by-nc-sa.png" alt="Attribution-NonCommercial-ShareAlike" /></a></div></div></div>
<div class="slide"><div class="content"><h1>Concurrency Utilities</h1><div class="body"><ul class="item-1 level-1"><li>Набор классов, облегчающих написание многопоточных программ</li><li>Пакет <var>java.util.concurrent</var><ul class="item-2 level-2"><li>Многопоточные коллекции</li><li>Управление заданиями</li></ul></li><li>Уже были<ul class="item-2 level-2"><li>Атомарные переменные (<var>.atomic</var>)</li><li>Блокировки (<var>.locks</var>)</li><li>Примитивы синхронизации</li></ul></li></ul></div><div class="footer"><div class="test"><span class="author">Georgiy Korneev</span><span class="title">Технологии Java / Concurrency Utilities</span><span class="number">2</span></div></div></div></div>
<div class="slide section"><div class="content"><h1>Многопоточные коллекции</h1><h2>Содержание</h2><div class="body"><ol class="level-1 toc-1"><li><a href="#(3)" class="toc current">Многопоточные коллекции</a><ol class="level-2 toc-2"><li><a href="#(4)" class="">Очереди</a></li><li><a href="#(9)" class="">Отображения</a></li><li><a href="#(12)" class="">Прочее</a></li></ol></li><li><a href="#(15)" class="toc">Управление заданиями</a></li><li><a href="#(30)" class="toc">Дополнительные возможности</a></li><li><a href="#(35)" class="toc">Заключение</a></li></ol></div><div class="footer"><div class="test"><span class="author">Georgiy Korneev</span><span class="title">Технологии Java / Concurrency Utilities</span><span class="number">3</span></div></div></div></div>
<div class="slide subsection"><div class="content"><h1>Очереди</h1><h2>Содержание</h2><div class="body"><ol class="level-1 toc-1"><li><a href="#(3)" class="toc current">Многопоточные коллекции</a><ol class="level-2 toc-2"><li><a href="#(4)" class=" current">Очереди</a></li><li><a href="#(9)" class="">Отображения</a></li><li><a href="#(12)" class="">Прочее</a></li></ol></li><li><a href="#(15)" class="toc">Управление заданиями</a></li><li><a href="#(30)" class="toc">Дополнительные возможности</a></li><li><a href="#(35)" class="toc">Заключение</a></li></ol></div><div class="footer"><div class="test"><span class="author">Georgiy Korneev</span><span class="title">Технологии Java / Concurrency Utilities</span><span class="number">4</span></div></div></div></div>
<div class="slide"><div class="content"><h1>Многопоточные очереди</h1><div class="body"><ul class="item-1 level-1"><li>Интерфейсы<ul class="item-2 level-2"><li><var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/util/concurrent/BlockingQueue.html" target="_blank">BlockingQueue</a></var></li><li><var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/util/concurrent/BlockingDeque.html" target="_blank">BlockingDeque</a></var></li></ul></li><li>Семантика чтения-записи</li><li>Возможно ограничение размера <table><tr><th class="small"> Действие </th><th class="small"> Исключение </th><th class="small"> Значение </th><th class="small"> Ожидание</th></tr><tr><td class="small"> Вставка </td><td class="small"><var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/util/concurrent/BlockingQueue.html#add(E)" target="_blank">add(e)</a></var></td><td class="small"><var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/util/concurrent/BlockingQueue.html#offer(E,long,java.util.concurrent.TimeUnit)" target="_blank">offer(time?)</a></var></td><td class="small"><var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/util/concurrent/BlockingQueue.html#put(E)" target="_blank">put(e)</a></var></td></tr><tr><td class="small"> Чтение </td><td class="small"><var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/util/Queue.html#element()" target="_blank">element()</a></var></td><td class="small"><var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/util/Queue.html#peek()" target="_blank">peek()</a></var></td><td class="small" /></tr><tr><td class="small"> Удаление </td><td class="small"><var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/util/Queue.html#remove()" target="_blank">remove()</a></var></td><td class="small"><var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/util/concurrent/BlockingQueue.html#poll(long,java.util.concurrent.TimeUnit)" target="_blank">poll(time?)</a></var></td><td class="small"><var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/util/concurrent/BlockingQueue.html#take()" target="_blank">take()</a></var></td></tr></table></li></ul></div><div class="footer"><div class="test"><span class="author">Georgiy Korneev</span><span class="title">Технологии Java / Concurrency Utilities</span><span class="number">5</span></div></div></div></div>
<div class="slide"><div class="content"><h1>Свойства</h1><div class="body"><ul class="item-1 level-1"><li>Массовые операции<ul class="item-2 level-2"><li><var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/util/concurrent/BlockingQueue.html#remainingCapacity()" target="_blank">remainingCapacity()</a></var> – свободное место</li><li><var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/util/concurrent/BlockingQueue.html#drainTo(java.util.Collection,int)" target="_blank">drainTo(collection, max?)</a></var> – получение элементов</li></ul></li><li>Особенности<ul class="item-2 level-2"><li>Неэффективность произвольного доступа</li><li>Неатомарность массовых операций</li></ul></li></ul></div><div class="footer"><div class="test"><span class="author">Georgiy Korneev</span><span class="title">Технологии Java / Concurrency Utilities</span><span class="number">6</span></div></div></div></div>
<div class="slide"><div class="content"><h1>Производитель-потребитель</h1><div class="body"><ul class="item-1 level-1"><li>Производитель <pre class="prettyprint lang-java">while (true) {
    E e;
    // Создание элемента
    queue.put(e);
}
</pre></li><li>Потребитель <pre class="prettyprint lang-java">while (true) {
    E e = queue.take();
    // Обработка элемента
}
</pre></li></ul></div><div class="footer"><div class="test"><span class="author">Georgiy Korneev</span><span class="title">Технологии Java / Concurrency Utilities</span><span class="number">7</span></div></div></div></div>
<div class="slide"><div class="content"><h1>Реализации BlockingQueue</h1><div class="body"><ul class="item-1 level-1"><li>Очередь на массиве<ul class="item-2 level-2"><li><var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/util/concurrent/ArrayBlockingQueue.html" target="_blank">ArrayBlockingQueue</a></var></li></ul></li><li>Очереди на связных списках<ul class="item-2 level-2"><li><var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/util/concurrent/LinkedBlockingQueue.html" target="_blank">LinkedBlockingQueue</a></var></li><li><var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/util/concurrent/LinkedBlockingDeque.html" target="_blank">LinkedBlockingDeque</a></var></li></ul></li><li>Очередь на хипе<ul class="item-2 level-2"><li><var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/util/concurrent/PriorityBlockingQueue.html" target="_blank">PriorityBlockingQueue</a></var></li></ul></li><li>Очередь без «внутренности»<ul class="item-2 level-2"><li><var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/util/concurrent/SynchronousQueue.html" target="_blank">SynchronousQueue</a></var></li></ul></li></ul></div><div class="footer"><div class="test"><span class="author">Georgiy Korneev</span><span class="title">Технологии Java / Concurrency Utilities</span><span class="number">8</span></div></div></div></div>
<div class="slide subsection"><div class="content"><h1>Отображения</h1><h2>Содержание</h2><div class="body"><ol class="level-1 toc-1"><li><a href="#(3)" class="toc current">Многопоточные коллекции</a><ol class="level-2 toc-2"><li><a href="#(4)" class="">Очереди</a></li><li><a href="#(9)" class=" current">Отображения</a></li><li><a href="#(12)" class="">Прочее</a></li></ol></li><li><a href="#(15)" class="toc">Управление заданиями</a></li><li><a href="#(30)" class="toc">Дополнительные возможности</a></li><li><a href="#(35)" class="toc">Заключение</a></li></ol></div><div class="footer"><div class="test"><span class="author">Georgiy Korneev</span><span class="title">Технологии Java / Concurrency Utilities</span><span class="number">9</span></div></div></div></div>
<div class="slide"><div class="content"><h1>Многопоточные отображения (1)</h1><div class="body"><ul class="item-1 level-1"><li>Интерфейсы<ul class="item-2 level-2"><li><var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/util/concurrent/ConcurrentMap.html" target="_blank">ConcurrentMap&lt;K, V&gt;</a></var></li><li><var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/util/concurrent/ConcurrentNavigableMap.html" target="_blank">ConcurrentNavigableMap&lt;K, V&gt;</a></var></li></ul></li><li>Методы<ul class="item-2 level-2"><li><var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/util/concurrent/ConcurrentMap.html#putIfAbsent(K,V)" target="_blank">putIfAbsent(k, v)</a></var> – добавляет отображение <var>K</var>, если его ранее не было</li><li><var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/util/concurrent/ConcurrentMap.html#remove(java.lang.Object,java.lang.Object)" target="_blank">remove(k, v)</a></var> – удаляет <var>K</var>, если он отображен на <var>V</var></li><li><var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/util/concurrent/ConcurrentMap.html#replace(K,V)" target="_blank">replace(k, v)</a></var> – заменяет отображение <var>K</var></li><li><var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/util/concurrent/ConcurrentMap.html#replace(K,V,V)" target="_blank">replace(k, oldV, newV)</a></var> – условная замена отображения для ключа <var>K</var></li><li><var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/util/concurrent/ConcurrentMap.html#compute(K,java.util.function.BiFunction)" target="_blank">computeXX(K, V?, f)</a></var> – посчитать и вернуть значение</li><li><var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/util/concurrent/ConcurrentMap.html#merge(K,V,java.util.function.BiFunction)" target="_blank">merge(K, V, f)</a></var> – пересчитать значение</li></ul></li></ul></div><div class="footer"><div class="test"><span class="author">Georgiy Korneev</span><span class="title">Технологии Java / Concurrency Utilities</span><span class="number">10</span></div></div></div></div>
<div class="slide"><div class="content"><h1>Реализация</h1><div class="body"><ul class="item-1 level-1"><li>Классы<ul class="item-2 level-2"><li><var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/util/concurrent/ConcurrentHashMap.html" target="_blank">ConcurrentHashMap</a></var></li><li><var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/util/concurrent/ConcurrentSkipListMap.html" target="_blank">ConcurrentSkipListMap</a></var></li></ul></li><li>Неблокирующее чтение</li><li>Частично блокирующая запись<ul class="item-2 level-2"><li>Lock striping</li></ul></li></ul></div><div class="footer"><div class="test"><span class="author">Georgiy Korneev</span><span class="title">Технологии Java / Concurrency Utilities</span><span class="number">11</span></div></div></div></div>
<div class="slide subsection"><div class="content"><h1>Прочее</h1><h2>Содержание</h2><div class="body"><ol class="level-1 toc-1"><li><a href="#(3)" class="toc current">Многопоточные коллекции</a><ol class="level-2 toc-2"><li><a href="#(4)" class="">Очереди</a></li><li><a href="#(9)" class="">Отображения</a></li><li><a href="#(12)" class=" current">Прочее</a></li></ol></li><li><a href="#(15)" class="toc">Управление заданиями</a></li><li><a href="#(30)" class="toc">Дополнительные возможности</a></li><li><a href="#(35)" class="toc">Заключение</a></li></ol></div><div class="footer"><div class="test"><span class="author">Georgiy Korneev</span><span class="title">Технологии Java / Concurrency Utilities</span><span class="number">12</span></div></div></div></div>
<div class="slide"><div class="content"><h1>«Самокопирующиеся» коллекции</h1><div class="body"><ul class="item-1 level-1"><li>Делается копия при записи<ul class="item-2 level-2"><li>Частое копирование</li><li>Редкое изменение</li></ul></li><li>Список на массиве<ul class="item-2 level-2"><li><var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/util/concurrent/CopyOnWriteArrayList.html" target="_blank">CopyOnWriteArrayList</a></var></li></ul></li><li>Множество на массиве<ul class="item-2 level-2"><li><var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/util/concurrent/CopyOnWriteArraySet.html" target="_blank">CopyOnWriteArraySet</a></var></li></ul></li></ul></div><div class="footer"><div class="test"><span class="author">Georgiy Korneev</span><span class="title">Технологии Java / Concurrency Utilities</span><span class="number">13</span></div></div></div></div>
<div class="slide"><div class="content"><h1>Другие многопоточные коллекции</h1><div class="body"><ul class="item-1 level-1"><li>Неограниченная очередь на списке<ul class="item-2 level-2"><li><var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/util/concurrent/ConcurrentLinkedQueue.html" target="_blank">ConcurrentLinkedQueue</a></var></li></ul></li></ul></div><div class="footer"><div class="test"><span class="author">Georgiy Korneev</span><span class="title">Технологии Java / Concurrency Utilities</span><span class="number">14</span></div></div></div></div>
<div class="slide section"><div class="content"><h1>Управление заданиями</h1><h2>Содержание</h2><div class="body"><ol class="level-1 toc-1"><li><a href="#(3)" class="toc">Многопоточные коллекции</a></li><li><a href="#(15)" class="toc current">Управление заданиями</a><ol class="level-2 toc-2"><li><a href="#(16)" class="">Исполнители</a></li><li><a href="#(25)" class="">Разделяемые задания</a></li></ol></li><li><a href="#(30)" class="toc">Дополнительные возможности</a></li><li><a href="#(35)" class="toc">Заключение</a></li></ol></div><div class="footer"><div class="test"><span class="author">Georgiy Korneev</span><span class="title">Технологии Java / Concurrency Utilities</span><span class="number">15</span></div></div></div></div>
<div class="slide subsection"><div class="content"><h1>Исполнители</h1><h2>Содержание</h2><div class="body"><ol class="level-1 toc-1"><li><a href="#(3)" class="toc">Многопоточные коллекции</a></li><li><a href="#(15)" class="toc current">Управление заданиями</a><ol class="level-2 toc-2"><li><a href="#(16)" class=" current">Исполнители</a></li><li><a href="#(25)" class="">Разделяемые задания</a></li></ol></li><li><a href="#(30)" class="toc">Дополнительные возможности</a></li><li><a href="#(35)" class="toc">Заключение</a></li></ol></div><div class="footer"><div class="test"><span class="author">Georgiy Korneev</span><span class="title">Технологии Java / Concurrency Utilities</span><span class="number">16</span></div></div></div></div>
<div class="slide"><div class="content"><h1>Исполнители</h1><div class="body"><ul class="item-1 level-1"><li>Интерфейс <var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/util/concurrent/Executor.html" target="_blank">Executor</a></var><ul class="item-2 level-2"><li><var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/util/concurrent/Executor.html#execute(java.lang.Runnable)" target="_blank">execute(runnable)</a></var> – выполнить задание</li></ul></li><li>Возможные варианты выполнения<ul class="item-2 level-2"><li>В том же потоке</li><li>Во вновь создаваемом потоке</li><li>Пул потоков</li><li>Наращиваемый пул потоков</li></ul></li></ul></div><div class="footer"><div class="test"><span class="author">Georgiy Korneev</span><span class="title">Технологии Java / Concurrency Utilities</span><span class="number">17</span></div></div></div></div>
<div class="slide"><div class="content"><h1>Функции и результаты</h1><div class="body"><ul class="item-1 level-1"><li>Интерфейс <var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/util/concurrent/Callable.html" target="_blank">Callable&lt;V&gt;</a></var> – функция<ul class="item-2 level-2"><li><var>V <var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/util/concurrent/Callable.html#call()" target="_blank">call()</a></var></var> – посчитать</li></ul></li><li>Интерфейс <var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/util/concurrent/Future.html" target="_blank">Future&lt;V&gt;</a></var> – результат<ul class="item-2 level-2"><li><var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/util/concurrent/Future.html#get(long,java.util.concurrent.TimeUnit)" target="_blank">get(time?, unit)</a></var> – получить результат</li><li><var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/util/concurrent/Future.html#isDone()" target="_blank">isDone()</a></var> – окончено ли выполнение</li><li><var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/util/concurrent/Future.html#cancel(boolean)" target="_blank">cancel(mayInterruptWhenRunning)</a></var> – прервать выполнение</li><li><var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/util/concurrent/Future.html#isCancelled()" target="_blank">isCancelled()</a></var> – прервано ли выполнение</li></ul></li></ul></div><div class="footer"><div class="test"><span class="author">Georgiy Korneev</span><span class="title">Технологии Java / Concurrency Utilities</span><span class="number">18</span></div></div></div></div>
<div class="slide"><div class="content"><h1>Исполнители функций</h1><div class="body"><ul class="item-1 level-1"><li>Интерфейс <var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/util/concurrent/ExecutorService.html" target="_blank">ExecutorService</a></var><ul class="item-2 level-2"><li><var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/util/concurrent/ExecutorService.html#submit(java.lang.Runnable)" target="_blank">submit(runnable)</a></var> – выполнить задание</li><li><var><var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/util/concurrent/Future.html" target="_blank">Future&lt;V&gt;</a></var> <var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/util/concurrent/ExecutorService.html#submit(java.util.concurrent.Callable)" target="_blank">submit(callable&lt;V&gt;)</a></var></var> – выполнить функцию</li><li><var><var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/util/List.html" target="_blank">List</a></var>&lt;<var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/util/concurrent/Future.html" target="_blank">Future</a></var>&gt; <var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/util/concurrent/ExecutorService.html#invokeAll(java.util.Collection)" target="_blank">invokeAll(Collection&lt;Callable&gt;)</a></var></var> – выполнить все функции</li><li><var><var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/util/concurrent/Future.html" target="_blank">Future</a></var> <var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/util/concurrent/ExecutorService.html#invokeAny(java.util.Collection)" target="_blank">invokeAny(Collection&lt;Callable&gt;)</a></var></var> – успешно выполнить функцию</li></ul></li></ul></div><div class="footer"><div class="test"><span class="author">Georgiy Korneev</span><span class="title">Технологии Java / Concurrency Utilities</span><span class="number">19</span></div></div></div></div>
<div class="slide"><div class="content"><h1>Завершение работы</h1><div class="body"><ul class="item-1 level-1"><li>Прекращение приема заданий<ul class="item-2 level-2"><li><var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/util/concurrent/ExecutorService.html#shutdown()" target="_blank">shutdown()</a></var></li><li><var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/util/concurrent/ExecutorService.html#isShutdown()" target="_blank">isShutdown()</a></var></li></ul></li><li>Прекратить выполнение<ul class="item-2 level-2"><li><var><var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/util/List.html" target="_blank">List</a></var>&lt;<var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/lang/Runnable.html" target="_blank">Runnable</a></var>&gt; <var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/util/concurrent/ExecutorService.html#shutdownNow()" target="_blank">shutdownNow()</a></var></var></li></ul></li><li>Завершение всех потоков<ul class="item-2 level-2"><li><var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/util/concurrent/ExecutorService.html#isTerminated()" target="_blank">isTerminated()</a></var></li><li><var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/util/concurrent/ExecutorService.html#awaitTermination(long,java.util.concurrent.TimeUnit)" target="_blank">awaitTermination(time, unit)</a></var></li><li><var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/util/concurrent/ExecutorService.html#close()" target="_blank">close()</a></var> (19+)</li></ul></li></ul></div><div class="footer"><div class="test"><span class="author">Georgiy Korneev</span><span class="title">Технологии Java / Concurrency Utilities</span><span class="number">20</span></div></div></div></div>
<div class="slide"><div class="content"><h1>Реализация исполнителей</h1><div class="body"><ul class="item-1 level-1"><li>Класс <var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/util/concurrent/ThreadPoolExecutor.html" target="_blank">ThreadPoolExecutor</a></var><ul class="item-2 level-2"><li><var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/util/concurrent/ThreadPoolExecutor.html#getCorePoolSize()" target="_blank">corePoolSize</a></var> – минимальное количество потоков</li><li><var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/util/concurrent/ThreadPoolExecutor.html#getMaximumPoolSize()" target="_blank">maximumPoolSize</a></var> – максимальное количество потоков</li><li><var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/util/concurrent/ThreadPoolExecutor.html#getQueue()" target="_blank">queue</a></var> – очередь заданий</li><li><var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/util/concurrent/ThreadPoolExecutor.html#getKeepAliveTime(java.util.concurrent.TimeUnit)" target="_blank">keepAliveTime</a></var> – время жизни потока</li><li><var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/util/concurrent/ThreadPoolExecutor.html#getThreadFactory()" target="_blank">threadFactory</a></var> – фабрика потоков</li><li>…</li></ul></li></ul></div><div class="footer"><div class="test"><span class="author">Georgiy Korneev</span><span class="title">Технологии Java / Concurrency Utilities</span><span class="number">21</span></div></div></div></div>
<div class="slide"><div class="content"><h1>Класс Executors</h1><div class="body"><ul class="item-1 level-1"><li>Создание исполнителей<ul class="item-2 level-2"><li><var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/util/concurrent/Executors.html#newCachedThreadPool()" target="_blank">newCachedThreadPool()</a></var></li><li><var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/util/concurrent/Executors.html#newFixedThreadPool(int)" target="_blank">newFixedThreadPool(n)</a></var></li><li><var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/util/concurrent/Executors.html#newSingleThreadExecutor()" target="_blank">newSingleThreadExecutor()</a></var></li></ul></li><li>Создание фабрик потоков<ul class="item-2 level-2"><li>Класс <var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/util/concurrent/ThreadFactory.html" target="_blank">ThreadFactory</a></var></li></ul></li><li>Создание привилегированных действий и фабрик потоков<ul class="item-2 level-2"><li>Наследуют права создавшего</li></ul></li></ul></div><div class="footer"><div class="test"><span class="author">Georgiy Korneev</span><span class="title">Технологии Java / Concurrency Utilities</span><span class="number">22</span></div></div></div></div>
<div class="slide"><div class="content"><h1>Отклонение заданий</h1><div class="body"><ul class="item-1 level-1"><li>Нет свободного потока и места в очереди</li><li>Политики отклонения<ul class="item-2 level-2"><li><var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/util/concurrent/ThreadPoolExecutor.AbortPolicy.html" target="_blank">AbortPolicy</a></var> – бросить <var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/util/concurrent/RejectedExecutionException.html" target="_blank">RejectedExecutionException</a></var></li><li><var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/util/concurrent/ThreadPoolExecutor.CallerRunsPolicy.html" target="_blank">CallerRunsPolicy</a></var> – исполнить в вызывающем потоке</li><li><var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/util/concurrent/ThreadPoolExecutor.DiscardPolicy.html" target="_blank">DiscardPolicy</a></var> – проигнорировать</li><li><var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/util/concurrent/ThreadPoolExecutor.DiscardOldestPolicy.html" target="_blank">DiscardOldestPolicy</a></var> – заменить самое давнее</li></ul></li><li>Интерфейс <var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/util/concurrent/RejectedExecutionHandler.html" target="_blank">RejectedExecutionHandler</a></var></li></ul></div><div class="footer"><div class="test"><span class="author">Georgiy Korneev</span><span class="title">Технологии Java / Concurrency Utilities</span><span class="number">23</span></div></div></div></div>
<div class="slide"><div class="content"><h1>Отложенное исполнение</h1><div class="body"><ul class="item-1 level-1"><li>Интерфейс <var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/util/concurrent/ScheduledExecutorService.html" target="_blank">ScheduledExecutorService</a></var><ul class="item-2 level-2"><li><var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/util/concurrent/ScheduledExecutorService.html#schedule(java.util.concurrent.Callable,long,java.util.concurrent.TimeUnit)" target="_blank">schedule(callable, timeout, unit)</a></var> – исполнить через <var>timeout</var></li><li><var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/util/concurrent/ScheduledExecutorService.html#schedule(java.lang.Runnable,long,java.util.concurrent.TimeUnit)" target="_blank">schedule(runnable, timeout, unit)</a></var> – исполнить через <var>timeout</var></li><li><var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/util/concurrent/ScheduledExecutorService.html#scheduleAtFixedRate(java.lang.Runnable,long,long,java.util.concurrent.TimeUnit)" target="_blank">scheduleAtFixedRate(runnable, delay, period, unit)</a></var> – периодическое исполнение</li><li><var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/util/concurrent/ScheduledExecutorService.html#scheduleWithFixedDelay(java.lang.Runnable,long,long,java.util.concurrent.TimeUnit)" target="_blank">scheduleWithFixedDelay(runnable, delay, period, unit)</a></var> – исполнение с равными интервалами</li><li>Все методы возвращают <var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/util/concurrent/ScheduledFuture.html" target="_blank">ScheduledFuture</a></var></li></ul></li><li>Класс <var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/util/concurrent/ScheduledThreadPoolExecutor.html" target="_blank">ScheduledThreadPoolExecutor</a></var></li></ul></div><div class="footer"><div class="test"><span class="author">Georgiy Korneev</span><span class="title">Технологии Java / Concurrency Utilities</span><span class="number">24</span></div></div></div></div>
<div class="slide subsection"><div class="content"><h1>Разделяемые задания</h1><h2>Содержание</h2><div class="body"><ol class="level-1 toc-1"><li><a href="#(3)" class="toc">Многопоточные коллекции</a></li><li><a href="#(15)" class="toc current">Управление заданиями</a><ol class="level-2 toc-2"><li><a href="#(16)" class="">Исполнители</a></li><li><a href="#(25)" class=" current">Разделяемые задания</a></li></ol></li><li><a href="#(30)" class="toc">Дополнительные возможности</a></li><li><a href="#(35)" class="toc">Заключение</a></li></ol></div><div class="footer"><div class="test"><span class="author">Georgiy Korneev</span><span class="title">Технологии Java / Concurrency Utilities</span><span class="number">25</span></div></div></div></div>
<div class="slide"><div class="content"><h1>Общая идея</h1><div class="body"><ul class="item-1 level-1"><li>Маленький объем работы<ul class="item-2 level-2"><li>Выполнить на месте</li></ul></li><li>Большой объем работы<ul class="item-2 level-2"><li>Разделить на фрагменты</li></ul></li></ul></div><div class="footer"><div class="test"><span class="author">Georgiy Korneev</span><span class="title">Технологии Java / Concurrency Utilities</span><span class="number">26</span></div></div></div></div>
<div class="slide"><div class="content"><h1>Разделяемые задания</h1><div class="body"><ul class="item-1 level-1"><li>Класс <var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/util/concurrent/ForkJoinTask.html" target="_blank">ForkJoinTask</a></var><ul class="item-2 level-2"><li><var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/util/concurrent/ForkJoinTask.html#exec()" target="_blank">exec()</a></var> — выполнить задание</li><li><var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/util/concurrent/ForkJoinTask.html#fork()" target="_blank">fork()</a></var> — запустить подзадание</li><li><var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/util/concurrent/ForkJoinTask.html#join()" target="_blank">join()</a></var> — получить результат</li></ul></li><li>Класс <var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/util/concurrent/RecursiveAction.html" target="_blank">RecursiveAction</a></var><ul class="item-2 level-2"><li>Ради побочных эффектов</li><li><var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/util/concurrent/ForkJoinTask.html#invokeAll(java.util.Collection)" target="_blank">invokeAll(collection)</a></var> — выполнить подзадания</li></ul></li><li>Класс <var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/util/concurrent/RecursiveTask.html" target="_blank">RecursiveTask</a></var><ul class="item-2 level-2"><li>Чистые функции</li><li><var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/util/concurrent/RecursiveTask.html#compute()" target="_blank">compute()</a></var> — посчитать в текущем потоке</li></ul></li></ul></div><div class="footer"><div class="test"><span class="author">Georgiy Korneev</span><span class="title">Технологии Java / Concurrency Utilities</span><span class="number">27</span></div></div></div></div>
<div class="slide"><div class="content"><h1>Пример использования</h1><div class="body"><ul class="item-1 level-1"><li>Максимум на списке<ul class="item-2 level-2"><li><pre class="prettyprint lang-java">class Max extends RecursiveTask&lt;Integer&gt; {
    private final List&lt;Integer&gt; data;
    public Max(List&lt;Integer&gt; data) { this.data = data; }
    public Integer compute() {
        int s = data.size();
        if (s == 1) return data.get(0);
        Max m1 = new Max(data.subList(0, s / 2));
        Max m2 = new Max(data.subList(s / 2, s));
        m2.fork();
        return Math.max(m1.compute(), m2.join());
    }
}
</pre></li></ul></li></ul></div><div class="footer"><div class="test"><span class="author">Georgiy Korneev</span><span class="title">Технологии Java / Concurrency Utilities</span><span class="number">28</span></div></div></div></div>
<div class="slide"><div class="content"><h1>Реализация</h1><div class="body"><ul class="item-1 level-1"><li>Класс <var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/util/concurrent/ForkJoinPool.html" target="_blank">ForkJoinPool</a></var><ul class="item-2 level-2"><li>Выполнение заданий внутри</li><li>Приоритет локальным заданиям</li><li>«Кража» крупных заданий</li></ul></li><li>Методы<ul class="item-2 level-2"><li><var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/util/concurrent/ForkJoinPool.html#commonPool()" target="_blank">commonPool()</a></var> — пул по умолчанию</li></ul></li><li>Пример<ul class="item-2 level-2"><li><pre class="prettyprint lang-java">final Max task = new Max(data);
ForkJoinPool.commonPool().execute(task);
Integer max = task.get();
</pre></li></ul></li></ul></div><div class="footer"><div class="test"><span class="author">Georgiy Korneev</span><span class="title">Технологии Java / Concurrency Utilities</span><span class="number">29</span></div></div></div></div>
<div class="slide section"><div class="content"><h1>Дополнительные возможности</h1><h2>Содержание</h2><div class="body"><ol class="level-1 toc-1"><li><a href="#(3)" class="toc">Многопоточные коллекции</a></li><li><a href="#(15)" class="toc">Управление заданиями</a></li><li><a href="#(30)" class="toc current">Дополнительные возможности</a></li><li><a href="#(35)" class="toc">Заключение</a></li></ol></div><div class="footer"><div class="test"><span class="author">Georgiy Korneev</span><span class="title">Технологии Java / Concurrency Utilities</span><span class="number">30</span></div></div></div></div>
<div class="slide"><div class="content"><h1>Интервалы времени</h1><div class="body"><ul class="item-1 level-1"><li>Перечисление <var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/util/concurrent/TimeUnit.html" target="_blank">TimeUnit</a></var><ul class="item-2 level-2"><li><var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/util/concurrent/TimeUnit.html#DAYS" target="_blank">DAYS</a></var></li><li><var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/util/concurrent/TimeUnit.html#HOURS" target="_blank">HOURS</a></var></li><li><var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/util/concurrent/TimeUnit.html#MINUTES" target="_blank">MINUTES</a></var></li><li><var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/util/concurrent/TimeUnit.html#SECONDS" target="_blank">SECONDS</a></var></li><li><var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/util/concurrent/TimeUnit.html#MILLISECONDS" target="_blank">MILLISECONDS</a></var></li><li><var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/util/concurrent/TimeUnit.html#MICROSECONDS" target="_blank">MICROSECONDS</a></var></li><li><var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/util/concurrent/TimeUnit.html#NANOSECONDS" target="_blank">NANOSECONDS</a></var></li></ul></li><li>Интервалы задаются парой<ul class="item-2 level-2"><li>Значение</li><li>Единица измерения</li></ul></li></ul></div><div class="footer"><div class="test"><span class="author">Georgiy Korneev</span><span class="title">Технологии Java / Concurrency Utilities</span><span class="number">31</span></div></div></div></div>
<div class="slide"><div class="content"><h1>Очереди с задержкой</h1><div class="body"><ul class="item-1 level-1"><li>Класс <var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/util/concurrent/DelayQueue.html" target="_blank">DelayQueue</a></var></li><li>Интерфейс <var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/util/concurrent/Delayed.html" target="_blank">Delayed</a></var><ul class="item-2 level-2"><li><var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/util/concurrent/Delayed.html#getDelay(java.util.concurrent.TimeUnit)" target="_blank">getDelay(unit)</a></var> – получить остаток задержки</li></ul></li></ul></div><div class="footer"><div class="test"><span class="author">Georgiy Korneev</span><span class="title">Технологии Java / Concurrency Utilities</span><span class="number">32</span></div></div></div></div>
<div class="slide"><div class="content"><h1>Асинхронное вычисление</h1><div class="body"><ul class="item-1 level-1"><li>Класс <var><var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/util/concurrent/FutureTask.html" target="_blank">FutureTask</a></var> extends <var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/util/concurrent/Future.html" target="_blank">Future</a></var></var></li><li>Методы<ul class="item-2 level-2"><li><var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/util/concurrent/RunnableFuture.html#run()" target="_blank">run()</a></var> – посчитать</li><li><var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/util/concurrent/FutureTask.html#get(long,java.util.concurrent.TimeUnit)" target="_blank">get(time?, unit?)</a></var> – получить результат</li></ul></li></ul></div><div class="footer"><div class="test"><span class="author">Georgiy Korneev</span><span class="title">Технологии Java / Concurrency Utilities</span><span class="number">33</span></div></div></div></div>
<div class="slide"><div class="content"><h1>Очереди заданий</h1><div class="body"><ul class="item-1 level-1"><li>Интерфейс <var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/util/concurrent/CompletionService.html" target="_blank">CompletionService&lt;V&gt;</a></var></li><li>Методы<ul class="item-2 level-2"><li><var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/util/concurrent/CompletionService.html#submit(java.util.concurrent.Callable)" target="_blank">submit(callable)</a></var> / <var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/util/concurrent/CompletionService.html#submit(java.lang.Runnable,V)" target="_blank">submit(runnable, result)</a></var> – создать задание</li><li><var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/util/concurrent/CompletionService.html#poll(long,java.util.concurrent.TimeUnit)" target="_blank">poll(time?, unit?)</a></var> / <var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/util/concurrent/CompletionService.html#take()" target="_blank">take()</a></var> – получить результат задания</li></ul></li><li>Реализация<ul class="item-2 level-2"><li><var><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/util/concurrent/ExecutorCompletionService.html" target="_blank">ExecutorCompletionService</a></var></li></ul></li></ul></div><div class="footer"><div class="test"><span class="author">Georgiy Korneev</span><span class="title">Технологии Java / Concurrency Utilities</span><span class="number">34</span></div></div></div></div>
<div class="slide section"><div class="content"><h1>Заключение</h1><h2>Содержание</h2><div class="body"><ol class="level-1 toc-1"><li><a href="#(3)" class="toc">Многопоточные коллекции</a></li><li><a href="#(15)" class="toc">Управление заданиями</a></li><li><a href="#(30)" class="toc">Дополнительные возможности</a></li><li><a href="#(35)" class="toc current">Заключение</a></li></ol></div><div class="footer"><div class="test"><span class="author">Georgiy Korneev</span><span class="title">Технологии Java / Concurrency Utilities</span><span class="number">35</span></div></div></div></div>
<div class="slide"><div class="content"><h1>Ссылки</h1><div class="body"><ul class="item-1 level-1"><li>JSR 166: Concurrency Utilities // <a href="http://jcp.org/en/jsr/detail?id=166" target="_blank">http://jcp.org/en/jsr/detail?id=166</a></li><li>Concurrent Programming with J2SE 5.0 // <a href="http://www.oracle.com/us/technologies/java/index-140767.html" target="_blank">http://www.oracle.com/us/technologies/java/<br />index-140767.html</a></li><li>Goetz B. Java Concurrency in Practice</li></ul></div><div class="footer"><div class="test"><span class="author">Georgiy Korneev</span><span class="title">Технологии Java / Concurrency Utilities</span><span class="number">36</span></div></div></div></div>
<div class="slide"><div class="content"><h1>Вопросы</h1><div class="body" /><div class="footer"><div class="test"><span class="author">Georgiy Korneev</span><span class="title">Технологии Java / Concurrency Utilities</span><span class="number">37</span></div></div></div></div></div></body></html>