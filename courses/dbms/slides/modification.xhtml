<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html lang="ru" xml:lang="ru" xmlns="http://www.w3.org/1999/xhtml"><head><title>Базы данных / Изменение данных</title><meta name="author" content="" /><link rel="stylesheet" type="text/css" media="screen, projection, print" href="scripts/slidy.css" /><link rel="stylesheet" type="text/css" href="scripts/prettify.css" /><link rel="stylesheet" type="text/css" href="scripts/kgeorgiy-slides.css" /><script type="text/javascript" src="scripts/slidy.js" charset="utf-8" /><script type="text/javascript" src="scripts/kgeorgiy-slides.js" charset="utf-8" /><script type="text/javascript" src="scripts/prettify.js" /><script type="text/javascript" src="scripts/lang-sql.js" /><script type="text/javascript" src="scripts/lang-javaModule.js" /><script type="text/javascript" src="scripts/lang-scala.js" /><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js?config=TeX-AMS-MML_HTMLorMML" /><script type="text/javascript">MathJax.Hub.Config({tex2jax: {inlineMath: [['$','$']], displayMath: [['$$','$$']], ignoreClass: "", processClass: "math|lang-math"}});</script><script>var _gaq=_gaq||[];_gaq.push(["_setAccount","UA-37693764-1"]);_gaq.push(["_setDomainName","kgeorgiy.info"]);_gaq.push(["_trackPageview"]);(function(){var a=document.createElement("script");a.type="text/javascript";a.async=!0;a.src=("https:"==document.location.protocol?"https://ssl":"http://www")+".google-analytics.com/ga.js";var b=document.getElementsByTagName("script")[0];b.parentNode.insertBefore(a,b)})();</script><script async="async" src="https://www.googletagmanager.com/gtag/js?id=G-8EQ66D87ZZ" /><script>
                  window.dataLayer = window.dataLayer || [];
                  function gtag(){dataLayer.push(arguments);}
                  gtag('js', new Date());

                  gtag('config', 'G-8EQ66D87ZZ');
                </script></head><body onload="prettyPrint()"><div id="all">
<div class="slide cover"><div class="content"><div class="course">Базы данных</div><hr /><div class="lecture"><div>Изменение данных</div></div><div class="link"><a href="https://kgeorgiy.info/courses/dbms/">https://kgeorgiy.info/courses/dbms/</a></div><div class="copyright"><a href="http://creativecommons.org/licenses/by-nc-sa/4.0/deed.ru"><span class="copyright">Copyright © Георгий Корнеев</span><img src="scripts/by-nc-sa.png" alt="Attribution-NonCommercial-ShareAlike" /></a></div></div></div>
<div class="slide section"><div class="content"><h1>Операторы</h1><h2>Содержание</h2><div class="body"><ol class="level-1 toc-1"><li><a href="#(2)" class="toc current">Операторы</a></li><li><a href="#(8)" class="toc">Целостность данных</a></li><li><a href="#(22)" class="toc">Триггеры</a></li><li><a href="#(26)" class="toc">Представления</a></li><li><a href="#(38)" class="toc">Управление доступом</a></li><li><a href="#(54)" class="toc">Литература</a></li></ol></div><div class="footer"><div class="test"><span class="author">Георгий Корнеев</span><span class="title">Базы данных / Изменение данных</span><span class="number">2</span></div></div></div></div>
<div class="slide"><div class="content"><h1>Типы изменений</h1><div class="body"><ul class="item-1 level-1"><li>Операции БД<ul class="item-2 level-2"><li>Вставка (<var>insert</var>)</li><li>Выборка (<var>select</var>)</li><li>Обновление (<var>update</var>)</li><li>Удаление (<var>delete</var>)</li></ul></li><li>Обобщение<ul class="item-2 level-2"><li>Создание (<var>create</var>)</li><li>Чтение (<var>read</var>)</li><li>Обновление (<var>update</var>)</li><li>Удаление (<var>delete</var>)</li></ul></li></ul></div><div class="footer"><div class="test"><span class="author">Георгий Корнеев</span><span class="title">Базы данных / Изменение данных</span><span class="number">3</span></div></div></div></div>
<div class="slide"><div class="content"><h1>Вставка</h1><div class="body"><ul class="item-1 level-1"><li>Синтаксис<ul class="item-2 level-2"><li><pre class="prettyprint lang-sql">insert into таблица [(атрибуты)]
values (значения) [, ещё строки]
</pre></li><li><pre class="prettyprint lang-sql">insert into таблица [(атрибуты)]
запрос
</pre></li></ul></li><li>Примеры<ul class="item-2 level-2"><li><pre class="prettyprint lang-sql">insert into Courses (Name, Lecturer) values
('БД', 'Корнеев Г.'),
('ТеорИнф', 'Трифонов П.')
</pre></li><li><pre class="prettyprint lang-sql">insert into Points
select SId, CId, 0 from Students, Courses
</pre></li></ul></li></ul></div><div class="footer"><div class="test"><span class="author">Георгий Корнеев</span><span class="title">Базы данных / Изменение данных</span><span class="number">4</span></div></div></div></div>
<div class="slide"><div class="content"><h1>Обновление</h1><div class="body"><ul class="item-1 level-1"><li>Синтаксис<ul class="item-2 level-2"><li><pre class="prettyprint lang-sql">update таблица set значения [where условие]
</pre></li></ul></li><li>Значение<ul class="item-2 level-2"><li><pre class="prettyprint lang-sql">атрибут = выражение
</pre></li></ul></li><li>Примеры<ul class="item-2 level-2"><li><pre class="prettyprint lang-sql">update Students set GroupId = 'M3437'
where LastName = 'Иванов'
</pre></li><li><pre class="prettyprint lang-sql">update Students set
PassNo = '1234', PassSeries = '567890'
where SId = 1
</pre></li><li><pre class="prettyprint lang-sql">update Points set points = points + 1 where CId in
(select CId from Courses where Name = 'СУБД')
</pre></li></ul></li></ul></div><div class="footer"><div class="test"><span class="author">Георгий Корнеев</span><span class="title">Базы данных / Изменение данных</span><span class="number">5</span></div></div></div></div>
<div class="slide"><div class="content"><h1>Удаление</h1><div class="body"><ul class="item-1 level-1"><li>Синтаксис<ul class="item-2 level-2"><li><pre class="prettyprint lang-sql">delete from таблица [where условие]
</pre></li></ul></li><li>Примеры<ul class="item-2 level-2"><li><pre class="prettyprint lang-sql">delete from Points where CId
in (select CId from Courses where Name = 'СУБД')
</pre></li></ul></li><li class="incremental"><div class="non-incremental">Truncate<ul class="item-2 level-2"><li>Синтаксис <pre class="prettyprint lang-sql">truncate таблица -- DDL
</pre></li><li>Пример <pre class="prettyprint lang-sql">truncate Points
</pre></li></ul></div></li></ul></div><div class="footer"><div class="test"><span class="author">Георгий Корнеев</span><span class="title">Базы данных / Изменение данных</span><span class="number">6</span></div></div></div></div>
<div class="slide"><div class="content"><h1>Слияние</h1><div class="body"><ul class="item-1 level-1"><li>Синтаксис<ul class="item-2 level-2"><li><pre class="prettyprint lang-sql">merge into таблица [[as] имя1]
using данные [[as] имя2]
on условие
when matched [and ...] then действие1
when not matched [and ...] then действие2
</pre></li></ul></li><li>Пример обновления данных<ul class="item-2 level-2"><li><pre class="prettyprint lang-sql">merge into Points
using (select * from Courses c, Students s) r
on Points.CId = r.CId and Points.SId = r.SId
when matched then update set points = points + 1
when not matched then insert (SId, CId, points)
    values (r.SId, r.CId, 1)
</pre></li></ul></li></ul></div><div class="footer"><div class="test"><span class="author">Георгий Корнеев</span><span class="title">Базы данных / Изменение данных</span><span class="number">7</span></div></div></div></div>
<div class="slide section"><div class="content"><h1>Целостность данных</h1><h2>Содержание</h2><div class="body"><ol class="level-1 toc-1"><li><a href="#(2)" class="toc">Операторы</a></li><li><a href="#(8)" class="toc current">Целостность данных</a><ol class="level-2 toc-2"><li><a href="#(12)" class="">Типы ограничения целостности</a></li><li><a href="#(18)" class="">Компенсирующие действия</a></li></ol></li><li><a href="#(22)" class="toc">Триггеры</a></li><li><a href="#(26)" class="toc">Представления</a></li><li><a href="#(38)" class="toc">Управление доступом</a></li><li><a href="#(54)" class="toc">Литература</a></li></ol></div><div class="footer"><div class="test"><span class="author">Георгий Корнеев</span><span class="title">Базы данных / Изменение данных</span><span class="number">8</span></div></div></div></div>
<div class="slide"><div class="content"><h1>Корректность и целостность (1)</h1><div class="body"><ul class="item-1 level-1"><li>Корректность<ul class="item-2 level-2"><li>Соответствие содержимого БД «реальному миру»</li><li>Не может быть проверена</li></ul></li><li>Целостность<ul class="item-2 level-2"><li>Непротиворечивость содержимого БД</li><li>Может быть описана набором правил и проверена</li></ul></li></ul></div><div class="footer"><div class="test"><span class="author">Георгий Корнеев</span><span class="title">Базы данных / Изменение данных</span><span class="number">9</span></div></div></div></div>
<div class="slide"><div class="content"><h1>Корректность и целостность (2)</h1><div class="body"><ul class="item-1 level-1"><li>Корректность<ul class="item-2 level-2"><li>Оценка каждого студента соответствует полученной на экзамене</li><li>Студент слушает курс баз данных</li></ul></li><li>Целостность<ul class="item-2 level-2"><li>У студента есть оценки только по предметам, которые слушала его группа</li><li>Студент посетил столько занятий курса БД, сколько было проведено</li></ul></li></ul></div><div class="footer"><div class="test"><span class="author">Георгий Корнеев</span><span class="title">Базы данных / Изменение данных</span><span class="number">10</span></div></div></div></div>
<div class="slide"><div class="content"><h1>Проверка целостности</h1><div class="body"><ul class="item-1 level-1"><li>Когда<ul class="item-2 level-2"><li>По завершении оператора</li><li>По завершении транзакции (отложенная)</li></ul></li><li>При неудаче<ul class="item-2 level-2"><li>Все изменения отменяются</li></ul></li></ul></div><div class="footer"><div class="test"><span class="author">Георгий Корнеев</span><span class="title">Базы данных / Изменение данных</span><span class="number">11</span></div></div></div></div>
<div class="slide subsection"><div class="content"><h1>Типы ограничения целостности</h1><h2>Содержание</h2><div class="body"><ol class="level-1 toc-1"><li><a href="#(2)" class="toc">Операторы</a></li><li><a href="#(8)" class="toc current">Целостность данных</a><ol class="level-2 toc-2"><li><a href="#(12)" class=" current">Типы ограничения целостности</a></li><li><a href="#(18)" class="">Компенсирующие действия</a></li></ol></li><li><a href="#(22)" class="toc">Триггеры</a></li><li><a href="#(26)" class="toc">Представления</a></li><li><a href="#(38)" class="toc">Управление доступом</a></li><li><a href="#(54)" class="toc">Литература</a></li></ol></div><div class="footer"><div class="test"><span class="author">Георгий Корнеев</span><span class="title">Базы данных / Изменение данных</span><span class="number">12</span></div></div></div></div>
<div class="slide"><div class="content"><h1>Ограничение типа</h1><div class="body"><ul class="item-1 level-1"><li>Множество значений, допустимых для типа</li><li>Примеры<ul class="item-2 level-2"><li>Дата <pre class="prettyprint lang-sql">Date
</pre></li><li>Имя <pre class="prettyprint lang-sql">create type Name as object (
    FirstName varchar(100),
    LastName varchar(100)
)
</pre></li><li>Баллы <pre class="prettyprint lang-sql">create type Points as object
(points as int between 0 and 100)
</pre></li></ul></li></ul></div><div class="footer"><div class="test"><span class="author">Георгий Корнеев</span><span class="title">Базы данных / Изменение данных</span><span class="number">13</span></div></div></div></div>
<div class="slide"><div class="content"><h1>Ограничение атрибута</h1><div class="body"><ul class="item-1 level-1"><li>Множество значений, допустимых для атрибута<ul class="item-2 level-2"><li>Является следствием его типа</li></ul></li><li>Примеры<ul class="item-2 level-2"><li>Дата: <pre class="prettyprint lang-sql">Enroll Date not null
</pre></li><li>Имя: <pre class="prettyprint lang-sql">SName Name
</pre></li><li>Баллы: <pre class="prettyprint lang-sql">CoursePoints Points
</pre></li></ul></li></ul></div><div class="footer"><div class="test"><span class="author">Георгий Корнеев</span><span class="title">Базы данных / Изменение данных</span><span class="number">14</span></div></div></div></div>
<div class="slide"><div class="content"><h1>Ограничение отношения</h1><div class="body"><ul class="item-1 level-1"><li>Множество значений<ul class="item-2 level-2"><li>Конъюнкция предикатов</li></ul></li><li>Типы предикатов<ul class="item-2 level-2"><li>Ключи</li><li>Внешние ключи</li><li>Проверяемые условия</li></ul></li><li>Примеры<ul class="item-2 level-2"><li><pre class="prettyprint lang-sql">primary key (SId, CId)
</pre></li><li><pre class="prettyprint lang-sql">unique (PassNo, PassSeries)
</pre></li><li><pre class="prettyprint lang-sql">foreign key (SId) references Students(SId)
</pre></li><li><pre class="prettyprint lang-sql">check (Points between 0 and 100)
</pre></li></ul></li></ul></div><div class="footer"><div class="test"><span class="author">Георгий Корнеев</span><span class="title">Базы данных / Изменение данных</span><span class="number">15</span></div></div></div></div>
<div class="slide"><div class="content"><h1>Проверяемые условия</h1><div class="body"><ul class="item-1 level-1"><li>Проверяются для каждого кортежа<ul class="item-2 level-2"><li>Неявный ∀</li><li>⇒ не проверяются для пустых отношений</li><li>Оптимизация в реализациях</li></ul></li><li>Примеры<ul class="item-2 level-2"><li><pre class="prettyprint lang-sql">SId in (select SId from Students)
</pre></li><li><pre class="prettyprint lang-sql">ExpulsionDate is not null or
not exists (select * from Points p
where p.SId = SId and p.CId = CId and Point &lt; 60)
</pre></li></ul></li></ul></div><div class="footer"><div class="test"><span class="author">Георгий Корнеев</span><span class="title">Базы данных / Изменение данных</span><span class="number">16</span></div></div></div></div>
<div class="slide"><div class="content"><h1>Ограничение базы данных</h1><div class="body"><ul class="item-1 level-1"><li>Множество значений, которые может принимать база данных<ul class="item-2 level-2"><li>Предикаты таблиц</li><li>Предикаты утверждений</li></ul></li><li>Предикаты утверждений<ul class="item-2 level-2"><li>Проверяются и для пустых отношений</li><li><pre class="prettyprint lang-sql">create assertion NonEmptyGroup check (not exists
    (select * from Groups g where not exists
        (select * from Students s where s.GId = g.GId)))
</pre></li></ul></li></ul></div><div class="footer"><div class="test"><span class="author">Георгий Корнеев</span><span class="title">Базы данных / Изменение данных</span><span class="number">17</span></div></div></div></div>
<div class="slide subsection"><div class="content"><h1>Компенсирующие действия</h1><h2>Содержание</h2><div class="body"><ol class="level-1 toc-1"><li><a href="#(2)" class="toc">Операторы</a></li><li><a href="#(8)" class="toc current">Целостность данных</a><ol class="level-2 toc-2"><li><a href="#(12)" class="">Типы ограничения целостности</a></li><li><a href="#(18)" class=" current">Компенсирующие действия</a></li></ol></li><li><a href="#(22)" class="toc">Триггеры</a></li><li><a href="#(26)" class="toc">Представления</a></li><li><a href="#(38)" class="toc">Управление доступом</a></li><li><a href="#(54)" class="toc">Литература</a></li></ol></div><div class="footer"><div class="test"><span class="author">Георгий Корнеев</span><span class="title">Базы данных / Изменение данных</span><span class="number">18</span></div></div></div></div>
<div class="slide"><div class="content"><h1>Компенсирующие действия</h1><div class="body"><ul class="item-1 level-1"><li>Удаление курса</li><li><span class="question">Что делать с оценками по нему?</span><ul class="item-2 level-2"><li class="incremental"><div class="non-incremental">Удалить все оценки по курсу</div></li><li class="incremental"><div class="non-incremental">Запретить удаление курса</div></li></ul></li><li class="incremental"><div class="non-incremental">В общем случае<ul class="item-2 level-2"><li>Каскадирование изменений</li><li>Ограничение изменений</li></ul></div></li></ul></div><div class="footer"><div class="test"><span class="author">Георгий Корнеев</span><span class="title">Базы данных / Изменение данных</span><span class="number">19</span></div></div></div></div>
<div class="slide"><div class="content"><h1>Типы компенсирующих действий</h1><div class="body"><ul class="item-1 level-1"><li>Опасные действия<ul class="item-2 level-2"><li>Удаление (<var>delete</var>)</li><li>Обновление (<var>update</var>)</li></ul></li><li>Производимый эффект<ul class="item-2 level-2"><li>Бездействие (<var>no action</var>)</li><li>Каскадирование (<var>cascade</var>)</li><li>Ограничение (<var>restrict</var>)</li><li>Обнуление (<var>set null</var>)</li><li>Установка значения по умолчанию (<var>set default</var>)</li></ul></li></ul></div><div class="footer"><div class="test"><span class="author">Георгий Корнеев</span><span class="title">Базы данных / Изменение данных</span><span class="number">20</span></div></div></div></div>
<div class="slide"><div class="content"><h1>Объявление компенсир. действий</h1><div class="body"><ul class="item-1 level-1"><li>Синтаксис<ul class="item-2 level-2"><li><pre class="prettyprint lang-sql">foreign key (столбцы)
references таблица [(столбцы)]
[on delete действие]
[on update действие]
</pre></li></ul></li><li>Примеры<ul class="item-2 level-2"><li><pre class="prettyprint lang-sql">foreign key (CId) references Courses
on delete cascade on update cascade</pre></li><li><pre class="prettyprint lang-sql">foreign key (SId) references Students
on delete restrict on update cascade
</pre></li></ul></li></ul></div><div class="footer"><div class="test"><span class="author">Георгий Корнеев</span><span class="title">Базы данных / Изменение данных</span><span class="number">21</span></div></div></div></div>
<div class="slide section"><div class="content"><h1>Триггеры</h1><h2>Содержание</h2><div class="body"><ol class="level-1 toc-1"><li><a href="#(2)" class="toc">Операторы</a></li><li><a href="#(8)" class="toc">Целостность данных</a></li><li><a href="#(22)" class="toc current">Триггеры</a></li><li><a href="#(26)" class="toc">Представления</a></li><li><a href="#(38)" class="toc">Управление доступом</a></li><li><a href="#(54)" class="toc">Литература</a></li></ol></div><div class="footer"><div class="test"><span class="author">Георгий Корнеев</span><span class="title">Базы данных / Изменение данных</span><span class="number">22</span></div></div></div></div>
<div class="slide"><div class="content"><h1>Триггеры</h1><div class="body"><ul class="item-1 level-1"><li>Действия, выполняемые при изменении данных<ul class="item-2 level-2"><li>Целостность данных</li><li>Любые действия</li></ul></li><li>Применение триггеров<ul class="item-2 level-2"><li>Уведомление пользователей</li><li>Обновления денормализованных данных</li><li>Аудит изменений</li><li>Компенсирующие действия</li></ul></li></ul></div><div class="footer"><div class="test"><span class="author">Георгий Корнеев</span><span class="title">Базы данных / Изменение данных</span><span class="number">23</span></div></div></div></div>
<div class="slide"><div class="content"><h1>Объявление триггеров</h1><div class="body"><ul class="item-1 level-1"><li>Синтаксис<ul class="item-2 level-2"><li><pre class="prettyprint lang-sql">create trigger имя on объект
{before | after | instead of} {insert | update | delete}
[объявление ссылок]
[for each {row | statement}]
действие
</pre></li></ul></li><li>Объявление ссылок<ul class="item-2 level-2"><li><pre class="prettyprint lang-sql">referencing {new|old} {row|table} имя
</pre></li></ul></li></ul></div><div class="footer"><div class="test"><span class="author">Георгий Корнеев</span><span class="title">Базы данных / Изменение данных</span><span class="number">24</span></div></div></div></div>
<div class="slide"><div class="content"><h1>Пример применения триггера</h1><div class="body"><ul class="item-1 level-1"><li>Каскадирование изменений<ul class="item-2 level-2"><li><pre class="prettyprint lang-sql">create trigger CascadeCourses
on Courses after delete
referencing old row c for each row
delete from points p where p.CId = c.CId
</pre></li></ul></li><li>Аудит изменений<ul class="item-2 level-2"><li><pre class="prettyprint lang-sql">create trigger AuditPoints
on Points after insert, update
referencing new row p
for each row set p.UpdateTime = current_timestamp()
</pre></li></ul></li></ul></div><div class="footer"><div class="test"><span class="author">Георгий Корнеев</span><span class="title">Базы данных / Изменение данных</span><span class="number">25</span></div></div></div></div>
<div class="slide section"><div class="content"><h1>Представления</h1><h2>Содержание</h2><div class="body"><ol class="level-1 toc-1"><li><a href="#(2)" class="toc">Операторы</a></li><li><a href="#(8)" class="toc">Целостность данных</a></li><li><a href="#(22)" class="toc">Триггеры</a></li><li><a href="#(26)" class="toc current">Представления</a><ol class="level-2 toc-2"><li><a href="#(29)" class="">Обновление представлений</a></li><li><a href="#(35)" class="">Материализованные представления</a></li></ol></li><li><a href="#(38)" class="toc">Управление доступом</a></li><li><a href="#(54)" class="toc">Литература</a></li></ol></div><div class="footer"><div class="test"><span class="author">Георгий Корнеев</span><span class="title">Базы данных / Изменение данных</span><span class="number">26</span></div></div></div></div>
<div class="slide"><div class="content"><h1>Представление</h1><div class="body"><ul class="item-1 level-1"><li>Именованный запрос</li><li>Применение представлений<ul class="item-2 level-2"><li>Макросы</li><li>Сокрытие данных</li><li>Независимость от данных</li></ul></li></ul></div><div class="footer"><div class="test"><span class="author">Георгий Корнеев</span><span class="title">Базы данных / Изменение данных</span><span class="number">27</span></div></div></div></div>
<div class="slide"><div class="content"><h1>Объявление представлений</h1><div class="body"><ul class="item-1 level-1"><li>Синтаксис<ul class="item-2 level-2"><li><pre class="prettyprint lang-sql">create view имя(столбцы) as запрос
</pre></li><li><pre class="prettyprint lang-sql">drop view имя
</pre></li></ul></li><li>Примеры<ul class="item-2 level-2"><li><pre class="prettyprint lang-sql">create view AveragePoints(SId, AvgPoints) as
select SId, avg(Points) from Points group by SId
</pre></li><li><pre class="prettyprint lang-sql">create view StudentCourse(FN, LN, N, P) as
select s.FirstName, s.LastName, c.Name, p.Points
from Students s natural join Points p natural join
Courses c
</pre></li></ul></li></ul></div><div class="footer"><div class="test"><span class="author">Георгий Корнеев</span><span class="title">Базы данных / Изменение данных</span><span class="number">28</span></div></div></div></div>
<div class="slide subsection"><div class="content"><h1>Обновление представлений</h1><h2>Содержание</h2><div class="body"><ol class="level-1 toc-1"><li><a href="#(2)" class="toc">Операторы</a></li><li><a href="#(8)" class="toc">Целостность данных</a></li><li><a href="#(22)" class="toc">Триггеры</a></li><li><a href="#(26)" class="toc current">Представления</a><ol class="level-2 toc-2"><li><a href="#(29)" class=" current">Обновление представлений</a></li><li><a href="#(35)" class="">Материализованные представления</a></li></ol></li><li><a href="#(38)" class="toc">Управление доступом</a></li><li><a href="#(54)" class="toc">Литература</a></li></ol></div><div class="footer"><div class="test"><span class="author">Георгий Корнеев</span><span class="title">Базы данных / Изменение данных</span><span class="number">29</span></div></div></div></div>
<div class="slide"><div class="content"><h1>Обновление представлений</h1><div class="body"><ul class="item-1 level-1"><li><span class="question">Зачем обновлять представления?</span><ul class="item-2 level-2"><li class="incremental"><div class="non-incremental">Для обеспечения независимости от данных</div></li><li class="incremental"><div class="non-incremental">Для сокрытия данных</div></li></ul></li><li class="incremental"><div class="non-incremental">Действия при обновлении<ul class="item-2 level-2"><li>Как если бы представление было таблицей</li><li>Взаимообратность вставки и удаления</li></ul></div></li><li class="incremental"><div class="non-incremental">Обновление<ul class="item-2 level-2"><li>Удаление (без проверки целостности)</li><li>Вставка</li></ul></div></li></ul></div><div class="footer"><div class="test"><span class="author">Георгий Корнеев</span><span class="title">Базы данных / Изменение данных</span><span class="number">30</span></div></div></div></div>
<div class="slide"><div class="content"><h1>Унарные операции</h1><div class="body"><ul class="item-1 level-1"><li><span class="mathO"><span class="math">$\sigma_P(R)$</span></span><ul class="item-2 level-2"><li>Кортеж должен удовлетворять <span class="mathO"><span class="math">$P$</span></span></li><li>Вставить кортеж в <span class="mathO"><span class="math">$R$</span></span></li><li>Удалить кортеж из <span class="mathO"><span class="math">$R$</span></span></li></ul></li><li class="incremental"><div class="non-incremental"><span class="mathO"><span class="math">$\pi_A(R)$</span></span><ul class="item-2 level-2"><li>Вставить кортеж в <span class="mathO"><span class="math">$R$</span></span> со значениями по умолчанию</li><li>Удалить все соответствующие кортежи из <span class="mathO"><span class="math">$R$</span></span></li></ul></div></li><li class="incremental"><div class="non-incremental"><span class="mathO"><span class="math">$\rho_{a=b}(R)$</span></span><ul class="item-2 level-2"><li>Вставить кортеж в <span class="mathO"><span class="math">$R$</span></span></li><li>Удалить кортеж из <span class="mathO"><span class="math">$R$</span></span></li></ul></div></li></ul></div><div class="footer"><div class="test"><span class="author">Георгий Корнеев</span><span class="title">Базы данных / Изменение данных</span><span class="number">31</span></div></div></div></div>
<div class="slide"><div class="content"><h1>Множественные операции</h1><div class="body"><ul class="item-1 level-1"><li><span class="mathO"><span class="math">$R_1 \cup R_2$</span></span><ul class="item-2 level-2"><li>Вставка<ul class="item-3 level-3"><li>Если кортеж удовлетворяет предикату <span class="mathO"><span class="math">$R_1$</span></span> ⇒ вставить в <span class="mathO"><span class="math">$R_1$</span></span></li><li>Если кортеж удовлетворяет предикату <span class="mathO"><span class="math">$R_2$</span></span> ⇒ вставить в <span class="mathO"><span class="math">$R_2$</span></span></li></ul></li><li>Удалить из <span class="mathO"><span class="math">$R_1$</span></span> и <span class="mathO"><span class="math">$R_2$</span></span></li></ul></li><li class="incremental"><div class="non-incremental"><span class="mathO"><span class="math">$R_1 \cap R_2$</span></span><ul class="item-2 level-2"><li>Вставить в <span class="mathO"><span class="math">$R_1$</span></span> и <span class="mathO"><span class="math">$R_2$</span></span></li><li>Удалить из <span class="mathO"><span class="math">$R_1$</span></span> и <span class="mathO"><span class="math">$R_2$</span></span></li></ul></div></li><li class="incremental"><div class="non-incremental"><span class="mathO"><span class="math">$R_1 - R_2$</span></span><ul class="item-2 level-2"><li>Вставить в <span class="mathO"><span class="math">$R_1$</span></span></li><li>Удалить из <span class="mathO"><span class="math">$R_1$</span></span></li></ul></div></li></ul></div><div class="footer"><div class="test"><span class="author">Георгий Корнеев</span><span class="title">Базы данных / Изменение данных</span><span class="number">32</span></div></div></div></div>
<div class="slide"><div class="content"><h1>Соединения</h1><div class="body"><ul class="item-1 level-1"><li><span class="mathO"><span class="math">$R_1 ⋈ R_2$</span></span><ul class="item-2 level-2"><li>Вставить в <span class="mathO"><span class="math">$R_1$</span></span> соответствующую часть кортежа Вставить в <span class="mathO"><span class="math">$R_2$</span></span> соответствующую часть кортежа</li><li>Удалить из <span class="mathO"><span class="math">$R_1$</span></span> соответствующую часть кортежа Удалить из <span class="mathO"><span class="math">$R_2$</span></span> соответствующую часть кортежа</li></ul></li><li>Базируется на ограничениях целостности<ul class="item-2 level-2"><li>Один-к-одному</li><li>Один-ко-многим</li><li>Многие-ко-многим</li></ul></li></ul></div><div class="footer"><div class="test"><span class="author">Георгий Корнеев</span><span class="title">Базы данных / Изменение данных</span><span class="number">33</span></div></div></div></div>
<div class="slide"><div class="content"><h1>Обновление и SQL</h1><div class="body"><ul class="item-1 level-1"><li>Унарные операции<ul class="item-2 level-2"><li>Обновляемые</li></ul></li><li>Множественные операции<ul class="item-2 level-2"><li>Необновляемые</li></ul></li><li>Соединения<ul class="item-2 level-2"><li>Один-к-одному – обновляемые</li><li>Один-ко-многим – обновляемые «многие»</li><li>Многие-ко-многим – необновляемые</li></ul></li></ul></div><div class="footer"><div class="test"><span class="author">Георгий Корнеев</span><span class="title">Базы данных / Изменение данных</span><span class="number">34</span></div></div></div></div>
<div class="slide subsection"><div class="content"><h1>Материализованные представления</h1><h2>Содержание</h2><div class="body"><ol class="level-1 toc-1"><li><a href="#(2)" class="toc">Операторы</a></li><li><a href="#(8)" class="toc">Целостность данных</a></li><li><a href="#(22)" class="toc">Триггеры</a></li><li><a href="#(26)" class="toc current">Представления</a><ol class="level-2 toc-2"><li><a href="#(29)" class="">Обновление представлений</a></li><li><a href="#(35)" class=" current">Материализованные представления</a></li></ol></li><li><a href="#(38)" class="toc">Управление доступом</a></li><li><a href="#(54)" class="toc">Литература</a></li></ol></div><div class="footer"><div class="test"><span class="author">Георгий Корнеев</span><span class="title">Базы данных / Изменение данных</span><span class="number">35</span></div></div></div></div>
<div class="slide"><div class="content"><h1>Материализованное представление</h1><div class="body"><ul class="item-1 level-1"><li>«Слепок» данных на определенный момент времени<ul class="item-2 level-2"><li>Обычно хранятся физически</li><li>Виртуальное удаление</li></ul></li><li>Преимущества<ul class="item-2 level-2"><li>Быстрота выборки</li><li>Возможность «фиксации»</li></ul></li><li>Недостатки<ul class="item-2 level-2"><li>Необходимость обновления</li><li>Устаревание данных</li><li>Занимают место</li></ul></li></ul></div><div class="footer"><div class="test"><span class="author">Георгий Корнеев</span><span class="title">Базы данных / Изменение данных</span><span class="number">36</span></div></div></div></div>
<div class="slide"><div class="content"><h1>Объявление матер. представлений</h1><div class="body"><ul class="item-1 level-1"><li>Синтаксис<ul class="item-2 level-2"><li><pre class="prettyprint lang-sql">create materialized view имя
[
    refresh [{fast|complete}] [on {demand|commit}]
    [start with время] [next время]
]
as запрос
</pre></li><li><pre class="prettyprint lang-sql">refresh materialized view имя
</pre></li></ul></li><li>Пример<ul class="item-2 level-2"><li><pre class="prettyprint lang-sql">create materialized view AveragePoints
refresh next dateadd(day, current_timestamp(), 1)
as select SId, avg(Points) from Points group by SId
</pre></li></ul></li></ul></div><div class="footer"><div class="test"><span class="author">Георгий Корнеев</span><span class="title">Базы данных / Изменение данных</span><span class="number">37</span></div></div></div></div>
<div class="slide section"><div class="content"><h1>Управление доступом</h1><h2>Содержание</h2><div class="body"><ol class="level-1 toc-1"><li><a href="#(2)" class="toc">Операторы</a></li><li><a href="#(8)" class="toc">Целостность данных</a></li><li><a href="#(22)" class="toc">Триггеры</a></li><li><a href="#(26)" class="toc">Представления</a></li><li><a href="#(38)" class="toc current">Управление доступом</a><ol class="level-2 toc-2"><li><a href="#(39)" class="">Схемы управления доступом</a></li><li><a href="#(43)" class="">Пользователи и группы</a></li><li><a href="#(46)" class="">Data Control Language</a></li><li><a href="#(50)" class="">Представления и права</a></li></ol></li><li><a href="#(54)" class="toc">Литература</a></li></ol></div><div class="footer"><div class="test"><span class="author">Георгий Корнеев</span><span class="title">Базы данных / Изменение данных</span><span class="number">38</span></div></div></div></div>
<div class="slide subsection"><div class="content"><h1>Схемы управления доступом</h1><h2>Содержание</h2><div class="body"><ol class="level-1 toc-1"><li><a href="#(2)" class="toc">Операторы</a></li><li><a href="#(8)" class="toc">Целостность данных</a></li><li><a href="#(22)" class="toc">Триггеры</a></li><li><a href="#(26)" class="toc">Представления</a></li><li><a href="#(38)" class="toc current">Управление доступом</a><ol class="level-2 toc-2"><li><a href="#(39)" class=" current">Схемы управления доступом</a></li><li><a href="#(43)" class="">Пользователи и группы</a></li><li><a href="#(46)" class="">Data Control Language</a></li><li><a href="#(50)" class="">Представления и права</a></li></ol></li><li><a href="#(54)" class="toc">Литература</a></li></ol></div><div class="footer"><div class="test"><span class="author">Георгий Корнеев</span><span class="title">Базы данных / Изменение данных</span><span class="number">39</span></div></div></div></div>
<div class="slide"><div class="content"><h1>Схемы управления доступом</h1><div class="body"><ul class="item-1 level-1"><li>Избирательная (дискреционная)<ul class="item-2 level-2"><li>Списки доступа</li></ul></li><li>Мандатная<ul class="item-2 level-2"><li>Классификационный уровень</li></ul></li></ul></div><div class="footer"><div class="test"><span class="author">Георгий Корнеев</span><span class="title">Базы данных / Изменение данных</span><span class="number">40</span></div></div></div></div>
<div class="slide"><div class="content"><h1>Дискреционная схема</h1><div class="body"><ul class="item-1 level-1"><li>Объекты<ul class="item-2 level-2"><li>Права на них</li><li>Отдельные права никак не связаны</li></ul></li><li>Пользователи<ul class="item-2 level-2"><li>Права пользователей</li></ul></li><li>Группы пользователей<ul class="item-2 level-2"><li>Права групп</li></ul></li></ul></div><div class="footer"><div class="test"><span class="author">Георгий Корнеев</span><span class="title">Базы данных / Изменение данных</span><span class="number">41</span></div></div></div></div>
<div class="slide"><div class="content"><h1>Мандатная схема</h1><div class="body"><ul class="item-1 level-1"><li>Классификационные уровни<ul class="item-2 level-2"><li>«Матрешка»</li><li>Уровень пользователя</li><li>Уровень ресурса</li></ul></li><li>Чтение<ul class="item-2 level-2"><li>Уровень ресурса &lt; уровня пользователя</li></ul></li><li>Изменение<ul class="item-2 level-2"><li>Уровень ресурса = уровню пользователя</li></ul></li><li>Добавление (не всегда)<ul class="item-2 level-2"><li>Уровень ресурса &gt; уровня пользователя</li></ul></li></ul></div><div class="footer"><div class="test"><span class="author">Георгий Корнеев</span><span class="title">Базы данных / Изменение данных</span><span class="number">42</span></div></div></div></div>
<div class="slide subsection"><div class="content"><h1>Пользователи и группы</h1><h2>Содержание</h2><div class="body"><ol class="level-1 toc-1"><li><a href="#(2)" class="toc">Операторы</a></li><li><a href="#(8)" class="toc">Целостность данных</a></li><li><a href="#(22)" class="toc">Триггеры</a></li><li><a href="#(26)" class="toc">Представления</a></li><li><a href="#(38)" class="toc current">Управление доступом</a><ol class="level-2 toc-2"><li><a href="#(39)" class="">Схемы управления доступом</a></li><li><a href="#(43)" class=" current">Пользователи и группы</a></li><li><a href="#(46)" class="">Data Control Language</a></li><li><a href="#(50)" class="">Представления и права</a></li></ol></li><li><a href="#(54)" class="toc">Литература</a></li></ol></div><div class="footer"><div class="test"><span class="author">Георгий Корнеев</span><span class="title">Базы данных / Изменение данных</span><span class="number">43</span></div></div></div></div>
<div class="slide"><div class="content"><h1>Управление пользователями</h1><div class="body"><ul class="item-1 level-1"><li>Синтаксис (не SQL)<ul class="item-2 level-2"><li><pre class="prettyprint lang-sql">create user имя [password 'пароль']
</pre></li><li><pre class="prettyprint lang-sql">alter user имя [password 'пароль']
</pre></li><li><pre class="prettyprint lang-sql">drop user имя
</pre></li></ul></li><li>Примеры<ul class="item-2 level-2"><li><pre class="prettyprint lang-sql">create user kgeorgiy;
</pre></li><li><pre class="prettyprint lang-sql">alter user kgeorgiy password '***';
</pre></li><li><pre class="prettyprint lang-sql">drop user kgeorgiy;
</pre></li></ul></li></ul></div><div class="footer"><div class="test"><span class="author">Георгий Корнеев</span><span class="title">Базы данных / Изменение данных</span><span class="number">44</span></div></div></div></div>
<div class="slide"><div class="content"><h1>Управление группами</h1><div class="body"><ul class="item-1 level-1"><li>Синтаксис (не SQL)<ul class="item-2 level-2"><li><pre class="prettyprint lang-sql">create group имя
</pre></li><li><pre class="prettyprint lang-sql">alter group имя {add|drop} user пользователь
</pre></li><li><pre class="prettyprint lang-sql">drop group имя
</pre></li></ul></li><li>Примеры<ul class="item-2 level-2"><li><pre class="prettyprint lang-sql">create group lecturers;
</pre></li><li><pre class="prettyprint lang-sql">alter group lecturers add user kgeorgiy;
</pre></li><li><pre class="prettyprint lang-sql">drop group lecturers;
</pre></li></ul></li></ul></div><div class="footer"><div class="test"><span class="author">Георгий Корнеев</span><span class="title">Базы данных / Изменение данных</span><span class="number">45</span></div></div></div></div>
<div class="slide subsection"><div class="content"><h1>Data Control Language</h1><h2>Содержание</h2><div class="body"><ol class="level-1 toc-1"><li><a href="#(2)" class="toc">Операторы</a></li><li><a href="#(8)" class="toc">Целостность данных</a></li><li><a href="#(22)" class="toc">Триггеры</a></li><li><a href="#(26)" class="toc">Представления</a></li><li><a href="#(38)" class="toc current">Управление доступом</a><ol class="level-2 toc-2"><li><a href="#(39)" class="">Схемы управления доступом</a></li><li><a href="#(43)" class="">Пользователи и группы</a></li><li><a href="#(46)" class=" current">Data Control Language</a></li><li><a href="#(50)" class="">Представления и права</a></li></ol></li><li><a href="#(54)" class="toc">Литература</a></li></ol></div><div class="footer"><div class="test"><span class="author">Георгий Корнеев</span><span class="title">Базы данных / Изменение данных</span><span class="number">46</span></div></div></div></div>
<div class="slide"><div class="content"><h1>Добавление прав</h1><div class="body"><ul class="item-1 level-1"><li>Синтаксис<ul class="item-2 level-2"><li><pre class="prettyprint lang-sql">grant {select|insert|update|delete|create
         |execute|trigger|usage|…|all privileges}
on {table|database|view|procedure|function|…} имя
to {пользователь|group группа|public}
[with grant option]
</pre></li></ul></li><li>Примеры<ul class="item-2 level-2"><li><pre class="prettyprint lang-sql">grant all privileges on Students
  to group Deans with grant option;
</pre></li><li><pre class="prettyprint lang-sql">grant select on Students to public;
</pre></li></ul></li></ul></div><div class="footer"><div class="test"><span class="author">Георгий Корнеев</span><span class="title">Базы данных / Изменение данных</span><span class="number">47</span></div></div></div></div>
<div class="slide"><div class="content"><h1>Удаление прав</h1><div class="body"><ul class="item-1 level-1"><li>Синтаксис<ul class="item-2 level-2"><li><pre class="prettyprint lang-sql">revoke [grant option for]
{select|insert|update|delete|create
   |execute|trigger|usage|…|all privileges}
on {table|database|view|procedure|function|…} имя
from {пользователь|group группа|public}
[cascade|restrict]
</pre></li></ul></li><li>Примеры<ul class="item-2 level-2"><li><pre class="prettyprint lang-sql">revoke insert on Students
    from group Deans cascade;
</pre></li><li><pre class="prettyprint lang-sql">revoke update on Students from public;
</pre></li></ul></li></ul></div><div class="footer"><div class="test"><span class="author">Георгий Корнеев</span><span class="title">Базы данных / Изменение данных</span><span class="number">48</span></div></div></div></div>
<div class="slide"><div class="content"><h1>Владелец объекта</h1><div class="body"><ul class="item-1 level-1"><li>Имеет все права на объект<ul class="item-2 level-2"><li>Создатель</li><li>Не может ограничить свои права</li></ul></li><li>Изменение владельца<ul class="item-2 level-2"><li><pre class="prettyprint lang-sql">alter {table|schema|database|…}
owner to пользователь
</pre></li></ul></li></ul></div><div class="footer"><div class="test"><span class="author">Георгий Корнеев</span><span class="title">Базы данных / Изменение данных</span><span class="number">49</span></div></div></div></div>
<div class="slide subsection"><div class="content"><h1>Представления и права</h1><h2>Содержание</h2><div class="body"><ol class="level-1 toc-1"><li><a href="#(2)" class="toc">Операторы</a></li><li><a href="#(8)" class="toc">Целостность данных</a></li><li><a href="#(22)" class="toc">Триггеры</a></li><li><a href="#(26)" class="toc">Представления</a></li><li><a href="#(38)" class="toc current">Управление доступом</a><ol class="level-2 toc-2"><li><a href="#(39)" class="">Схемы управления доступом</a></li><li><a href="#(43)" class="">Пользователи и группы</a></li><li><a href="#(46)" class="">Data Control Language</a></li><li><a href="#(50)" class=" current">Представления и права</a></li></ol></li><li><a href="#(54)" class="toc">Литература</a></li></ol></div><div class="footer"><div class="test"><span class="author">Георгий Корнеев</span><span class="title">Базы данных / Изменение данных</span><span class="number">50</span></div></div></div></div>
<div class="slide"><div class="content"><h1>Фильтрованная таблица</h1><div class="body"><ul class="item-1 level-1"><li>Представление, содержащее не все кортежи<ul class="item-2 level-2"><li>Может быть изменяемым</li></ul></li><li>Пример<ul class="item-2 level-2"><li><pre class="prettyprint lang-sql">create view FITPStudents as
select * from Students
where GId in
(select GId from Group where FId = 'ИТиП')
</pre></li><li><pre class="prettyprint lang-sql">grant all privileges on FITPStudents to FITPDean;
</pre></li></ul></li></ul></div><div class="footer"><div class="test"><span class="author">Георгий Корнеев</span><span class="title">Базы данных / Изменение данных</span><span class="number">51</span></div></div></div></div>
<div class="slide"><div class="content"><h1>Спроецированная таблица</h1><div class="body"><ul class="item-1 level-1"><li>Представление, содержащее не все атрибуты<ul class="item-2 level-2"><li>Может быть изменяемым</li></ul></li><li>Пример<ul class="item-2 level-2"><li><pre class="prettyprint lang-sql">create view PublicStudents as
select SId, FirstName, LastName
   /* No passport info, etc */
from Students
</pre></li><li><pre class="prettyprint lang-sql">grant select on PublicStudents to public;
</pre></li></ul></li></ul></div><div class="footer"><div class="test"><span class="author">Георгий Корнеев</span><span class="title">Базы данных / Изменение данных</span><span class="number">52</span></div></div></div></div>
<div class="slide"><div class="content"><h1>Агрегированная таблица</h1><div class="body"><ul class="item-1 level-1"><li>Представление, содержащее агрегированные данные<ul class="item-2 level-2"><li>Подвержено дифференциальным атакам</li></ul></li><li>Пример<ul class="item-2 level-2"><li><pre class="prettyprint lang-sql">create view StudentPoints as
select SId, avg(points)
from Students natural join Marks
</pre></li><li><pre class="prettyprint lang-sql">grant select on StudentPoints to public;
</pre></li></ul></li></ul></div><div class="footer"><div class="test"><span class="author">Георгий Корнеев</span><span class="title">Базы данных / Изменение данных</span><span class="number">53</span></div></div></div></div>
<div class="slide section"><div class="content"><h1>Литература</h1><h2>Содержание</h2><div class="body"><ol class="level-1 toc-1"><li><a href="#(2)" class="toc">Операторы</a></li><li><a href="#(8)" class="toc">Целостность данных</a></li><li><a href="#(22)" class="toc">Триггеры</a></li><li><a href="#(26)" class="toc">Представления</a></li><li><a href="#(38)" class="toc">Управление доступом</a></li><li><a href="#(54)" class="toc current">Литература</a></li></ol></div><div class="footer"><div class="test"><span class="author">Георгий Корнеев</span><span class="title">Базы данных / Изменение данных</span><span class="number">54</span></div></div></div></div>
<div class="slide"><div class="content"><h1>Основная литература</h1><div class="body"><ul class="item-1 level-1"><li><em>Дейт К.</em> Введение в системы баз данных (главы 9, 10, 17)</li><li><em>Уидом Д.</em>, <em>Ульман Д.</em> Основы реляционных баз данных (глава 6)</li><li><em>Gulutzan P.</em>, <em>Pelzer T.</em> SQL-99 complete, really<ul class="item-2 level-2"><li><a href="https://crate.io/docs/sql-99/en/latest/chapters/35.html" target="_blank">Chapter 35 – Changing SQL-data</a></li><li><a href="https://crate.io/docs/sql-99/en/latest/chapters/18.html" target="_blank">Chapter 18 – Table and View</a></li><li><a href="https://crate.io/docs/sql-99/en/latest/chapters/20.html" target="_blank">Chapter 20 – SQL Constraint and Assertion</a></li><li><a href="https://crate.io/docs/sql-99/en/latest/chapters/24.html" target="_blank">Chapter 24 – SQL Trigger</a></li><li><a href="https://crate.io/docs/sql-99/en/latest/chapters/15.html" target="_blank">Chapter 15 – SQL Authorization</a></li></ul></li></ul></div><div class="footer"><div class="test"><span class="author">Георгий Корнеев</span><span class="title">Базы данных / Изменение данных</span><span class="number">55</span></div></div></div></div></div></body></html>