<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html lang="ru" xml:lang="ru" xmlns="http://www.w3.org/1999/xhtml"><head><title>Базы данных / Оптимизация запросов</title><meta name="author" content="" /><link rel="stylesheet" type="text/css" media="screen, projection, print" href="scripts/slidy.css" /><link rel="stylesheet" type="text/css" href="scripts/prettify.css" /><link rel="stylesheet" type="text/css" href="scripts/kgeorgiy-slides.css" /><script type="text/javascript" src="scripts/slidy.js" charset="utf-8" /><script type="text/javascript" src="scripts/kgeorgiy-slides.js" charset="utf-8" /><script type="text/javascript" src="scripts/prettify.js" /><script type="text/javascript" src="scripts/lang-sql.js" /><script type="text/javascript" src="scripts/lang-javaModule.js" /><script type="text/javascript" src="scripts/lang-scala.js" /><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js?config=TeX-AMS-MML_HTMLorMML" /><script type="text/javascript">MathJax.Hub.Config({tex2jax: {inlineMath: [['$','$']], displayMath: [['$$','$$']], ignoreClass: "", processClass: "math|lang-math"}});</script><script>var _gaq=_gaq||[];_gaq.push(["_setAccount","UA-37693764-1"]);_gaq.push(["_setDomainName","kgeorgiy.info"]);_gaq.push(["_trackPageview"]);(function(){var a=document.createElement("script");a.type="text/javascript";a.async=!0;a.src=("https:"==document.location.protocol?"https://ssl":"http://www")+".google-analytics.com/ga.js";var b=document.getElementsByTagName("script")[0];b.parentNode.insertBefore(a,b)})();</script><script async="async" src="https://www.googletagmanager.com/gtag/js?id=G-8EQ66D87ZZ" /><script>
                  window.dataLayer = window.dataLayer || [];
                  function gtag(){dataLayer.push(arguments);}
                  gtag('js', new Date());

                  gtag('config', 'G-8EQ66D87ZZ');
                </script></head><body onload="prettyPrint()"><div id="all"><span class="mathO"><span class="math">$ \newcommand{\gdiv}{\mathbin{⋇}} \newcommand\joineq{\raise{-0.05ex}{\unicode{xa78a}}} \newcommand{\rjoin}{\mathbin{⋉\mkern-6mu\joineq}} \newcommand{\ljoin}{\mathbin{\joineq\mkern-6mu⋊}} \newcommand{\ojoin}{\mathbin{\joineq\mkern-10mu×\mkern-10mu\joineq}}$</span></span>
<div class="slide cover"><div class="content"><div class="course">Базы данных</div><hr /><div class="lecture"><div>Оптимизация запросов</div></div><div class="link"><a href="https://kgeorgiy.info/courses/dbms/">https://kgeorgiy.info/courses/dbms/</a></div><div class="copyright"><a href="http://creativecommons.org/licenses/by-nc-sa/4.0/deed.ru"><span class="copyright">Copyright © Георгий Корнеев</span><img src="scripts/by-nc-sa.png" alt="Attribution-NonCommercial-ShareAlike" /></a></div></div></div>
<div class="slide section"><div class="content"><h1>Обработка запросов</h1><h2>Содержание</h2><div class="body"><ol class="level-1 toc-1"><li><a href="#(2)" class="toc current">Обработка запросов</a><ol class="level-2 toc-2"><li><a href="#(3)" class="">Мотивирующий пример</a></li><li><a href="#(9)" class="">Обработка запросов</a></li></ol></li><li><a href="#(15)" class="toc">Перезапись запроса</a></li><li><a href="#(33)" class="toc">Методы исполнения</a></li><li><a href="#(52)" class="toc">Выбор структуры запроса</a></li><li><a href="#(63)" class="toc">Оценка размера и распределения</a></li><li><a href="#(77)" class="toc">Пример оптимизации запроса</a></li><li><a href="#(100)" class="toc">Литература</a></li></ol></div><div class="footer"><div class="test"><span class="author">Георгий Корнеев</span><span class="title">Базы данных / Оптимизация запросов</span><span class="number">2</span></div></div></div></div>
<div class="slide subsection"><div class="content"><h1>Мотивирующий пример</h1><h2>Содержание</h2><div class="body"><ol class="level-1 toc-1"><li><a href="#(2)" class="toc current">Обработка запросов</a><ol class="level-2 toc-2"><li><a href="#(3)" class=" current">Мотивирующий пример</a></li><li><a href="#(9)" class="">Обработка запросов</a></li></ol></li><li><a href="#(15)" class="toc">Перезапись запроса</a></li><li><a href="#(33)" class="toc">Методы исполнения</a></li><li><a href="#(52)" class="toc">Выбор структуры запроса</a></li><li><a href="#(63)" class="toc">Оценка размера и распределения</a></li><li><a href="#(77)" class="toc">Пример оптимизации запроса</a></li><li><a href="#(100)" class="toc">Литература</a></li></ol></div><div class="footer"><div class="test"><span class="author">Георгий Корнеев</span><span class="title">Базы данных / Оптимизация запросов</span><span class="number">3</span></div></div></div></div>
<div class="slide"><div class="content"><h1>Пример базы данных</h1><div class="body"><ul class="item-1 level-1"><li><var>Students(SId, FirstName, LastName, GId, Year)</var><ul class="item-2 level-2"><li><span class="mathO"><span class="math">$10^4$</span></span> записей</li><li>Индексы: <var>(SId)</var> (кластеризованный), <var>(GId)</var></li></ul></li><li><var>Groups(GId, Name)</var><ul class="item-2 level-2"><li><span class="mathO"><span class="math">$10^3$</span></span> записей</li><li>Индексы: <var>(GId)</var> (кластеризованный), <var>(Name)</var></li></ul></li></ul></div><div class="footer"><div class="test"><span class="author">Георгий Корнеев</span><span class="title">Базы данных / Оптимизация запросов</span><span class="number">4</span></div></div></div></div>
<div class="slide"><div class="content"><h1>Запрос</h1><div class="body"><ul class="item-1 level-1"><li>Фамилии студентов группы M3439<ul class="item-2 level-2"><li><pre class="prettyprint lang-sql">select LastName
from Students natural join Groups
where Name = 'M34391'
</pre></li></ul></li></ul></div><div class="footer"><div class="test"><span class="author">Георгий Корнеев</span><span class="title">Базы данных / Оптимизация запросов</span><span class="number">5</span></div></div></div></div>
<div class="slide"><div class="content"><h1>Планы запросов без индексов</h1><div class="body"><ul class="item-1 level-1"><li>План 1<ul class="item-2 level-2"><li><span class="mathO"><span class="math">$π_{LastName}(σ_{Name=M34391}(σ_{S.GId=G.GId}(S × G)))$</span></span></li><li><span class="mathO"><span class="math">$10^4·10^3 + 10^4·10^3 + 10^4 + 20 ≈ 2·10^7$</span></span></li></ul></li><li>План 2<ul class="item-2 level-2"><li><span class="mathO"><span class="math">$π_{LastName}(σ_{Name=M34391}(S ⋈ G))$</span></span></li><li><span class="mathO"><span class="math">$10^4·10^3 + 10^4 + 20 ≈ 10^7$</span></span></li></ul></li><li>План 3<ul class="item-2 level-2"><li><span class="mathO"><span class="math">$π_{LastName}(S ⋈ σ_{Name=M34391}(G))$</span></span></li><li><span class="mathO"><span class="math">$10^3 + 10^4 + 20 ≈ 10^4$</span></span></li></ul></li></ul></div><div class="footer"><div class="test"><span class="author">Георгий Корнеев</span><span class="title">Базы данных / Оптимизация запросов</span><span class="number">6</span></div></div></div></div>
<div class="slide"><div class="content"><h1>Планы запросов с индексами</h1><div class="body"><ul class="item-1 level-1"><li>План 3. <var>Students(GId)</var><ul class="item-2 level-2"><li><span class="mathO"><span class="math">$π_{LastName}(S ⋈ σ_{Name=M34391}(G))$</span></span></li><li><span class="mathO"><span class="math">$10^3 + (3 + 20) + 20 ≈ 10^3$</span></span></li></ul></li><li>План 4. <var>Groups(Name)</var>, <var>Students(GId)</var><ul class="item-2 level-2"><li><span class="mathO"><span class="math">$π_{LastName}(S ⋈ σ_{Name=M34391}(G))$</span></span></li><li><span class="mathO"><span class="math">$2 + (3 + 20) + 20 = 45$</span></span></li></ul></li></ul></div><div class="footer"><div class="test"><span class="author">Георгий Корнеев</span><span class="title">Базы данных / Оптимизация запросов</span><span class="number">7</span></div></div></div></div>
<div class="slide"><div class="content"><h1>Результаты</h1><div class="body"><ul class="item-1 level-1"><li>Наиболее медленный план<ul class="item-2 level-2"><li><span class="mathO"><span class="math">$2·10^7$</span></span></li></ul></li><li>Наиболее быстрый план<ul class="item-2 level-2"><li><span class="mathO"><span class="math">$45$</span></span></li></ul></li><li class="incremental"><div class="non-incremental">⇒ От выбора плана <var>сильно</var> зависит производительность</div></li></ul></div><div class="footer"><div class="test"><span class="author">Георгий Корнеев</span><span class="title">Базы данных / Оптимизация запросов</span><span class="number">8</span></div></div></div></div>
<div class="slide subsection"><div class="content"><h1>Обработка запросов</h1><h2>Содержание</h2><div class="body"><ol class="level-1 toc-1"><li><a href="#(2)" class="toc current">Обработка запросов</a><ol class="level-2 toc-2"><li><a href="#(3)" class="">Мотивирующий пример</a></li><li><a href="#(9)" class=" current">Обработка запросов</a></li></ol></li><li><a href="#(15)" class="toc">Перезапись запроса</a></li><li><a href="#(33)" class="toc">Методы исполнения</a></li><li><a href="#(52)" class="toc">Выбор структуры запроса</a></li><li><a href="#(63)" class="toc">Оценка размера и распределения</a></li><li><a href="#(77)" class="toc">Пример оптимизации запроса</a></li><li><a href="#(100)" class="toc">Литература</a></li></ol></div><div class="footer"><div class="test"><span class="author">Георгий Корнеев</span><span class="title">Базы данных / Оптимизация запросов</span><span class="number">9</span></div></div></div></div>
<div class="slide"><div class="content"><h1>Обработка запроса </h1><div class="body"><img class="bottom" src="pics/Structure_Query.svg" /></div><div class="footer"><div class="test"><span class="author">Георгий Корнеев</span><span class="title">Базы данных / Оптимизация запросов</span><span class="number">10</span></div></div></div></div>
<div class="slide"><div class="content"><h1>Планировщик запроса </h1><div class="body"><div class="img-width"><img class="width" style="width: 80%" src="pics/Structure_Planner.svg" /></div></div><div class="footer"><div class="test"><span class="author">Георгий Корнеев</span><span class="title">Базы данных / Оптимизация запросов</span><span class="number">11</span></div></div></div></div>
<div class="slide"><div class="content"><h1>Перезапись и планировщик</h1><div class="body"><ul class="item-1 level-1"><li>Перезапись запроса<ul class="item-2 level-2"><li>Статические правила оптимизации запроса</li><li>Считается, что полезны всегда</li></ul></li><li>Планировщик запроса<ul class="item-2 level-2"><li>Оптимизация в зависимости от данных</li><li>Перебор и оценка вариантов</li></ul></li></ul></div><div class="footer"><div class="test"><span class="author">Георгий Корнеев</span><span class="title">Базы данных / Оптимизация запросов</span><span class="number">12</span></div></div></div></div>
<div class="slide"><div class="content"><h1>Выбор структуры и метода</h1><div class="body"><ul class="item-1 level-1"><li>Выбор структуры<ul class="item-2 level-2"><li>Преобразование запроса</li><li>Порядок выполнения операций</li><li>Порядок соединений</li></ul></li><li>Выбор метода исполнения<ul class="item-2 level-2"><li>Как исполняется каждая операция</li></ul></li></ul></div><div class="footer"><div class="test"><span class="author">Георгий Корнеев</span><span class="title">Базы данных / Оптимизация запросов</span><span class="number">13</span></div></div></div></div>
<div class="slide"><div class="content"><h1>Оценка плана</h1><div class="body"><ul class="item-1 level-1"><li>Модель стоимости<ul class="item-2 level-2"><li>Стоимость операции</li><li>Размер операндов</li><li>Размер результата</li></ul></li><li>Оценка размера и распределения<ul class="item-2 level-2"><li>Статистика по данным</li><li>Статистика предыдущих запросов</li></ul></li></ul></div><div class="footer"><div class="test"><span class="author">Георгий Корнеев</span><span class="title">Базы данных / Оптимизация запросов</span><span class="number">14</span></div></div></div></div>
<div class="slide section"><div class="content"><h1>Перезапись запроса</h1><h2>Содержание</h2><div class="body"><ol class="level-1 toc-1"><li><a href="#(2)" class="toc">Обработка запросов</a></li><li><a href="#(15)" class="toc current">Перезапись запроса</a><ol class="level-2 toc-2"><li><a href="#(16)" class="">Минимизация набора операций</a></li><li><a href="#(19)" class="">Унарные операции</a></li><li><a href="#(23)" class="">Алгебраические свойства операций</a></li><li><a href="#(27)" class="">Обработка условий</a></li><li><a href="#(30)" class="">Семантические оптимизации</a></li></ol></li><li><a href="#(33)" class="toc">Методы исполнения</a></li><li><a href="#(52)" class="toc">Выбор структуры запроса</a></li><li><a href="#(63)" class="toc">Оценка размера и распределения</a></li><li><a href="#(77)" class="toc">Пример оптимизации запроса</a></li><li><a href="#(100)" class="toc">Литература</a></li></ol></div><div class="footer"><div class="test"><span class="author">Георгий Корнеев</span><span class="title">Базы данных / Оптимизация запросов</span><span class="number">15</span></div></div></div></div>
<div class="slide subsection"><div class="content"><h1>Минимизация набора операций</h1><h2>Содержание</h2><div class="body"><ol class="level-1 toc-1"><li><a href="#(2)" class="toc">Обработка запросов</a></li><li><a href="#(15)" class="toc current">Перезапись запроса</a><ol class="level-2 toc-2"><li><a href="#(16)" class=" current">Минимизация набора операций</a></li><li><a href="#(19)" class="">Унарные операции</a></li><li><a href="#(23)" class="">Алгебраические свойства операций</a></li><li><a href="#(27)" class="">Обработка условий</a></li><li><a href="#(30)" class="">Семантические оптимизации</a></li></ol></li><li><a href="#(33)" class="toc">Методы исполнения</a></li><li><a href="#(52)" class="toc">Выбор структуры запроса</a></li><li><a href="#(63)" class="toc">Оценка размера и распределения</a></li><li><a href="#(77)" class="toc">Пример оптимизации запроса</a></li><li><a href="#(100)" class="toc">Литература</a></li></ol></div><div class="footer"><div class="test"><span class="author">Георгий Корнеев</span><span class="title">Базы данных / Оптимизация запросов</span><span class="number">16</span></div></div></div></div>
<div class="slide"><div class="content"><h1>Преобразование подзапросов</h1><div class="body"><ul class="item-1 level-1"><li>Преобразуются в реляционную алгебру<ul class="item-2 level-2"><li>Запись в реляционном исчислении</li><li>Вынос кванторов</li><li>Преобразование в алгебру</li></ul></li></ul></div><div class="footer"><div class="test"><span class="author">Георгий Корнеев</span><span class="title">Базы данных / Оптимизация запросов</span><span class="number">17</span></div></div></div></div>
<div class="slide"><div class="content"><h1>Преобразование соединений</h1><div class="body"><ul class="item-1 level-1"><li>Внешние соединения<ul class="item-2 level-2"><li><span class="mathO"><span class="math">$R_1 \ojoin_θ R_2 ⇒ (R_1 \ljoin_θ R_2) ∪ (R_1 \rjoin_θ R_2)$</span></span></li><li><span class="mathO"><span class="math">$R_1 \ljoin_θ R_2 ⇒ σ_θ(R_1 × R_2) ∪ (R_1 - π_{R_1}(σ_θ(R_1 × R_2)))$</span></span></li><li><span class="mathO"><span class="math">$R_1 \rjoin_θ R_2 ⇒ σ_θ(R_1 × R_2) ∪ (R_2 - π_{R_2}(σ_θ(R_1 × R_2)))$</span></span></li></ul></li><li>Декартово соединение<ul class="item-2 level-2"><li><span class="mathO"><span class="math">$R_1 × R_2 ⇒ R_1 ⋈ R_2$</span></span></li></ul></li></ul></div><div class="footer"><div class="test"><span class="author">Георгий Корнеев</span><span class="title">Базы данных / Оптимизация запросов</span><span class="number">18</span></div></div></div></div>
<div class="slide subsection"><div class="content"><h1>Унарные операции</h1><h2>Содержание</h2><div class="body"><ol class="level-1 toc-1"><li><a href="#(2)" class="toc">Обработка запросов</a></li><li><a href="#(15)" class="toc current">Перезапись запроса</a><ol class="level-2 toc-2"><li><a href="#(16)" class="">Минимизация набора операций</a></li><li><a href="#(19)" class=" current">Унарные операции</a></li><li><a href="#(23)" class="">Алгебраические свойства операций</a></li><li><a href="#(27)" class="">Обработка условий</a></li><li><a href="#(30)" class="">Семантические оптимизации</a></li></ol></li><li><a href="#(33)" class="toc">Методы исполнения</a></li><li><a href="#(52)" class="toc">Выбор структуры запроса</a></li><li><a href="#(63)" class="toc">Оценка размера и распределения</a></li><li><a href="#(77)" class="toc">Пример оптимизации запроса</a></li><li><a href="#(100)" class="toc">Литература</a></li></ol></div><div class="footer"><div class="test"><span class="author">Георгий Корнеев</span><span class="title">Базы данных / Оптимизация запросов</span><span class="number">19</span></div></div></div></div>
<div class="slide"><div class="content"><h1>Повторная фильтрация</h1><div class="body"><ul class="item-1 level-1"><li>Правило<ul class="item-2 level-2"><li>Повторное применение фильтрации заменяется одинарным</li><li><span class="mathO"><span class="math">$σ_{cond_1}(σ_{cond_2}(R)) ⇒ σ_{cond_1 ∧ cond_2}(R)$</span></span></li></ul></li><li>Пример<ul class="item-2 level-2"><li><span class="mathO"><span class="math">$π_{FirstName}(σ_{Name=M34391}(σ_{S.GId=G.GId}(S × G)))$</span></span> ⇒ <span class="mathO"><span class="math">$π_{FirstName}(σ_{Name=M34391 ∧ S.GId=G.GId}(S × G))$</span></span></li></ul></li></ul></div><div class="footer"><div class="test"><span class="author">Георгий Корнеев</span><span class="title">Базы данных / Оптимизация запросов</span><span class="number">20</span></div></div></div></div>
<div class="slide"><div class="content"><h1>Повторная проекция</h1><div class="body"><ul class="item-1 level-1"><li>Правило<ul class="item-2 level-2"><li>Повторное применение проекции заменяется внешней</li><li><span class="mathO"><span class="math">$π_{A}(π_{B}(R)) ⇒ π_{A}(R)$</span></span></li></ul></li><li>Пример<ul class="item-2 level-2"><li><span class="mathO"><span class="math">$π_{FirstName}(π_{FirstName, Name}(S × G))$</span></span> ⇒ <span class="mathO"><span class="math">$π_{FirstName}(S × G)$</span></span></li></ul></li></ul></div><div class="footer"><div class="test"><span class="author">Георгий Корнеев</span><span class="title">Базы данных / Оптимизация запросов</span><span class="number">21</span></div></div></div></div>
<div class="slide"><div class="content"><h1>Проекция и фильтрация</h1><div class="body"><ul class="item-1 level-1"><li>Правило<ul class="item-2 level-2"><li>Фильтрация осуществляется до проекции</li><li><span class="mathO"><span class="math">$σ_{cond}(π_{A}(R)) ⇒ π_{A}(σ_{cond}(R))$</span></span></li></ul></li><li>Пример<ul class="item-2 level-2"><li><span class="mathO"><span class="math">$π_{FirstName}(σ_{Name=M34391}(π_{FirstName, Name}(S × G)))$</span></span> ⇒ <span class="mathO"><span class="math">$π_{FirstName}(π_{FirstName, Name}(σ_{Name=M34391}(S × G)))$</span></span> ⇒ <span class="mathO"><span class="math">$π_{FirstName}(σ_{Name=M34391}(S × G))$</span></span></li></ul></li><li class="incremental"><div class="non-incremental"><span class="question">Всегда ли так можно сделать?</span><ul class="item-2 level-2"><li class="incremental"><div class="non-incremental">Да</div></li></ul></div></li><li class="incremental"><div class="non-incremental"><span class="question">А наоборот?</span><ul class="item-2 level-2"><li class="incremental"><div class="non-incremental">Нет</div></li></ul></div></li></ul></div><div class="footer"><div class="test"><span class="author">Георгий Корнеев</span><span class="title">Базы данных / Оптимизация запросов</span><span class="number">22</span></div></div></div></div>
<div class="slide subsection"><div class="content"><h1>Алгебраические свойства операций</h1><h2>Содержание</h2><div class="body"><ol class="level-1 toc-1"><li><a href="#(2)" class="toc">Обработка запросов</a></li><li><a href="#(15)" class="toc current">Перезапись запроса</a><ol class="level-2 toc-2"><li><a href="#(16)" class="">Минимизация набора операций</a></li><li><a href="#(19)" class="">Унарные операции</a></li><li><a href="#(23)" class=" current">Алгебраические свойства операций</a></li><li><a href="#(27)" class="">Обработка условий</a></li><li><a href="#(30)" class="">Семантические оптимизации</a></li></ol></li><li><a href="#(33)" class="toc">Методы исполнения</a></li><li><a href="#(52)" class="toc">Выбор структуры запроса</a></li><li><a href="#(63)" class="toc">Оценка размера и распределения</a></li><li><a href="#(77)" class="toc">Пример оптимизации запроса</a></li><li><a href="#(100)" class="toc">Литература</a></li></ol></div><div class="footer"><div class="test"><span class="author">Георгий Корнеев</span><span class="title">Базы данных / Оптимизация запросов</span><span class="number">23</span></div></div></div></div>
<div class="slide"><div class="content"><h1>Дистрибутивность операций</h1><div class="body"><ul class="item-1 level-1"><li>Фильтрация<ul class="item-2 level-2"><li><span class="mathO"><span class="math">$σ_{cond}(R_1 ∪ R_2) ⇒ σ_{cond}(R_1) ∪ σ_{cond}(R_2)$</span></span></li><li><span class="mathO"><span class="math">$σ_{cond}(R_1 \cap R_2) ⇒ σ_{cond}(R_1) \cap σ_{cond}(R_2)$</span></span></li><li><span class="mathO"><span class="math">$σ_{cond}(R_1 - R_2) ⇒ σ_{cond}(R_1) - σ_{cond}(R_2)$</span></span></li><li><span class="mathO"><span class="math">$σ_{cond_1 ∧ cond_2}(R_1 ⋈ R_2) ⇒ σ_{cond_1}(R_1) ⋈ σ_{cond_2}(R_2)$</span></span></li></ul></li><li>Проекция<ul class="item-2 level-2"><li><span class="warn"><span class="mathO"><span class="math">$π_A(R_1 ∪ R_2) ⇒ π_A(R_1) ∪ π_A(R_2)$</span></span></span> (меньше)</li><li><span class="warn"><span class="mathO"><span class="math">$π_A(R_1 ∩ R_2) ⇏ π_A(R_1) ∩ π_A(R_2)$</span></span></span> (больше)</li><li><span class="warn"><span class="mathO"><span class="math">$π_A(R_1 - R_2) ⇏ π_A(R_1) - π_A(R_2)$</span></span></span></li><li><span class="mathO"><span class="math">$π_{A}(R_1 ⋈ R_2) ⇒ π_A(π_{(A ∪ R_2) ∩ R_1}(R_1) ⋈ π_{(A ∪ R_1) ∩ R_2}(R_2))$</span></span></li></ul></li></ul></div><div class="footer"><div class="test"><span class="author">Георгий Корнеев</span><span class="title">Базы данных / Оптимизация запросов</span><span class="number">24</span></div></div></div></div>
<div class="slide"><div class="content"><h1>Коммутативность операций</h1><div class="body"><ul class="item-1 level-1"><li>Коммутативные операции<ul class="item-2 level-2"><li><span class="mathO"><span class="math">$⋈$</span></span></li><li><span class="mathO"><span class="math">$∪$</span></span></li><li><span class="mathO"><span class="math">$∩$</span></span></li></ul></li><li>Некоммутативные операции<ul class="item-2 level-2"><li><span class="mathO"><span class="math">$-$</span></span></li><li><span class="mathO"><span class="math">$\div$</span></span>, <span class="mathO"><span class="math">$\gdiv$</span></span></li></ul></li><li>Применение коммутативности<ul class="item-2 level-2"><li>Выбор левой и правой стороны для несимметричных методов исполнения</li></ul></li></ul></div><div class="footer"><div class="test"><span class="author">Георгий Корнеев</span><span class="title">Базы данных / Оптимизация запросов</span><span class="number">25</span></div></div></div></div>
<div class="slide"><div class="content"><h1>Ассоциативность операций</h1><div class="body"><ul class="item-1 level-1"><li>Ассоциативные операции<ul class="item-2 level-2"><li><span class="mathO"><span class="math">$⋈$</span></span></li><li><span class="mathO"><span class="math">$∪$</span></span></li><li><span class="mathO"><span class="math">$∩$</span></span></li></ul></li><li>Неассоциативные операции<ul class="item-2 level-2"><li><span class="mathO"><span class="math">$-$</span></span></li><li><span class="mathO"><span class="math">$\div$</span></span>, <span class="mathO"><span class="math">$\gdiv$</span></span></li></ul></li><li>Применение ассоциативности<ul class="item-2 level-2"><li>Выбор порядка выполнения операций</li></ul></li></ul></div><div class="footer"><div class="test"><span class="author">Георгий Корнеев</span><span class="title">Базы данных / Оптимизация запросов</span><span class="number">26</span></div></div></div></div>
<div class="slide subsection"><div class="content"><h1>Обработка условий</h1><h2>Содержание</h2><div class="body"><ol class="level-1 toc-1"><li><a href="#(2)" class="toc">Обработка запросов</a></li><li><a href="#(15)" class="toc current">Перезапись запроса</a><ol class="level-2 toc-2"><li><a href="#(16)" class="">Минимизация набора операций</a></li><li><a href="#(19)" class="">Унарные операции</a></li><li><a href="#(23)" class="">Алгебраические свойства операций</a></li><li><a href="#(27)" class=" current">Обработка условий</a></li><li><a href="#(30)" class="">Семантические оптимизации</a></li></ol></li><li><a href="#(33)" class="toc">Методы исполнения</a></li><li><a href="#(52)" class="toc">Выбор структуры запроса</a></li><li><a href="#(63)" class="toc">Оценка размера и распределения</a></li><li><a href="#(77)" class="toc">Пример оптимизации запроса</a></li><li><a href="#(100)" class="toc">Литература</a></li></ol></div><div class="footer"><div class="test"><span class="author">Георгий Корнеев</span><span class="title">Базы данных / Оптимизация запросов</span><span class="number">27</span></div></div></div></div>
<div class="slide"><div class="content"><h1>Замыкание предикатов</h1><div class="body"><ul class="item-1 level-1"><li>Примеры правил<ul class="item-2 level-2"><li><span class="mathO"><span class="math">$a = b ∧ b = c$</span></span> ⇒ <span class="mathO"><span class="math">$a = b ∧ b = c ∧ a = c$</span></span></li><li><span class="mathO"><span class="math">$a &gt; b ∧ b = c$</span></span> ⇒ <span class="mathO"><span class="math">$a &gt; b ∧ b = c ∧ a &gt; c$</span></span></li><li><span class="mathO"><span class="math">$a &gt; b ∧ b &gt; c$</span></span> ⇒ <span class="mathO"><span class="math">$a &gt; b ∧ b &gt; c ∧ a &gt; c$</span></span></li></ul></li><li>Пример<ul class="item-2 level-2"><li><span class="mathO"><span class="math">$σ_{P_1.p &gt; P_2.p ∧ P_2.p ≥ 60}(P_1 ⋈_{P_1.SId = P_2.SId} P_2)$</span></span> ⇒ <span class="mathO"><span class="math">$σ_{P_1.p &gt; P_2.p ∧ P_2.p ≥ 60 ∧ P_1.p &gt; 60}(P_1 ⋈_{P_1.SId = P_2.SId} P_2)$</span></span> ⇒ <span class="mathO"><span class="math">$σ_{P_1.p &gt; P_2.p}(σ_{p &gt; 60}(P_1) ⋈_{P_1.SId = P_2.SId} σ_{p ≥ 60}(P_2))$</span></span></li></ul></li></ul></div><div class="footer"><div class="test"><span class="author">Георгий Корнеев</span><span class="title">Базы данных / Оптимизация запросов</span><span class="number">28</span></div></div></div></div>
<div class="slide"><div class="content"><h1>КНФ и ДНФ</h1><div class="body"><ul class="item-1 level-1"><li>Преобразование предикатов<ul class="item-2 level-2"><li>Конъюнктивная нормальная форма</li><li>Дизъюнктивная нормальная форма</li></ul></li><li>Вычисление КНФ<ul class="item-2 level-2"><li>Слева направо, до первой лжи</li></ul></li><li>Вычисление ДНФ<ul class="item-2 level-2"><li>Слева направо, до первой истины</li></ul></li></ul></div><div class="footer"><div class="test"><span class="author">Георгий Корнеев</span><span class="title">Базы данных / Оптимизация запросов</span><span class="number">29</span></div></div></div></div>
<div class="slide subsection"><div class="content"><h1>Семантические оптимизации</h1><h2>Содержание</h2><div class="body"><ol class="level-1 toc-1"><li><a href="#(2)" class="toc">Обработка запросов</a></li><li><a href="#(15)" class="toc current">Перезапись запроса</a><ol class="level-2 toc-2"><li><a href="#(16)" class="">Минимизация набора операций</a></li><li><a href="#(19)" class="">Унарные операции</a></li><li><a href="#(23)" class="">Алгебраические свойства операций</a></li><li><a href="#(27)" class="">Обработка условий</a></li><li><a href="#(30)" class=" current">Семантические оптимизации</a></li></ol></li><li><a href="#(33)" class="toc">Методы исполнения</a></li><li><a href="#(52)" class="toc">Выбор структуры запроса</a></li><li><a href="#(63)" class="toc">Оценка размера и распределения</a></li><li><a href="#(77)" class="toc">Пример оптимизации запроса</a></li><li><a href="#(100)" class="toc">Литература</a></li></ol></div><div class="footer"><div class="test"><span class="author">Георгий Корнеев</span><span class="title">Базы данных / Оптимизация запросов</span><span class="number">30</span></div></div></div></div>
<div class="slide"><div class="content"><h1>Семантическая оптимизация</h1><div class="body"><ul class="item-1 level-1"><li>Применение знания об ограничениях<ul class="item-2 level-2"><li>Неэквивалентные запросы</li><li>Тот же результат</li></ul></li><li>Пример<ul class="item-2 level-2"><li><span class="mathO"><span class="math">$π_{FirstName}(Students ⋈ Groups)$</span></span></li><li>⇒ <span class="mathO"><span class="math">$π_{FirstName}(σ_{GId ≠ null}(Students))$</span></span>, <br ignore="ignore" /> если <span class="mathO"><span class="math">$Students.GId ⊆ Groups.GId$</span></span></li><li>⇒ <span class="mathO"><span class="math">$π_{FirstName}(Students)$</span></span>, <br ignore="ignore" /> если <span class="mathO"><span class="math">$Students.GId ⊆ Groups.GId$</span></span> и <span class="mathO"><span class="math">$GId ≠ null$</span></span></li></ul></li></ul></div><div class="footer"><div class="test"><span class="author">Георгий Корнеев</span><span class="title">Базы данных / Оптимизация запросов</span><span class="number">31</span></div></div></div></div>
<div class="slide"><div class="content"><h1>Пример оптимизации</h1><div class="body"><ul class="item-1 level-1"><li>Ограничение<ul class="item-2 level-2"><li>У всех, кто получает стипендию, все оценки <span class="mathO"><span class="math">$≥ 60$</span></span></li><li><pre class="prettyprint lang-sql">check not HasScolarship or 60 &lt;=
  all (select Points from Points where Points.SId = Id)
</pre></li></ul></li><li>Запрос<ul class="item-2 level-2"><li>Оценки стипендиатов группы M34391 по СУБД</li><li><pre class="prettyprint lang-sql">select Points from Students natural join Points
where HasScolarship and CId = 10 and GId = M34391
</pre></li><li><span class="mathO"><span class="math">$σ_{GId=M34391 ∧ HasScolarship ∧ CId = 10}(Students ⋈ Points)$</span></span></li></ul></li><li>Оптимизированный запрос<ul class="item-2 level-2"><li><span class="mathO"><span class="math">$σ_{GId=M34391 ∧ HasScolarship}(Students) ⋈$</span></span><br ignore="ignore" /><span class="mathO"><span class="math">$⋈ σ_{60 ≥ Points ∧ CId = 10}(Points)$</span></span></li></ul></li></ul></div><div class="footer"><div class="test"><span class="author">Георгий Корнеев</span><span class="title">Базы данных / Оптимизация запросов</span><span class="number">32</span></div></div></div></div>
<div class="slide section"><div class="content"><h1>Методы исполнения</h1><h2>Содержание</h2><div class="body"><ol class="level-1 toc-1"><li><a href="#(2)" class="toc">Обработка запросов</a></li><li><a href="#(15)" class="toc">Перезапись запроса</a></li><li><a href="#(33)" class="toc current">Методы исполнения</a><ol class="level-2 toc-2"><li><a href="#(37)" class="">Унарные операции</a></li><li><a href="#(42)" class="">Операции над множествами</a></li><li><a href="#(47)" class="">Соединения</a></li></ol></li><li><a href="#(52)" class="toc">Выбор структуры запроса</a></li><li><a href="#(63)" class="toc">Оценка размера и распределения</a></li><li><a href="#(77)" class="toc">Пример оптимизации запроса</a></li><li><a href="#(100)" class="toc">Литература</a></li></ol></div><div class="footer"><div class="test"><span class="author">Георгий Корнеев</span><span class="title">Базы данных / Оптимизация запросов</span><span class="number">33</span></div></div></div></div>
<div class="slide"><div class="content"><h1>Сеть операций</h1><div class="body"><ul class="item-1 level-1"><li>Аргументы операции<ul class="item-2 level-2"><li>Базовые таблицы</li><li>Результаты других операций</li></ul></li><li>Результат операций<ul class="item-2 level-2"><li>Аргумент другой операции</li><li>Окончательный результат <img class="bottom" src="pics/Network_Students.svg" /></li></ul></li></ul></div><div class="footer"><div class="test"><span class="author">Георгий Корнеев</span><span class="title">Базы данных / Оптимизация запросов</span><span class="number">34</span></div></div></div></div>
<div class="slide"><div class="content"><h1>Типы операций</h1><div class="body"><ul class="item-1 level-1"><li>Преобразователи<ul class="item-2 level-2"><li>Просматривают аргументы в процессе работы</li></ul></li><li>Контейнеры<ul class="item-2 level-2"><li>Загружают аргументы</li><li>Сохраняют результаты</li><li>При необходимости – на диске <img class="bottom" src="pics/Network_Students_Types.svg" /></li></ul></li></ul></div><div class="footer"><div class="test"><span class="author">Георгий Корнеев</span><span class="title">Базы данных / Оптимизация запросов</span><span class="number">35</span></div></div></div></div>
<div class="slide"><div class="content"><h1>Курсоры</h1><div class="body"><ul class="item-1 level-1"><li>Выдают записи последовательно</li><li>Операции<ul class="item-2 level-2"><li><var>open()</var> – открыть курсор</li><li><var>fetch()</var> – следующая строка</li><li><var>reset()</var> – начать с начала</li><li><var>close()</var> – закрыть курсор</li></ul></li></ul></div><div class="footer"><div class="test"><span class="author">Георгий Корнеев</span><span class="title">Базы данных / Оптимизация запросов</span><span class="number">36</span></div></div></div></div>
<div class="slide subsection"><div class="content"><h1>Унарные операции</h1><h2>Содержание</h2><div class="body"><ol class="level-1 toc-1"><li><a href="#(2)" class="toc">Обработка запросов</a></li><li><a href="#(15)" class="toc">Перезапись запроса</a></li><li><a href="#(33)" class="toc current">Методы исполнения</a><ol class="level-2 toc-2"><li><a href="#(37)" class=" current">Унарные операции</a></li><li><a href="#(42)" class="">Операции над множествами</a></li><li><a href="#(47)" class="">Соединения</a></li></ol></li><li><a href="#(52)" class="toc">Выбор структуры запроса</a></li><li><a href="#(63)" class="toc">Оценка размера и распределения</a></li><li><a href="#(77)" class="toc">Пример оптимизации запроса</a></li><li><a href="#(100)" class="toc">Литература</a></li></ol></div><div class="footer"><div class="test"><span class="author">Георгий Корнеев</span><span class="title">Базы данных / Оптимизация запросов</span><span class="number">37</span></div></div></div></div>
<div class="slide"><div class="content"><h1>Фильтрация</h1><div class="body"><ul class="item-1 level-1"><li>Преобразователь<ul class="item-2 level-2"><li>Выкидывает ненужные строки</li></ul></li><li>Трудоёмкость<ul class="item-2 level-2"><li><span class="mathO"><span class="math">$O(n)$</span></span>, где <span class="mathO"><span class="math">$n$</span></span> – размер входа</li></ul></li><li>Свойства<ul class="item-2 level-2"><li>Может сильно уменьшать количество строк (селективность)</li></ul></li></ul></div><div class="footer"><div class="test"><span class="author">Георгий Корнеев</span><span class="title">Базы данных / Оптимизация запросов</span><span class="number">38</span></div></div></div></div>
<div class="slide"><div class="content"><h1>Проекция</h1><div class="body"><ul class="item-1 level-1"><li>Преобразователь<ul class="item-2 level-2"><li>Выкидывает ненужные атрибуты</li><li>Сравнивает соседние элементы</li></ul></li><li>Трудоёмкость<ul class="item-2 level-2"><li><span class="mathO"><span class="math">$O(n)$</span></span>, где <span class="mathO"><span class="math">$n$</span></span> – размер входа</li></ul></li><li>Свойства<ul class="item-2 level-2"><li>Вход должен быть упорядочен</li><li>Сохраняет порядок</li></ul></li></ul></div><div class="footer"><div class="test"><span class="author">Георгий Корнеев</span><span class="title">Базы данных / Оптимизация запросов</span><span class="number">39</span></div></div></div></div>
<div class="slide"><div class="content"><h1>Сортировка</h1><div class="body"><ul class="item-1 level-1"><li>Контейнер<ul class="item-2 level-2"><li>Сортировка в памяти</li><li>Внешняя сортировка</li></ul></li><li>Трудоёмкость<ul class="item-2 level-2"><li><span class="mathO"><span class="math">$O(n \log n)$</span></span>, где <span class="mathO"><span class="math">$n$</span></span> – размер входа</li></ul></li><li>Свойства<ul class="item-2 level-2"><li>Выход упорядочен</li><li>Время исполнения скачкообразно зависит от объема</li></ul></li></ul></div><div class="footer"><div class="test"><span class="author">Георгий Корнеев</span><span class="title">Базы данных / Оптимизация запросов</span><span class="number">40</span></div></div></div></div>
<div class="slide"><div class="content"><h1>Просмотр таблиц</h1><div class="body"><ul class="item-1 level-1"><li>Преобразователь и контейнер<ul class="item-2 level-2"><li>Полный проход по таблице</li><li>Внешняя сортировка</li></ul></li><li>Трудоёмкость<ul class="item-2 level-2"><li><span class="mathO"><span class="math">$O(n)$</span></span>, где <span class="mathO"><span class="math">$n$</span></span> – размер входа</li></ul></li><li>Методы исполнения<ul class="item-2 level-2"><li>Полный просмотр</li><li>Индекс</li><li>Кластеризованный индекс</li></ul></li></ul></div><div class="footer"><div class="test"><span class="author">Георгий Корнеев</span><span class="title">Базы данных / Оптимизация запросов</span><span class="number">41</span></div></div></div></div>
<div class="slide subsection"><div class="content"><h1>Операции над множествами</h1><h2>Содержание</h2><div class="body"><ol class="level-1 toc-1"><li><a href="#(2)" class="toc">Обработка запросов</a></li><li><a href="#(15)" class="toc">Перезапись запроса</a></li><li><a href="#(33)" class="toc current">Методы исполнения</a><ol class="level-2 toc-2"><li><a href="#(37)" class="">Унарные операции</a></li><li><a href="#(42)" class=" current">Операции над множествами</a></li><li><a href="#(47)" class="">Соединения</a></li></ol></li><li><a href="#(52)" class="toc">Выбор структуры запроса</a></li><li><a href="#(63)" class="toc">Оценка размера и распределения</a></li><li><a href="#(77)" class="toc">Пример оптимизации запроса</a></li><li><a href="#(100)" class="toc">Литература</a></li></ol></div><div class="footer"><div class="test"><span class="author">Георгий Корнеев</span><span class="title">Базы данных / Оптимизация запросов</span><span class="number">42</span></div></div></div></div>
<div class="slide"><div class="content"><h1>Объединение</h1><div class="body"><ul class="item-1 level-1"><li>Преобразователь<ul class="item-2 level-2"><li>Слияние входов</li></ul></li><li>Трудоёмкость<ul class="item-2 level-2"><li><span class="mathO"><span class="math">$O(n)$</span></span>, где <span class="mathO"><span class="math">$n$</span></span> – размер входа</li></ul></li><li>Свойства<ul class="item-2 level-2"><li>Упорядоченные входы</li><li>Упорядоченный результат</li></ul></li></ul></div><div class="footer"><div class="test"><span class="author">Георгий Корнеев</span><span class="title">Базы данных / Оптимизация запросов</span><span class="number">43</span></div></div></div></div>
<div class="slide"><div class="content"><h1>Полное объединение</h1><div class="body"><ul class="item-1 level-1"><li>Преобразователь<ul class="item-2 level-2"><li>Чтение первого входа</li><li>Чтение второго входа</li><li>...</li></ul></li><li>Трудоёмкость<ul class="item-2 level-2"><li><span class="mathO"><span class="math">$O(n)$</span></span>, где <span class="mathO"><span class="math">$n$</span></span> – размер входа</li></ul></li></ul></div><div class="footer"><div class="test"><span class="author">Георгий Корнеев</span><span class="title">Базы данных / Оптимизация запросов</span><span class="number">44</span></div></div></div></div>
<div class="slide"><div class="content"><h1>Пересечение</h1><div class="body"><ul class="item-1 level-1"><li>Преобразователь<ul class="item-2 level-2"><li>Слияние входов</li></ul></li><li>Трудоёмкость<ul class="item-2 level-2"><li><span class="mathO"><span class="math">$O(n)$</span></span>, где <span class="mathO"><span class="math">$n$</span></span> – размер входа</li></ul></li><li>Свойства<ul class="item-2 level-2"><li>Упорядоченные входы</li><li>Упорядоченный результат</li></ul></li></ul></div><div class="footer"><div class="test"><span class="author">Георгий Корнеев</span><span class="title">Базы данных / Оптимизация запросов</span><span class="number">45</span></div></div></div></div>
<div class="slide"><div class="content"><h1>Разность</h1><div class="body"><ul class="item-1 level-1"><li>Преобразователь<ul class="item-2 level-2"><li>Слияние входов</li></ul></li><li>Трудоёмкость<ul class="item-2 level-2"><li><span class="mathO"><span class="math">$O(n)$</span></span>, где <span class="mathO"><span class="math">$n$</span></span> – размер входа</li></ul></li><li>Свойства<ul class="item-2 level-2"><li>Упорядоченные входы</li><li>Упорядоченный результат</li></ul></li></ul></div><div class="footer"><div class="test"><span class="author">Георгий Корнеев</span><span class="title">Базы данных / Оптимизация запросов</span><span class="number">46</span></div></div></div></div>
<div class="slide subsection"><div class="content"><h1>Соединения</h1><h2>Содержание</h2><div class="body"><ol class="level-1 toc-1"><li><a href="#(2)" class="toc">Обработка запросов</a></li><li><a href="#(15)" class="toc">Перезапись запроса</a></li><li><a href="#(33)" class="toc current">Методы исполнения</a><ol class="level-2 toc-2"><li><a href="#(37)" class="">Унарные операции</a></li><li><a href="#(42)" class="">Операции над множествами</a></li><li><a href="#(47)" class=" current">Соединения</a></li></ol></li><li><a href="#(52)" class="toc">Выбор структуры запроса</a></li><li><a href="#(63)" class="toc">Оценка размера и распределения</a></li><li><a href="#(77)" class="toc">Пример оптимизации запроса</a></li><li><a href="#(100)" class="toc">Литература</a></li></ol></div><div class="footer"><div class="test"><span class="author">Георгий Корнеев</span><span class="title">Базы данных / Оптимизация запросов</span><span class="number">47</span></div></div></div></div>
<div class="slide"><div class="content"><h1>Вложенный перебор</h1><div class="body"><ul class="item-1 level-1"><li>Преобразователь<ul class="item-2 level-2"><li>Перебор левого входа</li><li>Перебор правого входа</li></ul></li><li>Трудоёмкость<ul class="item-2 level-2"><li><span class="mathO"><span class="math">$O(l·r)$</span></span>, где <span class="mathO"><span class="math">$l$</span></span>, <span class="mathO"><span class="math">$r$</span></span> – размеры входов</li></ul></li><li>Свойства<ul class="item-2 level-2"><li>Сохраняет упорядоченность</li></ul></li></ul></div><div class="footer"><div class="test"><span class="author">Георгий Корнеев</span><span class="title">Базы данных / Оптимизация запросов</span><span class="number">48</span></div></div></div></div>
<div class="slide"><div class="content"><h1>Поиск по дереву</h1><div class="body"><ul class="item-1 level-1"><li>Преобразователь<ul class="item-2 level-2"><li>Перебор левого входа</li><li>Доступ к правому входу по индексу</li></ul></li><li>Трудоёмкость<ul class="item-2 level-2"><li><span class="mathO"><span class="math">$O(\max(l·\log r, n))$</span></span>, где <span class="mathO"><span class="math">$l$</span></span>, <span class="mathO"><span class="math">$r$</span></span> – размеры входов, <br ignore="ignore" /><span class="mathO"><span class="math">$n$</span></span> – выхода</li></ul></li><li>Свойства<ul class="item-2 level-2"><li>Сохраняет упорядоченность</li></ul></li></ul></div><div class="footer"><div class="test"><span class="author">Георгий Корнеев</span><span class="title">Базы данных / Оптимизация запросов</span><span class="number">49</span></div></div></div></div>
<div class="slide"><div class="content"><h1>Поиск по хэшу</h1><div class="body"><ul class="item-1 level-1"><li>Преобразователь+контейнер<ul class="item-2 level-2"><li>Захэшировать правый вход</li><li>Перебор левого входа</li><li>Доступ по хэшу к правому входу</li></ul></li><li>Трудоёмкость<ul class="item-2 level-2"><li><span class="mathO"><span class="math">$O(\max(l + r, n))$</span></span>, где <span class="mathO"><span class="math">$l$</span></span>, <span class="mathO"><span class="math">$r$</span></span> – размеры входов, <span class="mathO"><span class="math">$n$</span></span> – выхода</li></ul></li></ul></div><div class="footer"><div class="test"><span class="author">Георгий Корнеев</span><span class="title">Базы данных / Оптимизация запросов</span><span class="number">50</span></div></div></div></div>
<div class="slide"><div class="content"><h1>Слияние</h1><div class="body"><ul class="item-1 level-1"><li>Преобразователь<ul class="item-2 level-2"><li>Слияние входов</li><li>Перебор левого входа пока равны</li><li>Перебор правого входа пока равны</li></ul></li><li>Трудоёмкость<ul class="item-2 level-2"><li><span class="mathO"><span class="math">$O(\max(l + r, n))$</span></span>, где <span class="mathO"><span class="math">$l$</span></span>, <span class="mathO"><span class="math">$r$</span></span> – размеры входов, <span class="mathO"><span class="math">$n$</span></span> – выхода</li></ul></li><li>Свойства<ul class="item-2 level-2"><li>Упорядоченные входы</li><li>Упорядоченный результат</li></ul></li></ul></div><div class="footer"><div class="test"><span class="author">Георгий Корнеев</span><span class="title">Базы данных / Оптимизация запросов</span><span class="number">51</span></div></div></div></div>
<div class="slide section"><div class="content"><h1>Выбор структуры запроса</h1><h2>Содержание</h2><div class="body"><ol class="level-1 toc-1"><li><a href="#(2)" class="toc">Обработка запросов</a></li><li><a href="#(15)" class="toc">Перезапись запроса</a></li><li><a href="#(33)" class="toc">Методы исполнения</a></li><li><a href="#(52)" class="toc current">Выбор структуры запроса</a><ol class="level-2 toc-2"><li><a href="#(53)" class="">Планирование операций</a></li><li><a href="#(57)" class="">Динамическое программирование</a></li><li><a href="#(60)" class="">Другие подходы</a></li></ol></li><li><a href="#(63)" class="toc">Оценка размера и распределения</a></li><li><a href="#(77)" class="toc">Пример оптимизации запроса</a></li><li><a href="#(100)" class="toc">Литература</a></li></ol></div><div class="footer"><div class="test"><span class="author">Георгий Корнеев</span><span class="title">Базы данных / Оптимизация запросов</span><span class="number">52</span></div></div></div></div>
<div class="slide subsection"><div class="content"><h1>Планирование операций</h1><h2>Содержание</h2><div class="body"><ol class="level-1 toc-1"><li><a href="#(2)" class="toc">Обработка запросов</a></li><li><a href="#(15)" class="toc">Перезапись запроса</a></li><li><a href="#(33)" class="toc">Методы исполнения</a></li><li><a href="#(52)" class="toc current">Выбор структуры запроса</a><ol class="level-2 toc-2"><li><a href="#(53)" class=" current">Планирование операций</a></li><li><a href="#(57)" class="">Динамическое программирование</a></li><li><a href="#(60)" class="">Другие подходы</a></li></ol></li><li><a href="#(63)" class="toc">Оценка размера и распределения</a></li><li><a href="#(77)" class="toc">Пример оптимизации запроса</a></li><li><a href="#(100)" class="toc">Литература</a></li></ol></div><div class="footer"><div class="test"><span class="author">Георгий Корнеев</span><span class="title">Базы данных / Оптимизация запросов</span><span class="number">53</span></div></div></div></div>
<div class="slide"><div class="content"><h1>Операции</h1><div class="body"><ul class="item-1 level-1"><li>Унарные<ul class="item-2 level-2"><li>Фильтрация – первый приоритет</li><li>Проекция – второй приоритет</li></ul></li><li>Над множествами<ul class="item-2 level-2"><li>Не влияют</li></ul></li><li>Соединения<ul class="item-2 level-2"><li>Порядок важен</li><li>Желательно сокращение результата</li><li>Число вариантов <span class="mathO"><span class="math">$n!C_n ≈ {n! 4^n \over n^{3/2} \sqrt π}$</span></span></li></ul></li></ul></div><div class="footer"><div class="test"><span class="author">Георгий Корнеев</span><span class="title">Базы данных / Оптимизация запросов</span><span class="number">54</span></div></div></div></div>
<div class="slide"><div class="content"><h1>Эвристика 1</h1><div class="body"><ul class="item-1 level-1"><li>Совершаются только запрошенные соединения</li><li>Пример<ul class="item-2 level-2"><li><pre class="prettyprint lang-sql">select * from Students natural join Points
natural join Courses
</pre></li></ul></li><li>Планы исполнения<ul class="item-2 level-2"><li><span class="mathO"><span class="math">$(Students ⋈ Points) ⋈ Courses$</span></span></li><li><span class="mathO"><span class="math">$(Points ⋈ Courses) ⋈ Students$</span></span></li><li><span class="warn"><span class="mathO"><span class="math">$(Students ⋈ Courses) ⋈ Points$</span></span></span></li></ul></li></ul></div><div class="footer"><div class="test"><span class="author">Георгий Корнеев</span><span class="title">Базы данных / Оптимизация запросов</span><span class="number">55</span></div></div></div></div>
<div class="slide"><div class="content"><h1>Эвристика 2</h1><div class="body"><ul class="item-1 level-1"><li>Правый вход каждого соединения – таблица<ul class="item-2 level-2"><li>Запрещены ветвящиеся деревья</li></ul></li><li>Пример<ul class="item-2 level-2"><li><pre class="prettyprint lang-sql">select * from Students natural join Points
natural join Courses natural join Lecturers
</pre></li></ul></li><li>Планы исполнения<ul class="item-2 level-2"><li><span class="mathO"><span class="math">$((Students ⋈ Points) ⋈ Courses) ⋈ Lecturers$</span></span></li><li><span class="mathO"><span class="math">$((Points ⋈ Courses) ⋈ Students) ⋈ Lecturers$</span></span></li><li><span class="warn"><span class="mathO"><span class="math">$(Students ⋈ Points) ⋈ (Courses ⋈ Lecturers)$</span></span></span></li></ul></li></ul></div><div class="footer"><div class="test"><span class="author">Георгий Корнеев</span><span class="title">Базы данных / Оптимизация запросов</span><span class="number">56</span></div></div></div></div>
<div class="slide subsection"><div class="content"><h1>Динамическое программирование</h1><h2>Содержание</h2><div class="body"><ol class="level-1 toc-1"><li><a href="#(2)" class="toc">Обработка запросов</a></li><li><a href="#(15)" class="toc">Перезапись запроса</a></li><li><a href="#(33)" class="toc">Методы исполнения</a></li><li><a href="#(52)" class="toc current">Выбор структуры запроса</a><ol class="level-2 toc-2"><li><a href="#(53)" class="">Планирование операций</a></li><li><a href="#(57)" class=" current">Динамическое программирование</a></li><li><a href="#(60)" class="">Другие подходы</a></li></ol></li><li><a href="#(63)" class="toc">Оценка размера и распределения</a></li><li><a href="#(77)" class="toc">Пример оптимизации запроса</a></li><li><a href="#(100)" class="toc">Литература</a></li></ol></div><div class="footer"><div class="test"><span class="author">Георгий Корнеев</span><span class="title">Базы данных / Оптимизация запросов</span><span class="number">57</span></div></div></div></div>
<div class="slide"><div class="content"><h1>Общая идея</h1><div class="body"><ul class="item-1 level-1"><li>Динамическое программирование<ul class="item-2 level-2"><li>На подмножествах</li></ul></li><li>Оптимизируемая функция<ul class="item-2 level-2"><li>Множество соединённых отношений</li><li>Виды упорядочения</li><li>⇒ минимальные трудозатраты</li></ul></li></ul></div><div class="footer"><div class="test"><span class="author">Георгий Корнеев</span><span class="title">Базы данных / Оптимизация запросов</span><span class="number">58</span></div></div></div></div>
<div class="slide"><div class="content"><h1>Этапы</h1><div class="body"><ul class="item-1 level-1"><li>База<ul class="item-2 level-2"><li>Полный просмотр</li><li>Частичный просмотр по кластеризованному индексу</li><li>Поиск по индексу</li></ul></li><li>Шаг<ul class="item-2 level-2"><li>Добавляем ко множеству все возможные отношения</li><li>Перебираем все методы реализации</li><li>Сохраняем наилучшие результаты</li></ul></li><li>Трудозатраты<ul class="item-2 level-2"><li>В большинстве случаев <span class="mathO"><span class="math">$O(2^n)$</span></span></li></ul></li></ul></div><div class="footer"><div class="test"><span class="author">Георгий Корнеев</span><span class="title">Базы данных / Оптимизация запросов</span><span class="number">59</span></div></div></div></div>
<div class="slide subsection"><div class="content"><h1>Другие подходы</h1><h2>Содержание</h2><div class="body"><ol class="level-1 toc-1"><li><a href="#(2)" class="toc">Обработка запросов</a></li><li><a href="#(15)" class="toc">Перезапись запроса</a></li><li><a href="#(33)" class="toc">Методы исполнения</a></li><li><a href="#(52)" class="toc current">Выбор структуры запроса</a><ol class="level-2 toc-2"><li><a href="#(53)" class="">Планирование операций</a></li><li><a href="#(57)" class="">Динамическое программирование</a></li><li><a href="#(60)" class=" current">Другие подходы</a></li></ol></li><li><a href="#(63)" class="toc">Оценка размера и распределения</a></li><li><a href="#(77)" class="toc">Пример оптимизации запроса</a></li><li><a href="#(100)" class="toc">Литература</a></li></ol></div><div class="footer"><div class="test"><span class="author">Георгий Корнеев</span><span class="title">Базы данных / Оптимизация запросов</span><span class="number">60</span></div></div></div></div>
<div class="slide"><div class="content"><h1>Рандомизированные алгоритмы</h1><div class="body"><ul class="item-1 level-1"><li>Итеративное улучшение<ul class="item-2 level-2"><li>Со случайным началом</li></ul></li><li>Эмуляция отжига</li><li>Двухфазная оптимизация<ul class="item-2 level-2"><li>Итеративное улучшение</li><li>Эмуляция отжига</li></ul></li><li>Генетические алгоритмы</li></ul></div><div class="footer"><div class="test"><span class="author">Георгий Корнеев</span><span class="title">Базы данных / Оптимизация запросов</span><span class="number">61</span></div></div></div></div>
<div class="slide"><div class="content"><h1>Точные алгоритмы</h1><div class="body"><ul class="item-1 level-1"><li>Алгоритм Ибараки-Камеда<ul class="item-2 level-2"><li>Для случая вложенного перебора</li><li>Трудоёмкость <span class="mathO"><span class="math">$O(n^2 \log n)$</span></span></li></ul></li><li>Алгоритм KBZ (Krishnamurthy-Boral-Zaniolo)<ul class="item-2 level-2"><li>Зависит от вида формулы трудозатрат</li><li>+ поиск по хэшу</li><li>Трудоёмкость <span class="mathO"><span class="math">$O(n^2)$</span></span></li></ul></li><li>Алгоритм AB<ul class="item-2 level-2"><li>Смягчает ограничения на вид формулы</li><li>Построен на базе KBZ</li></ul></li></ul></div><div class="footer"><div class="test"><span class="author">Георгий Корнеев</span><span class="title">Базы данных / Оптимизация запросов</span><span class="number">62</span></div></div></div></div>
<div class="slide section"><div class="content"><h1>Оценка размера и распределения</h1><h2>Содержание</h2><div class="body"><ol class="level-1 toc-1"><li><a href="#(2)" class="toc">Обработка запросов</a></li><li><a href="#(15)" class="toc">Перезапись запроса</a></li><li><a href="#(33)" class="toc">Методы исполнения</a></li><li><a href="#(52)" class="toc">Выбор структуры запроса</a></li><li><a href="#(63)" class="toc current">Оценка размера и распределения</a><ol class="level-2 toc-2"><li><a href="#(66)" class="">Статистические характеристики</a></li><li><a href="#(71)" class="">Оценка операций</a></li></ol></li><li><a href="#(77)" class="toc">Пример оптимизации запроса</a></li><li><a href="#(100)" class="toc">Литература</a></li></ol></div><div class="footer"><div class="test"><span class="author">Георгий Корнеев</span><span class="title">Базы данных / Оптимизация запросов</span><span class="number">63</span></div></div></div></div>
<div class="slide"><div class="content"><h1>Интересующие оценки</h1><div class="body"><ul class="item-1 level-1"><li>Получение всех результатов<ul class="item-2 level-2"><li>Обычный запрос</li></ul></li><li class="incremental"><div class="non-incremental">Получение первого результата<ul class="item-2 level-2"><li class="incremental"><div class="non-incremental"><var>exists</var></div></li></ul></div></li><li class="incremental"><div class="non-incremental">Получение части результатов<ul class="item-2 level-2"><li class="incremental"><div class="non-incremental"><var>offset</var> + <var>limit</var></div></li></ul></div></li></ul></div><div class="footer"><div class="test"><span class="author">Георгий Корнеев</span><span class="title">Базы данных / Оптимизация запросов</span><span class="number">64</span></div></div></div></div>
<div class="slide"><div class="content"><h1>Размер и распределение</h1><div class="body"><ul class="item-1 level-1"><li>Оценка размера<ul class="item-2 level-2"><li>Какого размера результат</li><li>Поместится ли он в памяти</li></ul></li><li>Оценка распределения<ul class="item-2 level-2"><li>Позволяет оценить размер результатов соединения</li></ul></li></ul></div><div class="footer"><div class="test"><span class="author">Георгий Корнеев</span><span class="title">Базы данных / Оптимизация запросов</span><span class="number">65</span></div></div></div></div>
<div class="slide subsection"><div class="content"><h1>Статистические характеристики</h1><h2>Содержание</h2><div class="body"><ol class="level-1 toc-1"><li><a href="#(2)" class="toc">Обработка запросов</a></li><li><a href="#(15)" class="toc">Перезапись запроса</a></li><li><a href="#(33)" class="toc">Методы исполнения</a></li><li><a href="#(52)" class="toc">Выбор структуры запроса</a></li><li><a href="#(63)" class="toc current">Оценка размера и распределения</a><ol class="level-2 toc-2"><li><a href="#(66)" class=" current">Статистические характеристики</a></li><li><a href="#(71)" class="">Оценка операций</a></li></ol></li><li><a href="#(77)" class="toc">Пример оптимизации запроса</a></li><li><a href="#(100)" class="toc">Литература</a></li></ol></div><div class="footer"><div class="test"><span class="author">Георгий Корнеев</span><span class="title">Базы данных / Оптимизация запросов</span><span class="number">66</span></div></div></div></div>
<div class="slide"><div class="content"><h1>Характеристики распределения</h1><div class="body"><ul class="item-1 level-1"><li>Основные тенденции<ul class="item-2 level-2"><li>Среднее, медиана, мода</li></ul></li><li>Распределение<ul class="item-2 level-2"><li>Минимум, максимум, дисперсия</li></ul></li><li>Размеры<ul class="item-2 level-2"><li>Число значений</li><li>Число различных значений</li></ul></li><li>Распределение по частотам<ul class="item-2 level-2"><li>Тип распределения, его параметры</li></ul></li></ul></div><div class="footer"><div class="test"><span class="author">Георгий Корнеев</span><span class="title">Базы данных / Оптимизация запросов</span><span class="number">67</span></div></div></div></div>
<div class="slide"><div class="content"><h1>Типы распределений</h1><div class="body"><ul class="item-1 level-1"><li>Распределение отношения<ul class="item-2 level-2"><li>Строки</li><li>Страницы</li></ul></li><li>Распределение атрибутов<ul class="item-2 level-2"><li>Значения</li><li>Размер</li><li>Диапазон</li><li>Распределение</li></ul></li><li>Распределение индексов<ul class="item-2 level-2"><li>Листы, узлы, высота дерева</li><li>Уникальные значения, корзины</li></ul></li></ul></div><div class="footer"><div class="test"><span class="author">Георгий Корнеев</span><span class="title">Базы данных / Оптимизация запросов</span><span class="number">68</span></div></div></div></div>
<div class="slide"><div class="content"><h1>Упрощающие предположения</h1><div class="body"><ul class="item-1 level-1"><li>Равномерность распределения<ul class="item-2 level-2"><li>Равное количество кортежей с равными значениями</li></ul></li><li>Независимость атрибутов<ul class="item-2 level-2"><li>Распределения атрибутов независимы</li></ul></li><li>Равномерность запросов<ul class="item-2 level-2"><li>Запросы ко всем значениям равновероятны</li></ul></li><li>Равномерность заполнения<ul class="item-2 level-2"><li>Страницы содержат равное число кортежей</li></ul></li><li>Случайность расположения<ul class="item-2 level-2"><li>Кортежи распределены по страницам случайным образом</li></ul></li></ul></div><div class="footer"><div class="test"><span class="author">Георгий Корнеев</span><span class="title">Базы данных / Оптимизация запросов</span><span class="number">69</span></div></div></div></div>
<div class="slide"><div class="content"><h1>Оцениваемые значения</h1><div class="body"><ul class="item-1 level-1"><li>Мат. ожидание числа чтений страниц<ul class="item-2 level-2"><li>Запрос с одним атрибутом</li><li>Запрос с несколькими атрибутами</li></ul></li><li>Мат. ожидание количества различных значений<ul class="item-2 level-2"><li>В результате фильтрации</li></ul></li><li class="incremental"><div class="non-incremental">Теорема Христодоулакиса<ul class="item-2 level-2"><li>Применение предположений даёт оценки для худшего случая</li></ul></div></li></ul></div><div class="footer"><div class="test"><span class="author">Георгий Корнеев</span><span class="title">Базы данных / Оптимизация запросов</span><span class="number">70</span></div></div></div></div>
<div class="slide subsection"><div class="content"><h1>Оценка операций</h1><h2>Содержание</h2><div class="body"><ol class="level-1 toc-1"><li><a href="#(2)" class="toc">Обработка запросов</a></li><li><a href="#(15)" class="toc">Перезапись запроса</a></li><li><a href="#(33)" class="toc">Методы исполнения</a></li><li><a href="#(52)" class="toc">Выбор структуры запроса</a></li><li><a href="#(63)" class="toc current">Оценка размера и распределения</a><ol class="level-2 toc-2"><li><a href="#(66)" class="">Статистические характеристики</a></li><li><a href="#(71)" class=" current">Оценка операций</a></li></ol></li><li><a href="#(77)" class="toc">Пример оптимизации запроса</a></li><li><a href="#(100)" class="toc">Литература</a></li></ol></div><div class="footer"><div class="test"><span class="author">Георгий Корнеев</span><span class="title">Базы данных / Оптимизация запросов</span><span class="number">71</span></div></div></div></div>
<div class="slide"><div class="content"><h1>Общий механизм</h1><div class="body"><ul class="item-1 level-1"><li>Базовые отношения<ul class="item-2 level-2"><li>Статистика</li></ul></li><li>Результаты операций<ul class="item-2 level-2"><li>Распределение аргументов</li><li>Свойства операции</li></ul></li></ul></div><div class="footer"><div class="test"><span class="author">Георгий Корнеев</span><span class="title">Базы данных / Оптимизация запросов</span><span class="number">72</span></div></div></div></div>
<div class="slide"><div class="content"><h1>Оценка фильтрации</h1><div class="body"><ul class="item-1 level-1"><li>Оценочная функция<ul class="item-2 level-2"><li><span class="mathO"><span class="math">$|Out| = Sel(expr)|In|$</span></span></li></ul></li><li>Сравнения<ul class="item-2 level-2"><li>Селективность из распределения</li><li>Интервальные оценки</li><li>Сравнение с другим атрибутом</li></ul></li><li>Составные выражения<ul class="item-2 level-2"><li><span class="mathO"><span class="math">$Sel(\neg A) = 1 - Sel(A)$</span></span></li><li><span class="mathO"><span class="math">$Sel(A ∧ B) = Sel(A) Sel(B|A)$</span></span></li><li><span class="mathO"><span class="math">$Sel(A \vee B) = Sel(A) + Sel(B) - Sel(A ∧ B)$</span></span></li></ul></li></ul></div><div class="footer"><div class="test"><span class="author">Георгий Корнеев</span><span class="title">Базы данных / Оптимизация запросов</span><span class="number">73</span></div></div></div></div>
<div class="slide"><div class="content"><h1>Оценка соединения</h1><div class="body"><ul class="item-1 level-1"><li>Оценочная функция<ul class="item-2 level-2"><li><span class="mathO"><span class="math">$|Out| = Sel(expr)|R_1||R_2|$</span></span></li></ul></li><li>Сравнения<ul class="item-2 level-2"><li>Различные распределения</li></ul></li><li>Уникальность ключей<ul class="item-2 level-2"><li><span class="mathO"><span class="math">$|Out| = min(|R_1|, |R_2|)$</span></span></li></ul></li></ul></div><div class="footer"><div class="test"><span class="author">Георгий Корнеев</span><span class="title">Базы данных / Оптимизация запросов</span><span class="number">74</span></div></div></div></div>
<div class="slide"><div class="content"><h1>Операции над множествами</h1><div class="body"><ul class="item-1 level-1"><li>Пересечение<ul class="item-2 level-2"><li><span class="mathO"><span class="math">$0 ≤ |Out| ≤ \min(|R_1|, |R_2|)$</span></span></li></ul></li><li>Объединение<ul class="item-2 level-2"><li><span class="mathO"><span class="math">$\max(|R_1|, |R_2|) ≤ |Out| ≤ |R_1| + |R_2|$</span></span></li></ul></li><li>Разность<ul class="item-2 level-2"><li><span class="mathO"><span class="math">$\max(|R_1| - |R_2|, 0) ≤ |Out| ≤ |R_1|$</span></span></li></ul></li></ul></div><div class="footer"><div class="test"><span class="author">Георгий Корнеев</span><span class="title">Базы данных / Оптимизация запросов</span><span class="number">75</span></div></div></div></div>
<div class="slide"><div class="content"><h1>Сбор статистики</h1><div class="body"><ul class="item-1 level-1"><li>Гистограммы распределений<ul class="item-2 level-2"><li>Индексы</li><li>Явный пересчёт статистики</li></ul></li><li>Результаты работы<ul class="item-2 level-2"><li>Статистика по исполненным запросам</li></ul></li><li>Предположение о распределениях<ul class="item-2 level-2"><li>Нормальное распределение</li><li>Равномерное распределение</li></ul></li></ul></div><div class="footer"><div class="test"><span class="author">Георгий Корнеев</span><span class="title">Базы данных / Оптимизация запросов</span><span class="number">76</span></div></div></div></div>
<div class="slide section"><div class="content"><h1>Пример оптимизации запроса</h1><h2>Содержание</h2><div class="body"><ol class="level-1 toc-1"><li><a href="#(2)" class="toc">Обработка запросов</a></li><li><a href="#(15)" class="toc">Перезапись запроса</a></li><li><a href="#(33)" class="toc">Методы исполнения</a></li><li><a href="#(52)" class="toc">Выбор структуры запроса</a></li><li><a href="#(63)" class="toc">Оценка размера и распределения</a></li><li><a href="#(77)" class="toc current">Пример оптимизации запроса</a><ol class="level-2 toc-2"><li><a href="#(78)" class="">Постановка задачи</a></li><li><a href="#(81)" class="">Оценка путей доступа</a></li><li><a href="#(91)" class="">Оценка соединения</a></li></ol></li><li><a href="#(100)" class="toc">Литература</a></li></ol></div><div class="footer"><div class="test"><span class="author">Георгий Корнеев</span><span class="title">Базы данных / Оптимизация запросов</span><span class="number">77</span></div></div></div></div>
<div class="slide subsection"><div class="content"><h1>Постановка задачи</h1><h2>Содержание</h2><div class="body"><ol class="level-1 toc-1"><li><a href="#(2)" class="toc">Обработка запросов</a></li><li><a href="#(15)" class="toc">Перезапись запроса</a></li><li><a href="#(33)" class="toc">Методы исполнения</a></li><li><a href="#(52)" class="toc">Выбор структуры запроса</a></li><li><a href="#(63)" class="toc">Оценка размера и распределения</a></li><li><a href="#(77)" class="toc current">Пример оптимизации запроса</a><ol class="level-2 toc-2"><li><a href="#(78)" class=" current">Постановка задачи</a></li><li><a href="#(81)" class="">Оценка путей доступа</a></li><li><a href="#(91)" class="">Оценка соединения</a></li></ol></li><li><a href="#(100)" class="toc">Литература</a></li></ol></div><div class="footer"><div class="test"><span class="author">Георгий Корнеев</span><span class="title">Базы данных / Оптимизация запросов</span><span class="number">78</span></div></div></div></div>
<div class="slide"><div class="content"><h1>Описание примера</h1><div class="body"><ul class="item-1 level-1"><li>Таблицы<ul class="item-2 level-2"><li><var>Students(SId, GId, FirstName, AveragePoints)</var></li><li><var>Groups(GId, Name, Program)</var></li></ul></li><li>Индексы<ul class="item-2 level-2"><li><var>Students(GId)</var> – B-дерево</li><li><var>Students(AveragePoints)</var> – B-дерево</li><li><var>Groups(Program)</var> – хэш-индекс</li></ul></li><li>Запрос<ul class="item-2 level-2"><li><pre class="prettyprint lang-sql">select FirstName, Name
from Students natural join Groups
where AveragePoints &gt; 4.8 and Program = 5
</pre></li></ul></li></ul></div><div class="footer"><div class="test"><span class="author">Георгий Корнеев</span><span class="title">Базы данных / Оптимизация запросов</span><span class="number">79</span></div></div></div></div>
<div class="slide"><div class="content"><h1>Интересные порядки</h1><div class="body"><ul class="item-1 level-1"><li><var>Students.GId = Groups.GId</var><ul class="item-2 level-2"><li>Отсутствует</li><li><var>Students.GId</var></li><li><var>Groups.GId</var></li><li><var>Students.GId, Groups.GId</var></li><li><var>Groups.GId, Students.GId</var></li></ul></li></ul></div><div class="footer"><div class="test"><span class="author">Георгий Корнеев</span><span class="title">Базы данных / Оптимизация запросов</span><span class="number">80</span></div></div></div></div>
<div class="slide subsection"><div class="content"><h1>Оценка путей доступа</h1><h2>Содержание</h2><div class="body"><ol class="level-1 toc-1"><li><a href="#(2)" class="toc">Обработка запросов</a></li><li><a href="#(15)" class="toc">Перезапись запроса</a></li><li><a href="#(33)" class="toc">Методы исполнения</a></li><li><a href="#(52)" class="toc">Выбор структуры запроса</a></li><li><a href="#(63)" class="toc">Оценка размера и распределения</a></li><li><a href="#(77)" class="toc current">Пример оптимизации запроса</a><ol class="level-2 toc-2"><li><a href="#(78)" class="">Постановка задачи</a></li><li><a href="#(81)" class=" current">Оценка путей доступа</a></li><li><a href="#(91)" class="">Оценка соединения</a></li></ol></li><li><a href="#(100)" class="toc">Литература</a></li></ol></div><div class="footer"><div class="test"><span class="author">Георгий Корнеев</span><span class="title">Базы данных / Оптимизация запросов</span><span class="number">81</span></div></div></div></div>
<div class="slide"><div class="content"><h1>Пути доступа </h1><div class="body"><table><tr><th> Таблица </th><th> Порядок </th><th> Описание</th></tr><tr><td><var>Students</var></td><td> – </td><td> Полный просмотр</td></tr><tr><td><var>Students</var></td><td><var>GId</var></td><td> Просмотр <var>GId</var></td></tr><tr><td><var>Students</var></td><td><var>GId</var></td><td> Поиск по <var>GId</var></td></tr><tr><td><var>Students</var></td><td> – </td><td> Поиск по <var>APoints</var></td></tr><tr><td><var>Groups</var></td><td><var>GId</var></td><td> Полный просмотр</td></tr><tr><td><var>Groups</var></td><td><var>GId</var></td><td> Поиск по <var>GId</var></td></tr><tr><td><var>Groups</var></td><td> – </td><td> Поиск по <var>Program</var></td></tr></table></div><div class="footer"><div class="test"><span class="author">Георгий Корнеев</span><span class="title">Базы данных / Оптимизация запросов</span><span class="number">82</span></div></div></div></div>
<div class="slide"><div class="content"><h1>Полный просмотр Students</h1><div class="body"><ul class="item-1 level-1"><li>Статистика таблицы<ul class="item-2 level-2"><li>Записей – <span class="mathO"><span class="math">$10^4$</span></span></li><li>Страниц – <span class="mathO"><span class="math">$10^3$</span></span></li></ul></li><li>Оценка<ul class="item-2 level-2"><li>Размер результата – <span class="mathO"><span class="math">$10^4$</span></span></li><li>Стоимость – <span class="mathO"><span class="math">$10^3$</span></span></li></ul></li></ul></div><div class="footer"><div class="test"><span class="author">Георгий Корнеев</span><span class="title">Базы данных / Оптимизация запросов</span><span class="number">83</span></div></div></div></div>
<div class="slide"><div class="content"><h1>Просмотр Students.GId</h1><div class="body"><ul class="item-1 level-1"><li>Статистика индекса<ul class="item-2 level-2"><li>Записей – <span class="mathO"><span class="math">$10^4$</span></span></li><li>Значений – <span class="mathO"><span class="math">$500$</span></span></li><li>Распределение – нормальное <span class="mathO"><span class="math">$(20, 10)$</span></span></li><li>Уровней – <span class="mathO"><span class="math">$3$</span></span></li><li>Страниц – <span class="mathO"><span class="math">$100$</span></span></li></ul></li><li>Оценка<ul class="item-2 level-2"><li>Размер результата – <span class="mathO"><span class="math">$10^4$</span></span></li><li>Стоимость – <span class="mathO"><span class="math">$100 + 10^4 ≈ 10^4$</span></span></li></ul></li></ul></div><div class="footer"><div class="test"><span class="author">Георгий Корнеев</span><span class="title">Базы данных / Оптимизация запросов</span><span class="number">84</span></div></div></div></div>
<div class="slide"><div class="content"><h1>Поиск по Students.GId</h1><div class="body"><ul class="item-1 level-1"><li>Статистика индекса<ul class="item-2 level-2"><li>Записей – <span class="mathO"><span class="math">$10^4$</span></span></li><li>Значений – <span class="mathO"><span class="math">$500$</span></span></li><li>Распределение – нормальное <span class="mathO"><span class="math">$(20, 10)$</span></span></li><li>Уровней – <span class="mathO"><span class="math">$3$</span></span></li><li>Страниц – <span class="mathO"><span class="math">$100$</span></span></li></ul></li><li>Оценка<ul class="item-2 level-2"><li>Размер результата – <span class="mathO"><span class="math">$20$</span></span> / <var>GId</var></li><li>Стоимость – <span class="mathO"><span class="math">$3 + 20 = 23$</span></span> / <var>GId</var></li></ul></li></ul></div><div class="footer"><div class="test"><span class="author">Георгий Корнеев</span><span class="title">Базы данных / Оптимизация запросов</span><span class="number">85</span></div></div></div></div>
<div class="slide"><div class="content"><h1>Поиск по Students.AveragePoints</h1><div class="body"><ul class="item-1 level-1"><li>Статистика индекса<ul class="item-2 level-2"><li>Записей – <span class="mathO"><span class="math">$10^4$</span></span></li><li>Значений – <span class="mathO"><span class="math">$300$</span></span></li><li>Распределение – нормальное <span class="mathO"><span class="math">$(4, 1/3)$</span></span></li><li>Страниц – <span class="mathO"><span class="math">$100$</span></span></li><li>Уровней – <span class="mathO"><span class="math">$3$</span></span></li></ul></li><li>Оценка<ul class="item-2 level-2"><li>Размер результата – <span class="mathO"><span class="math">$90$</span></span></li><li>Стоимость – <span class="mathO"><span class="math">$2 + 4 + 90 = 96$</span></span></li></ul></li></ul></div><div class="footer"><div class="test"><span class="author">Георгий Корнеев</span><span class="title">Базы данных / Оптимизация запросов</span><span class="number">86</span></div></div></div></div>
<div class="slide"><div class="content"><h1>Полный просмотр Groups</h1><div class="body"><ul class="item-1 level-1"><li>Статистика таблицы<ul class="item-2 level-2"><li>Записей – <span class="mathO"><span class="math">$500$</span></span></li><li>Страниц – <span class="mathO"><span class="math">$20$</span></span></li></ul></li><li>Оценка<ul class="item-2 level-2"><li>Размер результата – <span class="mathO"><span class="math">$500$</span></span></li><li>Стоимость – <span class="mathO"><span class="math">$20$</span></span></li></ul></li></ul></div><div class="footer"><div class="test"><span class="author">Георгий Корнеев</span><span class="title">Базы данных / Оптимизация запросов</span><span class="number">87</span></div></div></div></div>
<div class="slide"><div class="content"><h1>Поиск по Groups.GId</h1><div class="body"><ul class="item-1 level-1"><li>Статистика таблицы<ul class="item-2 level-2"><li>Записей – <span class="mathO"><span class="math">$500$</span></span></li><li>Страниц – <span class="mathO"><span class="math">$20$</span></span></li></ul></li><li>Оценка<ul class="item-2 level-2"><li>Размер результата – <span class="mathO"><span class="math">$1$</span></span> / <var>GId</var></li><li>Стоимость – <span class="mathO"><span class="math">$1 + 1 = 2$</span></span> / <var>GId</var></li></ul></li></ul></div><div class="footer"><div class="test"><span class="author">Георгий Корнеев</span><span class="title">Базы данных / Оптимизация запросов</span><span class="number">88</span></div></div></div></div>
<div class="slide"><div class="content"><h1>Поиск по Groups.Program</h1><div class="body"><ul class="item-1 level-1"><li>Статистика индекса<ul class="item-2 level-2"><li>Записей – <span class="mathO"><span class="math">$500$</span></span></li><li>Значений – <span class="mathO"><span class="math">$125$</span></span></li><li>Страниц – <span class="mathO"><span class="math">$5$</span></span></li><li>Распределение – нормальное <span class="mathO"><span class="math">$(4, 1)$</span></span></li></ul></li><li>Оценка<ul class="item-2 level-2"><li>Размер результата – <span class="mathO"><span class="math">$4$</span></span></li><li>Стоимость – <span class="mathO"><span class="math">$1 + 4 = 5$</span></span></li></ul></li></ul></div><div class="footer"><div class="test"><span class="author">Георгий Корнеев</span><span class="title">Базы данных / Оптимизация запросов</span><span class="number">89</span></div></div></div></div>
<div class="slide"><div class="content"><h1>Оценка путей доступа </h1><div class="body"><table><tr><th class="small"> Таблица </th><th class="small"> Порядок </th><th class="small"> Описание </th><th class="small"> Стоимость</th></tr><tr><td class="small"><var>Students</var></td><td class="small"> – </td><td class="small"> Полный просмотр </td><td class="small"><span class="mathO"><span class="math">$1000$</span></span></td></tr><tr><td class="small"><var>Students</var></td><td class="small"><var>GId</var></td><td class="small"> Просмотр <var>GId</var></td><td class="small"><span class="mathO"><span class="math">$10^4$</span></span></td></tr><tr><td class="small"><var>Students</var></td><td class="small"><var>GId</var></td><td class="small"> Поиск по <var>GId</var></td><td class="small"><span class="mathO"><span class="math">$23$</span></span> / <var>GId</var></td></tr><tr><td class="small"><var>Students</var></td><td class="small"> – </td><td class="small"> Поиск по <var>APoints</var></td><td class="small"><span class="mathO"><span class="math">$96$</span></span></td></tr><tr><td class="small"><var>Groups</var></td><td class="small"><var>GId</var></td><td class="small"> Полный просмотр </td><td class="small"><span class="mathO"><span class="math">$20$</span></span></td></tr><tr><td class="small"><var>Groups</var></td><td class="small"><var>GId</var></td><td class="small"> Поиск по <var>GId</var></td><td class="small"><span class="mathO"><span class="math">$2$</span></span> / <var>GId</var></td></tr><tr><td class="small"><var>Groups</var></td><td class="small"> – </td><td class="small"> Поиск по <var>Program</var></td><td class="small"><span class="mathO"><span class="math">$5$</span></span></td></tr></table></div><div class="footer"><div class="test"><span class="author">Георгий Корнеев</span><span class="title">Базы данных / Оптимизация запросов</span><span class="number">90</span></div></div></div></div>
<div class="slide subsection"><div class="content"><h1>Оценка соединения</h1><h2>Содержание</h2><div class="body"><ol class="level-1 toc-1"><li><a href="#(2)" class="toc">Обработка запросов</a></li><li><a href="#(15)" class="toc">Перезапись запроса</a></li><li><a href="#(33)" class="toc">Методы исполнения</a></li><li><a href="#(52)" class="toc">Выбор структуры запроса</a></li><li><a href="#(63)" class="toc">Оценка размера и распределения</a></li><li><a href="#(77)" class="toc current">Пример оптимизации запроса</a><ol class="level-2 toc-2"><li><a href="#(78)" class="">Постановка задачи</a></li><li><a href="#(81)" class="">Оценка путей доступа</a></li><li><a href="#(91)" class=" current">Оценка соединения</a></li></ol></li><li><a href="#(100)" class="toc">Литература</a></li></ol></div><div class="footer"><div class="test"><span class="author">Георгий Корнеев</span><span class="title">Базы данных / Оптимизация запросов</span><span class="number">91</span></div></div></div></div>
<div class="slide"><div class="content"><h1>Варианты соединения </h1><div class="body"><table><tr><th> Прав \ лев </th><td><var>S.GId</var></td><td><var>S.AP</var></td><td><var>G.GId</var></td><td><var>G.Prog</var></td></tr><tr><td class="small"> Просмотр <var>S.GId</var></td><td /><td /><td> merge </td><td> loops</td></tr><tr><td class="small"> Поиск по <var>S.GId</var></td><td /><td /><td> index </td><td><strong>index</strong></td></tr><tr><td class="small"> Поиск по <var>S.AP</var></td><td /><td /><td> loops </td><td> hash</td></tr><tr><td class="small"> Просмотр <var>G.GId</var></td><td><strong>merge</strong></td><td> loops </td><td /><td /></tr><tr><td class="small"> Поиск по <var>G.GId</var></td><td> index </td><td><strong>index</strong></td><td /><td /></tr><tr><td class="small"> Поиск по <var>G.Prog</var></td><td> loops </td><td><strong>hash</strong></td><td /><td /></tr></table></div><div class="footer"><div class="test"><span class="author">Георгий Корнеев</span><span class="title">Базы данных / Оптимизация запросов</span><span class="number">92</span></div></div></div></div>
<div class="slide"><div class="content"><h1>S.GId merge G.GId</h1><div class="body"><ul class="item-1 level-1"><li>Левая часть<ul class="item-2 level-2"><li>Записей – <span class="mathO"><span class="math">$10^4$</span></span></li><li>Стоимость – <span class="mathO"><span class="math">$10^4$</span></span></li></ul></li><li>Правая часть<ul class="item-2 level-2"><li>Записей – <span class="mathO"><span class="math">$200$</span></span></li><li>Стоимость – <span class="mathO"><span class="math">$20$</span></span></li></ul></li><li>Оценка<ul class="item-2 level-2"><li>Стоимость – <span class="mathO"><span class="math">$10^4 + 20 + (10^4 + 20) / 10 ≈ 10^4$</span></span></li></ul></li></ul></div><div class="footer"><div class="test"><span class="author">Георгий Корнеев</span><span class="title">Базы данных / Оптимизация запросов</span><span class="number">93</span></div></div></div></div>
<div class="slide"><div class="content"><h1>S.AP index G.GId</h1><div class="body"><ul class="item-1 level-1"><li>Левая часть<ul class="item-2 level-2"><li>Записей – <span class="mathO"><span class="math">$90$</span></span></li><li>Стоимость – <span class="mathO"><span class="math">$96$</span></span></li></ul></li><li>Правая часть<ul class="item-2 level-2"><li>Записей – <span class="mathO"><span class="math">$1$</span></span> / <var>GId</var></li><li>Стоимость – <span class="mathO"><span class="math">$2$</span></span> / <var>GId</var></li></ul></li><li>Оценка<ul class="item-2 level-2"><li>Стоимость – <span class="mathO"><span class="math">$96 + 90·2 = 276$</span></span></li></ul></li></ul></div><div class="footer"><div class="test"><span class="author">Георгий Корнеев</span><span class="title">Базы данных / Оптимизация запросов</span><span class="number">94</span></div></div></div></div>
<div class="slide"><div class="content"><h1>S.AP hash G.Prog</h1><div class="body"><ul class="item-1 level-1"><li>Левая часть<ul class="item-2 level-2"><li>Записей – <span class="mathO"><span class="math">$90$</span></span></li><li>Стоимость – <span class="mathO"><span class="math">$96$</span></span></li></ul></li><li>Правая часть<ul class="item-2 level-2"><li>Записей – <span class="mathO"><span class="math">$4$</span></span></li><li>Стоимость – <span class="mathO"><span class="math">$5$</span></span></li></ul></li><li>Оценка<ul class="item-2 level-2"><li>Стоимость – <span class="mathO"><span class="math">$96 + 5 + (90 + 4) / 10 ≈ 111$</span></span></li></ul></li></ul></div><div class="footer"><div class="test"><span class="author">Георгий Корнеев</span><span class="title">Базы данных / Оптимизация запросов</span><span class="number">95</span></div></div></div></div>
<div class="slide"><div class="content"><h1>G.Prog index S.GId</h1><div class="body"><ul class="item-1 level-1"><li>Левая часть<ul class="item-2 level-2"><li>Записей – <span class="mathO"><span class="math">$4$</span></span></li><li>Стоимость – <span class="mathO"><span class="math">$5$</span></span></li></ul></li><li>Правая часть<ul class="item-2 level-2"><li>Записей – <span class="mathO"><span class="math">$20$</span></span> / <var>GId</var></li><li>Стоимость – <span class="mathO"><span class="math">$23$</span></span> / <var>GId</var></li></ul></li><li>Оценка<ul class="item-2 level-2"><li>Стоимость – <span class="mathO"><span class="math">$5 + 4·23 = 97$</span></span></li></ul></li></ul></div><div class="footer"><div class="test"><span class="author">Георгий Корнеев</span><span class="title">Базы данных / Оптимизация запросов</span><span class="number">96</span></div></div></div></div>
<div class="slide"><div class="content"><h1>Оценка вариантов соединения </h1><div class="body"><table><tr><th>Метод </th><th> Стоимость</th></tr><tr><td><var>S.GId</var> merge <var>G.GId</var></td><td><span class="mathO"><span class="math">$10^4$</span></span></td></tr><tr><td><var>S.AP</var> index <var>G.GId</var></td><td><span class="mathO"><span class="math">$276$</span></span></td></tr><tr><td><var>S.AP</var> hash <var>G.Prog</var></td><td><span class="mathO"><span class="math">$111$</span></span></td></tr><tr><td><var>G.Prog</var> index <var>S.GId</var></td><td><strong><span class="mathO"><span class="math">$97$</span></span></strong></td></tr></table></div><div class="footer"><div class="test"><span class="author">Георгий Корнеев</span><span class="title">Базы данных / Оптимизация запросов</span><span class="number">97</span></div></div></div></div>
<div class="slide"><div class="content"><h1>Модификация статистики</h1><div class="body"><ul class="item-1 level-1"><li><var>Students.AveragePoints</var><ul class="item-2 level-2"><li>Распределение – нормальное <var>(4, 1/4)</var></li></ul></li><li><span class="question">Что изменится?</span><ul class="item-2 level-2"><li class="incremental"><div class="non-incremental">Размер результата – <span class="mathO"><span class="math">$7$</span></span></div></li><li class="incremental"><div class="non-incremental">Стоимость – <span class="mathO"><span class="math">$3 + 7 = 10$</span></span></div></li></ul></li><li class="incremental"><div class="non-incremental"><span class="question">Какие стоимости изменятся?</span><ul class="item-2 level-2"><li class="incremental"><div class="non-incremental"><var>S.AP</var> index <var>G.GId</var>: <span class="mathO"><span class="math">$10 + 7·2 = 24$</span></span></div></li><li class="incremental"><div class="non-incremental"><var>S.AP</var> hash <var>G.Prog</var>: <span class="mathO"><span class="math">$10 + 5 + (7 + 5) / 10 ≈ 16$</span></span></div></li></ul></div></li></ul></div><div class="footer"><div class="test"><span class="author">Георгий Корнеев</span><span class="title">Базы данных / Оптимизация запросов</span><span class="number">98</span></div></div></div></div>
<div class="slide"><div class="content"><h1>Модифицированный запрос</h1><div class="body"><ul class="item-1 level-1"><li>Запрос<ul class="item-2 level-2"><li><pre class="prettyprint lang-sql">select FirstName, Name
from Students natural join Groups
where AveragePoints &gt; 4.8 and Program = 5
order by Students.GId
</pre></li></ul></li><li><span class="question">Что изменилось?</span><ul class="item-2 level-2"><li class="incremental"><div class="non-incremental">Требуется упорядочение результата</div></li></ul></li><li class="incremental"><div class="non-incremental"><span class="question">Как добиться?</span><ul class="item-2 level-2"><li class="incremental"><div class="non-incremental">sort(<var>S.AP</var> hash <var>G.Prog</var>)</div></li><li class="incremental"><div class="non-incremental">sort(<var>G.Prog</var> index <var>S.GId</var>)</div></li><li class="incremental"><div class="non-incremental">sort(<var>G.Prog</var>) index <var>S.GId</var></div></li></ul></div></li></ul></div><div class="footer"><div class="test"><span class="author">Георгий Корнеев</span><span class="title">Базы данных / Оптимизация запросов</span><span class="number">99</span></div></div></div></div>
<div class="slide section"><div class="content"><h1>Литература</h1><h2>Содержание</h2><div class="body"><ol class="level-1 toc-1"><li><a href="#(2)" class="toc">Обработка запросов</a></li><li><a href="#(15)" class="toc">Перезапись запроса</a></li><li><a href="#(33)" class="toc">Методы исполнения</a></li><li><a href="#(52)" class="toc">Выбор структуры запроса</a></li><li><a href="#(63)" class="toc">Оценка размера и распределения</a></li><li><a href="#(77)" class="toc">Пример оптимизации запроса</a></li><li><a href="#(100)" class="toc current">Литература</a></li></ol></div><div class="footer"><div class="test"><span class="author">Георгий Корнеев</span><span class="title">Базы данных / Оптимизация запросов</span><span class="number">100</span></div></div></div></div>
<div class="slide"><div class="content"><h1>Основная литература</h1><div class="body"><ul class="item-1 level-1"><li><em>Дейт К.</em> Введение в системы баз данных (глава 18)</li></ul></div><div class="footer"><div class="test"><span class="author">Георгий Корнеев</span><span class="title">Базы данных / Оптимизация запросов</span><span class="number">101</span></div></div></div></div>
<div class="slide"><div class="content"><h1>Дополнительная литература</h1><div class="body"><ul class="item-1 level-1"><li><em>Ioannidis Y. E. </em><a href="http://citeseerx.ist.psu.edu/viewdoc/summary?doi=10.1.1.31.5178" target="_blank">Query Optimization</a></li><li><em>Mannino M. V.</em>, <em>Chu P.</em>, <em>Sager T.</em><br ignore="ignore" /><a href="http://portal.acm.org/citation.cfm?id=62061.62063" target="_blank">Statistical profile estimation in database systems</a></li><li>PostgreSQL Documentation <br ignore="ignore" /><a href="https://www.postgresql.org/docs/current/overview.html" target="_blank">Chapter 51. Overview of PostgreSQL Internals</a></li></ul></div><div class="footer"><div class="test"><span class="author">Георгий Корнеев</span><span class="title">Базы данных / Оптимизация запросов</span><span class="number">102</span></div></div></div></div></div></body></html>