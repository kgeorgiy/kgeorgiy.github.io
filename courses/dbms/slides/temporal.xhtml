<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html lang="ru" xml:lang="ru" xmlns="http://www.w3.org/1999/xhtml"><head><title>Базы данных / Временны́е данные</title><meta name="author" content="" /><link rel="stylesheet" type="text/css" media="screen, projection, print" href="scripts/slidy.css" /><link rel="stylesheet" type="text/css" href="scripts/prettify.css" /><link rel="stylesheet" type="text/css" href="scripts/kgeorgiy-slides.css" /><script type="text/javascript" src="scripts/slidy.js" charset="utf-8" /><script type="text/javascript" src="scripts/kgeorgiy-slides.js" charset="utf-8" /><script type="text/javascript" src="scripts/prettify.js" /><script type="text/javascript" src="scripts/lang-sql.js" /><script type="text/javascript" src="scripts/lang-javaModule.js" /><script type="text/javascript" src="scripts/lang-scala.js" /><script>var _gaq=_gaq||[];_gaq.push(["_setAccount","UA-37693764-1"]);_gaq.push(["_setDomainName","kgeorgiy.info"]);_gaq.push(["_trackPageview"]);(function(){var a=document.createElement("script");a.type="text/javascript";a.async=!0;a.src=("https:"==document.location.protocol?"https://ssl":"http://www")+".google-analytics.com/ga.js";var b=document.getElementsByTagName("script")[0];b.parentNode.insertBefore(a,b)})();</script><script async="async" src="https://www.googletagmanager.com/gtag/js?id=G-8EQ66D87ZZ" /><script>
                  window.dataLayer = window.dataLayer || [];
                  function gtag(){dataLayer.push(arguments);}
                  gtag('js', new Date());

                  gtag('config', 'G-8EQ66D87ZZ');
                </script></head><body onload="prettyPrint()"><div id="all">
<div class="slide cover"><div class="content"><div class="course">Базы данных</div><hr /><div class="lecture"><div>Временны́е данные</div></div><div class="link"><a href="https://kgeorgiy.info/courses/dbms/">https://kgeorgiy.info/courses/dbms/</a></div><div class="copyright"><a href="http://creativecommons.org/licenses/by-nc-sa/4.0/deed.ru"><span class="copyright">Copyright © Георгий Корнеев</span><img src="scripts/by-nc-sa.png" alt="Attribution-NonCommercial-ShareAlike" /></a></div></div></div>
<div class="slide section"><div class="content"><h1>Время в SQL</h1><h2>Содержание</h2><div class="body"><ol class="level-1 toc-1"><li><a href="#(2)" class="toc current">Время в SQL</a></li><li><a href="#(7)" class="toc">Что такое временны́е данные</a></li><li><a href="#(16)" class="toc">Полувременны́е базы данных</a></li><li><a href="#(20)" class="toc">Временны́е базы данных</a></li><li><a href="#(41)" class="toc">Литература</a></li></ol></div><div class="footer"><div class="test"><span class="author">Георгий Корнеев</span><span class="title">Базы данных / Временны́е данные</span><span class="number">2</span></div></div></div></div>
<div class="slide"><div class="content"><h1>Типы данных</h1><div class="body"><ul class="item-1 level-1"><li>Время<ul class="item-2 level-2"><li><var>date</var> — дата</li><li><var>time</var> — время внутри суток</li><li><var>datetime</var> — дата + время внутри суток</li><li><var>timestamp(n)</var> — внутреннее время, с точностью <var>n</var> знаков после секунды</li></ul></li><li>Интервал времени<ul class="item-2 level-2"><li><var>interval</var> — промежуток времени между событиями</li></ul></li></ul></div><div class="footer"><div class="test"><span class="author">Георгий Корнеев</span><span class="title">Базы данных / Временны́е данные</span><span class="number">3</span></div></div></div></div>
<div class="slide"><div class="content"><h1>Часовые пояса</h1><div class="body"><ul class="item-1 level-1"><li>Стандарт<ul class="item-2 level-2"><li>UTC</li></ul></li><li>Факт<ul class="item-2 level-2"><li>Локальное время</li></ul></li><li><span class="warn">Интерпретация дат и времени зависит от часового пояса</span><ul class="item-2 level-2"><li>Разные у разных клиентов</li><li>И летнего/зимнего времени</li><li>Дублирования и разрывы</li></ul></li><li>Типы<ul class="item-2 level-2"><li><var>with timezone</var></li></ul></li></ul></div><div class="footer"><div class="test"><span class="author">Георгий Корнеев</span><span class="title">Базы данных / Временны́е данные</span><span class="number">4</span></div></div></div></div>
<div class="slide"><div class="content"><h1>Аффиное пространство</h1><div class="body"><ul class="item-1 level-1"><li><var>время</var> − <var>время</var> = <var>интервал</var></li><li><var>время</var> + <var>интервал</var> = <var>время</var></li><li><var>время</var> − <var>интервал</var> = <var>время</var></li><li><var>интервал</var> * <var>число</var> = <var>интервал</var></li><li><var>интервал</var> / <var>число</var> = <var>интервал</var></li></ul></div><div class="footer"><div class="test"><span class="author">Георгий Корнеев</span><span class="title">Базы данных / Временны́е данные</span><span class="number">5</span></div></div></div></div>
<div class="slide"><div class="content"><h1>Литералы</h1><div class="body"><ul class="item-1 level-1"><li>Время<ul class="item-2 level-2"><li><pre class="prettyprint lang-sql">date 'yyyy-mm-dd'
</pre></li><li><pre class="prettyprint lang-sql">time 'hh:mm:ss.zzz'
</pre></li><li><pre class="prettyprint lang-sql">datetime 'yyyy-mm-dd hh:mm:ss.zzz'
</pre></li><li><pre class="prettyprint lang-sql">cast (days.fraction as datetime)
</pre></li><li><pre class="prettyprint lang-sql">current_date(), current_time(), current_timestamp(n)
</pre></li></ul></li><li>Интервал<ul class="item-2 level-2"><li><pre class="prettyprint lang-java">interval 'PyYmMdDThHmMsS'
</pre></li><li><pre class="prettyprint lang-sql">cast(days.fraction as interval)
</pre></li></ul></li></ul></div><div class="footer"><div class="test"><span class="author">Георгий Корнеев</span><span class="title">Базы данных / Временны́е данные</span><span class="number">6</span></div></div></div></div>
<div class="slide section"><div class="content"><h1>Что такое временны́е данные</h1><h2>Содержание</h2><div class="body"><ol class="level-1 toc-1"><li><a href="#(2)" class="toc">Время в SQL</a></li><li><a href="#(7)" class="toc current">Что такое временны́е данные</a></li><li><a href="#(16)" class="toc">Полувременны́е базы данных</a></li><li><a href="#(20)" class="toc">Временны́е базы данных</a></li><li><a href="#(41)" class="toc">Литература</a></li></ol></div><div class="footer"><div class="test"><span class="author">Георгий Корнеев</span><span class="title">Базы данных / Временны́е данные</span><span class="number">7</span></div></div></div></div>
<div class="slide"><div class="content"><h1>Временны́е данные</h1><div class="body"><ul class="item-1 level-1"><li>Временны́е (темпоральные) данные<ul class="item-2 level-2"><li>Зависят от времени</li></ul></li><li>Типы зависимости<ul class="item-2 level-2"><li>Информация о транзакциях (изменениях)</li><li>Информация о правильности</li><li>Бивременные данные</li></ul></li></ul></div><div class="footer"><div class="test"><span class="author">Георгий Корнеев</span><span class="title">Базы данных / Временны́е данные</span><span class="number">8</span></div></div></div></div>
<div class="slide"><div class="content"><h1>Информация об изменениях</h1><div class="body"><ul class="item-1 level-1"><li>Статус поступающих <table><tr><th>Событие </th><th>Дата </th><th> Статус</th></tr><tr><td>Записался в вуз </td><td> 15.07 </td><td> Абитуриент</td></tr><tr><td>Принёс документы </td><td> 28.07 </td><td> Абитуриент с документами</td></tr><tr><td>Приказ о зачислении </td><td> 06.08 </td><td> Поступивший</td></tr><tr><td>Выдача документов </td><td> 01.09 </td><td> Первокурсник</td></tr><tr><td>Распределительный тест </td><td> 03.09 </td><td> Студент группы</td></tr></table></li></ul></div><div class="footer"><div class="test"><span class="author">Георгий Корнеев</span><span class="title">Базы данных / Временны́е данные</span><span class="number">9</span></div></div></div></div>
<div class="slide"><div class="content"><h1>Информация о правильности</h1><div class="body"><ul class="item-1 level-1"><li>Высота Эвереста <table><tr><th> Событие </th><th> Год </th><th> Высота</th></tr><tr><td> Геодезические измерения </td><td> 1856 </td><td> 8840</td></tr><tr><td> Топографические измерения </td><td> 1950 </td><td> 8848</td></tr><tr><td> Китайские измерения </td><td> 1975 </td><td> 8848.13</td></tr><tr><td> Измерение по GPS </td><td> 1998 </td><td> 8850</td></tr><tr><td> Повторные китайские измерения </td><td> 2005 </td><td> 8844.43</td></tr><tr><td> Непальские измерения </td><td> 2019 </td><td> &gt; 8844</td></tr><tr><td> Совместные измерения </td><td> 2020 </td><td> 8848.86</td></tr></table></li></ul></div><div class="footer"><div class="test"><span class="author">Георгий Корнеев</span><span class="title">Базы данных / Временны́е данные</span><span class="number">10</span></div></div></div></div>
<div class="slide"><div class="content"><h1>Бивременны́е данные (1)</h1><div class="body"><ul class="item-1 level-1"><li>События жизни <table><tr><th>Событие </th><th>Факт </th><th>Документы</th></tr><tr><td>Родился ребёнок </td><td> Рождение </td><td> —</td></tr><tr><td>Регистрация рождения </td><td> — </td><td> Свидетельство о рождении</td></tr><tr><td>Изготовление паспорта </td><td> — </td><td> Паспорт</td></tr><tr><td>Наступило XX лет </td><td> Начало действия </td><td> —</td></tr></table></li><li>Есть дата события и дата выдачи регистрации</li></ul></div><div class="footer"><div class="test"><span class="author">Георгий Корнеев</span><span class="title">Базы данных / Временны́е данные</span><span class="number">11</span></div></div></div></div>
<div class="slide"><div class="content"><h1>Бивременны́е данные (2)</h1><div class="body"><ul class="item-1 level-1"><li>В декабре появились сведения, что начальник поднял зарплату с сентября</li><li>Последствия<ul class="item-2 level-2"><li><span class="question">Какая зарплата была в ноябре?</span><ul class="item-3 level-3"><li class="incremental"><div class="non-incremental">Работник: новая</div></li><li class="incremental"><div class="non-incremental">Банк: старая</div></li><li class="incremental"><div class="non-incremental">Бухгалтерия: новая (но надо доплатить)</div></li></ul></li><li class="incremental"><div class="non-incremental"><span class="question">Выплаты зарплаты в сентябре-ноябре?</span><ul class="item-3 level-3"><li class="incremental"><div class="non-incremental">Не изменились</div></li></ul></div></li><li class="incremental"><div class="non-incremental"><span class="question">Начисленная зарплата в сентябре-ноябре?</span><ul class="item-3 level-3"><li class="incremental"><div class="non-incremental">Увеличилась</div></li></ul></div></li><li class="incremental"><div class="non-incremental"><span class="question">Выплаты в декабре?</span><ul class="item-3 level-3"><li class="incremental"><div class="non-incremental">Доплата за сентябрь-ноябрь</div></li></ul></div></li></ul></li></ul></div><div class="footer"><div class="test"><span class="author">Георгий Корнеев</span><span class="title">Базы данных / Временны́е данные</span><span class="number">12</span></div></div></div></div>
<div class="slide"><div class="content"><h1>Временны́е атрибуты</h1><div class="body"><ul class="item-1 level-1"><li>Значение зависит от времени<ul class="item-2 level-2"><li>Хранение меток времени</li></ul></li><li>Метка на запись<ul class="item-2 level-2"><li>Простота запросов</li><li>Компактность</li><li>Проблема с отслеживанием изменений</li></ul></li><li>Метка на атрибут<ul class="item-2 level-2"><li>Более сложные запросы</li><li>Бо́льшая гибкость</li><li>Отсутствие дублирования</li></ul></li></ul></div><div class="footer"><div class="test"><span class="author">Георгий Корнеев</span><span class="title">Базы данных / Временны́е данные</span><span class="number">13</span></div></div></div></div>
<div class="slide"><div class="content"><h1>Операции</h1><div class="body"><ul class="item-1 level-1"><li>Внесение изменений</li><li>Обычные запросы<ul class="item-2 level-2"><li>На заданный момент времени</li></ul></li><li>Запросы изменений<ul class="item-2 level-2"><li>Как менялись атрибуты в указанный период времени</li></ul></li><li>Статистические запросы<ul class="item-2 level-2"><li>С усреднением по времени</li></ul></li></ul></div><div class="footer"><div class="test"><span class="author">Георгий Корнеев</span><span class="title">Базы данных / Временны́е данные</span><span class="number">14</span></div></div></div></div>
<div class="slide"><div class="content"><h1>Согласованность временны́х данных</h1><div class="body"><ul class="item-1 level-1"><li>Для любого момента времени<ul class="item-2 level-2"><li>Известно значение</li><li>Ровно одно значение</li></ul></li><li>Должна поддерживаться</li></ul></div><div class="footer"><div class="test"><span class="author">Георгий Корнеев</span><span class="title">Базы данных / Временны́е данные</span><span class="number">15</span></div></div></div></div>
<div class="slide section"><div class="content"><h1>Полувременны́е базы данных</h1><h2>Содержание</h2><div class="body"><ol class="level-1 toc-1"><li><a href="#(2)" class="toc">Время в SQL</a></li><li><a href="#(7)" class="toc">Что такое временны́е данные</a></li><li><a href="#(16)" class="toc current">Полувременны́е базы данных</a></li><li><a href="#(20)" class="toc">Временны́е базы данных</a></li><li><a href="#(41)" class="toc">Литература</a></li></ol></div><div class="footer"><div class="test"><span class="author">Георгий Корнеев</span><span class="title">Базы данных / Временны́е данные</span><span class="number">16</span></div></div></div></div>
<div class="slide"><div class="content"><h1>Полувременны́е базы данных</h1><div class="body"><ul class="item-1 level-1"><li>Текущие данные</li><li>Хранимые данные<ul class="item-2 level-2"><li>Текущее значение</li><li>Отметка времени, с которой данные действительны</li></ul></li><li>Представление данных<ul class="item-2 level-2"><li>Каждому атрибуту — по метке времени!</li></ul></li></ul></div><div class="footer"><div class="test"><span class="author">Георгий Корнеев</span><span class="title">Базы данных / Временны́е данные</span><span class="number">17</span></div></div></div></div>
<div class="slide"><div class="content"><h1>Пример</h1><div class="body"><ul class="item-1 level-1"><li>Статус поступающих<ul class="item-2 level-2"><li><pre class="prettyprint lang-sql">create table entrants (
    Id int not null primary key,
    FirstName varchar(100) not null,
    LastName varchar(100) not null,
    Status varchar(100),
    StatusTimestamp timestamp
)
</pre></li></ul></li><li><span class="question">Почему метка времени только для <var>status</var>?</span><ul class="item-2 level-2"><li class="incremental"><div class="non-incremental">Остальные данные не зависят от времени</div></li></ul></li></ul></div><div class="footer"><div class="test"><span class="author">Георгий Корнеев</span><span class="title">Базы данных / Временны́е данные</span><span class="number">18</span></div></div></div></div>
<div class="slide"><div class="content"><h1>Операции</h1><div class="body"><ul class="item-1 level-1"><li>Внесение изменений<ul class="item-2 level-2"><li>Изменение данных и меток времени</li></ul></li><li>Обычные запросы<ul class="item-2 level-2"><li><span class="question">С какого момента действителен результат?</span><ul class="item-3 level-3"><li class="incremental"><div class="non-incremental">Максимум по временным меткам</div></li></ul></li></ul></li><li class="incremental"><div class="non-incremental">Запросы изменений<ul class="item-2 level-2"><li>Не поддерживаются</li></ul></div></li><li class="incremental"><div class="non-incremental">Статистические запросы<ul class="item-2 level-2"><li>Не поддерживаются</li></ul></div></li></ul></div><div class="footer"><div class="test"><span class="author">Георгий Корнеев</span><span class="title">Базы данных / Временны́е данные</span><span class="number">19</span></div></div></div></div>
<div class="slide section"><div class="content"><h1>Временны́е базы данных</h1><h2>Содержание</h2><div class="body"><ol class="level-1 toc-1"><li><a href="#(2)" class="toc">Время в SQL</a></li><li><a href="#(7)" class="toc">Что такое временны́е данные</a></li><li><a href="#(16)" class="toc">Полувременны́е базы данных</a></li><li><a href="#(20)" class="toc current">Временны́е базы данных</a><ol class="level-2 toc-2"><li><a href="#(22)" class="">Модель интервалов</a></li><li><a href="#(35)" class="">Модель событий</a></li></ol></li><li><a href="#(41)" class="toc">Литература</a></li></ol></div><div class="footer"><div class="test"><span class="author">Георгий Корнеев</span><span class="title">Базы данных / Временны́е данные</span><span class="number">20</span></div></div></div></div>
<div class="slide"><div class="content"><h1>Временна́я реляционная алгебра</h1><div class="body"><ul class="item-1 level-1"><li>Распакованное представление<ul class="item-2 level-2"><li>Состояние на каждый момент времени</li><li>Не практично</li><li>Требуется другое представление</li></ul></li><li>Все операции исполняются так, как если бы они исполнялись на распакованных данных<ul class="item-2 level-2"><li>Соединения</li><li>Статистика</li></ul></li><li>Отслеживание изменений</li></ul></div><div class="footer"><div class="test"><span class="author">Георгий Корнеев</span><span class="title">Базы данных / Временны́е данные</span><span class="number">21</span></div></div></div></div>
<div class="slide subsection"><div class="content"><h1>Модель интервалов</h1><h2>Содержание</h2><div class="body"><ol class="level-1 toc-1"><li><a href="#(2)" class="toc">Время в SQL</a></li><li><a href="#(7)" class="toc">Что такое временны́е данные</a></li><li><a href="#(16)" class="toc">Полувременны́е базы данных</a></li><li><a href="#(20)" class="toc current">Временны́е базы данных</a><ol class="level-2 toc-2"><li><a href="#(22)" class=" current">Модель интервалов</a></li><li><a href="#(35)" class="">Модель событий</a></li></ol></li><li><a href="#(41)" class="toc">Литература</a></li></ol></div><div class="footer"><div class="test"><span class="author">Георгий Корнеев</span><span class="title">Базы данных / Временны́е данные</span><span class="number">22</span></div></div></div></div>
<div class="slide"><div class="content"><h1>Представление данных</h1><div class="body"><ul class="item-1 level-1"><li>Вместе с атрибутом хранится интервал действительности<ul class="item-2 level-2"><li>Полуоткрытый</li><li>Возможны противоречия в данных <img class="bottom" src="pics/intervals.svg" /></li></ul></li></ul></div><div class="footer"><div class="test"><span class="author">Георгий Корнеев</span><span class="title">Базы данных / Временны́е данные</span><span class="number">23</span></div></div></div></div>
<div class="slide"><div class="content"><h1>Пример</h1><div class="body"><ul class="item-1 level-1"><li>Информация о студенте<ul class="item-2 level-2"><li><pre class="prettyprint lang-sql">create table Students (
    StudentId int not null primary key,
    FirstName varchar(100) not null,
    LastName varchar(100) not null,
)
create table StudentGroups (
    StudentId int not null references students(id),
    GroupId int not null references groups(id),
    bg date not null,
    nd date not null
)
</pre></li></ul></li></ul></div><div class="footer"><div class="test"><span class="author">Георгий Корнеев</span><span class="title">Базы данных / Временны́е данные</span><span class="number">24</span></div></div></div></div>
<div class="slide"><div class="content"><h1>Вопросы</h1><div class="body"><ul class="item-1 level-1"><li><span class="question">Почему две таблицы?</span><ul class="item-2 level-2"><li class="incremental"><div class="non-incremental">Чтобы избежать дублирования</div></li><li class="incremental"><div class="non-incremental">По таблице на каждый темпоральный атрибут</div></li></ul></li><li class="incremental"><div class="non-incremental"><span class="question">Что является ключом <var>StudentGroups</var>?</span><ul class="item-2 level-2"><li class="incremental"><div class="non-incremental"><var>(StudentId, bg)</var></div></li><li class="incremental"><div class="non-incremental"><var>(StudentId, nd)</var></div></li></ul></div></li><li class="incremental"><div class="non-incremental"><span class="question">Как хранить данные, верные до текущего момента времени?</span><ul class="item-2 level-2"><li class="incremental"><div class="non-incremental">Полувременная база данных</div></li><li class="incremental"><div class="non-incremental">Отметка ≪бесконечность≫ (<var>inf = date '9999-12-31'</var>)</div></li></ul></div></li></ul></div><div class="footer"><div class="test"><span class="author">Георгий Корнеев</span><span class="title">Базы данных / Временны́е данные</span><span class="number">25</span></div></div></div></div>
<div class="slide"><div class="content"><h1>Ограничения целостности</h1><div class="body"><ul class="item-1 level-1"><li>Интервалы не пересекаются<ul class="item-2 level-2"><li><pre class="prettyprint lang-sql">check (not exists (
    select * from
        StudentGroups s1 inner join
        StudentGroups s2 on s1.StudentId = s2.StudentId
    where
        greatest(s1.bg, s2.bg) &lt; least(s1.nd, s2.nd)
))
</pre></li></ul></li><li><span class="question">Что делать для нескольких временны́х атрибутах?</span><ul class="item-2 level-2"><li class="incremental"><div class="non-incremental">Отдельные ограничения</div></li></ul></li></ul></div><div class="footer"><div class="test"><span class="author">Георгий Корнеев</span><span class="title">Базы данных / Временны́е данные</span><span class="number">26</span></div></div></div></div>
<div class="slide"><div class="content"><h1>Пример соединения</h1><div class="body"><ul class="item-1 level-1"><li>Студенты, учащиеся в одной группе<ul class="item-2 level-2"><li>Не SQL: <pre class="prettyprint lang-sql">StudentGroups g1 inner join StudentGroups g2
on g1.GroupId = g2.GroupId
using g1 (bg, nd) and g2 (bg, nd)
</pre></li><li>SQL: <pre class="prettyprint lang-sql">select 
    g1.*, g2.*, 
    greatest(g1.bg, g2.bg) as bg,
         least(g1.nd, g2.nd) as nd
from StudentGroups g1 inner join StudentGroups g2
on g1.GroupId = g2.GroupId
    and greatest(g1.bg, g2.bg) &lt; least(g1.nd, g2.nd)
</pre></li></ul></li></ul></div><div class="footer"><div class="test"><span class="author">Георгий Корнеев</span><span class="title">Базы данных / Временны́е данные</span><span class="number">27</span></div></div></div></div>
<div class="slide"><div class="content"><h1>Соединения</h1><div class="body"><ul class="item-1 level-1"><li>Общий случай<ul class="item-2 level-2"><li>Не SQL: <pre class="prettyprint lang-sql">t1 inner join t2 on condition
using t1 (t1.bg, t1.nd) and t2 (t2.bg, t2.nd)
</pre></li><li>SQL: <pre class="prettyprint lang-sql">select t1.*, t2.*, 
    greatest(t1.bg, t2.bg) as bg,
         least(t1.nd, t2.nd) as nd
from t1 inner join t2
on condition
    and greatest(t1.bg, t2.bg) &lt; least(t1.nd, t2.nd)
    -- bg &lt; nd
</pre></li></ul></li></ul></div><div class="footer"><div class="test"><span class="author">Георгий Корнеев</span><span class="title">Базы данных / Временны́е данные</span><span class="number">28</span></div></div></div></div>
<div class="slide"><div class="content"><h1>Операции над множествами</h1><div class="body"><ul class="item-1 level-1"><li><span class="question">Пересечение?</span><ul class="item-2 level-2"><li class="incremental"><div class="non-incremental">Естественное соединение</div></li></ul></li><li class="incremental"><div class="non-incremental"><span class="question">Объединение?</span><ul class="item-3 level-3"><li class="incremental"><div class="non-incremental"><pre class="prettyprint lang-sql">select t1.*, greatest(t1.bg, t2.bg) as bg,
        least(t1.nd, t2.nd) as nd
    from t1 inner join t2 on t1.value = t2.value
        and greatest(t1.bg, t2.bg) &lt; least(t1.nd, t2.nd)
union all 
select t2.*, greatest(t1.bg, t2.bg) as bg,
        least(t1.nd, t2.nd) as nd
    from t1 inner join t2 on t1.value &lt;&gt; t2.value
        and greatest(t1.bg, t2.bg) &lt; least(t1.nd, t2.nd)
</pre></div></li></ul></div></li><li class="incremental"><div class="non-incremental"><span class="question">Разность?</span></div></li></ul></div><div class="footer"><div class="test"><span class="author">Георгий Корнеев</span><span class="title">Базы данных / Временны́е данные</span><span class="number">29</span></div></div></div></div>
<div class="slide"><div class="content"><h1>Запросы</h1><div class="body"><ul class="item-1 level-1"><li>На текущий момент<ul class="item-2 level-2"><li><pre class="prettyprint lang-sql">select * from StudentGroups where nd = inf
</pre></li></ul></li><li>На заданный момент<ul class="item-2 level-2"><li><pre class="prettyprint lang-sql">select * from StudentGroups
where bg &lt;= :time and :time &lt; nd
</pre></li></ul></li><li>Изменений<ul class="item-2 level-2"><li><pre class="prettyprint lang-sql">select * from StudentGroups
</pre></li></ul></li><li>Статистика<ul class="item-2 level-2"><li><pre class="prettyprint lang-sql">select sum(cast(nd - bg as float) * price) 
         / sum(cast(nd - bg as float))
from prices
</pre></li></ul></li></ul></div><div class="footer"><div class="test"><span class="author">Георгий Корнеев</span><span class="title">Базы данных / Временны́е данные</span><span class="number">30</span></div></div></div></div>
<div class="slide"><div class="content"><h1>Изменение текущих значений</h1><div class="body"><ul class="item-1 level-1"><li>Вставка<ul class="item-2 level-2"><li><pre class="prettyprint lang-sql">insert into StudentGroups(StudentId, GroupId, bg, nd)
    values (:StudentId, :GroupId, current_date(), inf)
</pre></li></ul></li><li>Изменение<ul class="item-2 level-2"><li><pre class="prettyprint lang-sql">update StudentGroups set nd = current_date()
    where StudentId = :StudentId and nd = inf
insert into StudentGroups(StudentId, GroupId, bg, nd)
    values (:StudentId, :GroupId, current_date(), inf)
</pre></li></ul></li><li>Удаление<ul class="item-2 level-2"><li><pre class="prettyprint lang-sql">update StudentGroups set nd = current_date()
    where StudentId = :StudentId and nd = inf
</pre></li></ul></li></ul></div><div class="footer"><div class="test"><span class="author">Георгий Корнеев</span><span class="title">Базы данных / Временны́е данные</span><span class="number">31</span></div></div></div></div>
<div class="slide"><div class="content"><h1>Изменение значений в прошлом</h1><div class="body"><ul class="item-1 level-1"><li>Случай нескольких интервалов </li></ul><div class="img-width"><img class="width" style="width: 65%" src="pics/intervals-update-1.svg" /></div><ul class="item-1 level-1"><li>Случай одного интервала </li></ul><div class="img-width"><img class="width" style="width: 65%" src="pics/intervals-update-2.svg" /></div></div><div class="footer"><div class="test"><span class="author">Георгий Корнеев</span><span class="title">Базы данных / Временны́е данные</span><span class="number">32</span></div></div></div></div>
<div class="slide"><div class="content"><h1>Случай нескольких интервалов</h1><div class="body"><ul class="item-1 level-1"><li>Укоротить первый<ul class="item-2 level-2"><li><pre class="prettyprint lang-sql">update StudentGroups set nd = :bg
where StudentId = :SId and bg &lt; :bg and :bg &lt; nd
</pre></li></ul></li><li>Укоротить последний<ul class="item-2 level-2"><li><pre class="prettyprint lang-sql">update StudentGroups set :bg = :nd
where StudentId = :SId and bg &lt; :nd and :nd &lt; bg
</pre></li></ul></li><li>Удалить промежуточные<ul class="item-2 level-2"><li><pre class="prettyprint lang-sql">delete from StudentGroups
where StudentId = :SId and :bg &lt;= bg and nd &lt;= :nd
</pre></li></ul></li><li>Вставить новый<ul class="item-2 level-2"><li><pre class="prettyprint lang-sql">insert into StudentGroups(StudentId, GroupId, bg, nd)
values (:SId, :GroupId, :bg, :nd)
</pre></li></ul></li></ul></div><div class="footer"><div class="test"><span class="author">Георгий Корнеев</span><span class="title">Базы данных / Временны́е данные</span><span class="number">33</span></div></div></div></div>
<div class="slide"><div class="content"><h1>Случай одного интервала</h1><div class="body"><ul class="item-1 level-1"><li>Продублировать интервал<ul class="item-2 level-2"><li><pre class="prettyprint lang-sql">insert into StudentGroups
select SId, GroupId, :nd, nd
from StudentGroups
where StudentId = :SId and bg &lt; :bg and :nd &lt; nd
</pre></li></ul></li></ul><div class="img-width"><img class="width" style="width: 60%" src="pics/intervals-update-2-modified.svg" /></div><ul class="item-1 level-1"><li>Действовать как в случае нескольких интервалов</li></ul></div><div class="footer"><div class="test"><span class="author">Георгий Корнеев</span><span class="title">Базы данных / Временны́е данные</span><span class="number">34</span></div></div></div></div>
<div class="slide subsection"><div class="content"><h1>Модель событий</h1><h2>Содержание</h2><div class="body"><ol class="level-1 toc-1"><li><a href="#(2)" class="toc">Время в SQL</a></li><li><a href="#(7)" class="toc">Что такое временны́е данные</a></li><li><a href="#(16)" class="toc">Полувременны́е базы данных</a></li><li><a href="#(20)" class="toc current">Временны́е базы данных</a><ol class="level-2 toc-2"><li><a href="#(22)" class="">Модель интервалов</a></li><li><a href="#(35)" class=" current">Модель событий</a></li></ol></li><li><a href="#(41)" class="toc">Литература</a></li></ol></div><div class="footer"><div class="test"><span class="author">Георгий Корнеев</span><span class="title">Базы данных / Временны́е данные</span><span class="number">35</span></div></div></div></div>
<div class="slide"><div class="content"><h1>Представление данных</h1><div class="body"><ul class="item-1 level-1"><li>В месте с атрибутом хранится метка времени<ul class="item-2 level-2"><li>Нет противоречий</li><li>Случайное изменение истории</li><li>Нет удалений <img class="bottom" src="pics/events.svg" /></li></ul></li></ul></div><div class="footer"><div class="test"><span class="author">Георгий Корнеев</span><span class="title">Базы данных / Временны́е данные</span><span class="number">36</span></div></div></div></div>
<div class="slide"><div class="content"><h1>Пример</h1><div class="body"><ul class="item-1 level-1"><li>Информация о студенте<ul class="item-2 level-2"><li><pre class="prettyprint lang-sql">create table students (
    StudentId int not null primary key,
    FirstName varchar(100) not null,
    LastName varchar(100) not null,
)
create table StudentGroups (
    StudentId int not null references students(id),
    GroupId int not null references groups(id),
    When date,
    primary key (StudentId, GroupId, When)
)
</pre></li></ul></li></ul></div><div class="footer"><div class="test"><span class="author">Георгий Корнеев</span><span class="title">Базы данных / Временны́е данные</span><span class="number">37</span></div></div></div></div>
<div class="slide"><div class="content"><h1>Запросы</h1><div class="body"><ul class="item-1 level-1"><li><span class="question">На текущий момент?</span><ul class="item-2 level-2"><li class="incremental"><div class="non-incremental"><var>argmax</var> с условием</div></li></ul></li><li class="incremental"><div class="non-incremental"><span class="question">На заданный момент?</span><ul class="item-2 level-2"><li class="incremental"><div class="non-incremental"><var>argmax</var> с условием</div></li></ul></div></li><li class="incremental"><div class="non-incremental"><span class="question">Соединения?</span><ul class="item-2 level-2"><li class="incremental"><div class="non-incremental">Построить интервальное представление</div></li></ul></div></li><li class="incremental"><div class="non-incremental"><span class="question">Множественные операции?</span><ul class="item-2 level-2"><li class="incremental"><div class="non-incremental">Построить интервальное представление</div></li></ul></div></li></ul></div><div class="footer"><div class="test"><span class="author">Георгий Корнеев</span><span class="title">Базы данных / Временны́е данные</span><span class="number">38</span></div></div></div></div>
<div class="slide"><div class="content"><h1>Изменения</h1><div class="body"><ul class="item-1 level-1"><li>Текущих значений<ul class="item-2 level-2"><li><pre class="prettyprint lang-sql">insert into StudentGroups(StudentId, GroupId, When)
    values (:StudentId, :GroupId, current_date())
</pre></li></ul></li><li>Изменение значений в прошлом<ul class="item-2 level-2"><li>Семантика не ясна</li></ul></li><li>Изменение значений на интервале<ul class="item-2 level-2"><li>Аналогично интервальной модели</li></ul></li></ul></div><div class="footer"><div class="test"><span class="author">Георгий Корнеев</span><span class="title">Базы данных / Временны́е данные</span><span class="number">39</span></div></div></div></div>
<div class="slide"><div class="content"><h1>Выводы</h1><div class="body"><ul class="item-1 level-1"><li>Плюсы<ul class="item-2 level-2"><li>Небольшая экономия памяти</li><li>Интуитивно понятна</li></ul></li><li>Минусы<ul class="item-2 level-2"><li>Случайное изменение истории</li><li>Нет удалений</li><li>Очень сложные запросы</li><li>Низкая производительность запросов</li></ul></li></ul></div><div class="footer"><div class="test"><span class="author">Георгий Корнеев</span><span class="title">Базы данных / Временны́е данные</span><span class="number">40</span></div></div></div></div>
<div class="slide section"><div class="content"><h1>Литература</h1><h2>Содержание</h2><div class="body"><ol class="level-1 toc-1"><li><a href="#(2)" class="toc">Время в SQL</a></li><li><a href="#(7)" class="toc">Что такое временны́е данные</a></li><li><a href="#(16)" class="toc">Полувременны́е базы данных</a></li><li><a href="#(20)" class="toc">Временны́е базы данных</a></li><li><a href="#(41)" class="toc current">Литература</a></li></ol></div><div class="footer"><div class="test"><span class="author">Георгий Корнеев</span><span class="title">Базы данных / Временны́е данные</span><span class="number">41</span></div></div></div></div>
<div class="slide"><div class="content"><h1>Основная литература</h1><div class="body"><ul class="item-1 level-1"><li><em>Дейт К.</em> Введение в системы баз данных (глава 23)</li><li><em>Celko J.</em> SQL for Smarties (глава 4)</li><li><em>Gao D., Jensen C., Snodgrass R., Soo M.</em> Join operations in temporal databases</li></ul></div><div class="footer"><div class="test"><span class="author">Георгий Корнеев</span><span class="title">Базы данных / Временны́е данные</span><span class="number">42</span></div></div></div></div></div></body></html>